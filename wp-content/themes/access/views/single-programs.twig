{% extends "base.twig" %}

{% block content %}
  <main class="main-content" id="content">
    <div class="program-detail">
      <div class="usa-grid">
        {% if is_print %}
        <p class="back-to-program-start">
          <strong>{{__('Get back to this page', 'accessnyc-program-detail')}}:</strong> <a href="{{ post.get_permalink }}">{{ post.get_permalink | replace({'http://': ''})}}</a>
        </p>
        {% endif %}
        <header class="content-header usa-width-one-whole program-detail-title">
          <div class="program-icon program-header-icon">
            {% include 'partials/category-icon.twig' %}
          </div>
          <div class="program-title">
            <h1 class="program-descriptor">{{ post.plain_language_program_name }}</h1>
            <h2 class="program-information">{{ post.program_name }} {% if post.program_acronym | length %}({{ post.program_acronym }}){% endif %}{% if post.government_agency | length %} | {{ post.government_agency }}{% endif %}</h2>
          </div>
        </header>
      </div>
      <div class="usa-grid program-detail-body">
        <aside>
          <nav class="program-nav hide-for-print">
            <ol>
              {% for item in post.get_field('show_sections') %}
                <li>
                  <a id="nav-link-{{ item.value }}" class="js-program-nav-step-link{% if (loop.index == 1 and step == '') or step == '{{ item.value }}' %} active{% endif %}" href="?step={{ item.value }}">{{__(item.label, 'accessnyc-program-detail')}}</a>
                </li>
              {% endfor %}
            </ol>
            <div class="program-share-links hide-for-print">
              {% spaceless %}
                <a class="program-print-page" href="{{ post.get_permalink }}?print=1" target="_blank" rel="noopener noreferrer">
                  <svg class="icon icon-printer">
                    <use xlink:href="#icon-printer"></use>
                  </svg>{{__('Print the whole guide', 'accessnyc-program-detail')}}
                </a>
              {% endspaceless %}
            </div>
          </nav>
        </aside>
        <div class="content-body">
          <article class="program-detail-content">
            {# Parsing all the sections in the current program to build a display conditional inside of the partials #}
            {% set sectionArray = [] %}
            {% for item in post.get_field('show_sections') %}
              {% set sectionArray = sectionArray | merge([item.value])  %}
            {% endfor %}
            {% for item in post.get_field('show_sections') %}
              {% include 'program-detail-partials/' ~ item.value ~ '.twig' with {'stepNumber': loop.index, 'nextStep': post.get_field('show_sections')[loop.index] } %}
            {% endfor %}
          </article>
        </div>
        <div class="program-detail-help">
          <div class="hide-for-print">
            <h3>{{__('More ways to get help with this program', 'accessnyc-program-detail')}}</h3>
            <div class="program-detail-help-container">
              {# Gets all the current help method fields and creates an array to be iterated below #}
              {% set helpMethods = [
                'get_help_online',
                'get_help_by_email',
                'get_help_by_calling_311',
                'get_help_by_calling_other_than_311',
                'get_help_in_person'
              ] %}
              {% for method in helpMethods %}
                {% if post.get_field(method) %}
                  <div class="program-detail-help-method help-method-{{method}}">
                    {{ post.get_field(method) }}
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>
          <footer class="content-footer usa-width-one-whole">
            <div class="last-updated">{{__('Updated', 'accessnyc-program-detail')}}
              {% if post.post_modified | length %}
                {{post.post_modified|date}}
              {% else %}
                {{ post.post_date|date}}
              {% endif %}
            </div>
            {# {% include 'partials/was-this-page-helpful.twig' %} #}
          </footer>
        </div>
      </div>
    </div>
  </main>
{% endblock %}
