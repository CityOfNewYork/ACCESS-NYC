{% extends "base.twig" %}

{% block content %}
  <main id="content" class="color-light-background" itemscope itemtype="http://schema.org/{{ post.item_scope }}">
    {% if alerts %}
    <div class="px-2 screen-tablet:px-3 pt-2 screen-tablet:pt-3">
      {% for alert in alerts %}
        {% set class = loop.last ? '' : 'mb-2 screen-tablet:mb-3' %}

        {% include 'components/alert.twig' with {this: alert, class: class} only %}
      {% endfor %}
    </div>
    {% endif %}

    <p class="wrap m-0 pt-3 hidden print:block" aria-hidden="true">
      <strong>{{ __('Get back to this page', 'accessnyc-program-detail') }}:</strong>

      <a href="{{ post.get_permalink }}" itemprop="url">{{ post.get_permalink|replace({'http://': ''})}}</a>
    </p>

    <header class="c-header p-2 screen-tablet:p-3 mt-3 mb-3 print:mt-0">
      <div class="c-header__icon">
        <span class="hidden" aria-hidden="true" itemprop="serviceType">{{ post.category.name }}</span>

        {% include 'elements/icon.twig' with {
          'icon': 'icon-card-' ~ post.category.slug ~ '-v' ~ post.icon.version,
          'class': post.icon.class,
          'title': post.category.name
        } only %}
      </div>

      <div>
        <h1 class="c-header__descriptor" itemprop="alterName">
          {% if post.status %}
          <mark class="badge color-{{ post.status.type }}-status font-sans inline-block">{{ post.status.text }}</mark>
          {% endif %}

          {{ post.plain_language_program_name }}
        </h1>

        <h2 class="c-header__information color__alt mb-0">
          <span itemprop="name">
            {{ post.program_name }}
          </span>

          {% if post.program_acronym | length %}({{ post.program_acronym }}){% endif %}

          {% if post.government_agency | length %} |
          <span itemprop="serviceOperator" itemscope itemtype="http://schema.org/GovernmentOrganization">
            <span itemprop="name">
              {{ post.government_agency }}
            </span>
          </span>
          {% endif %}
        </h2>
        <p class="color__alt mt-1">
          {{ __('Last Updated', 'accessnyc-page') }} {{ post.post_modified|date('l, F jS, g:ia') }}
          <meta itemprop="datePosted" content="{{ post.post_modified }}" />
        </p>
      </div>
    </header>

    {% if post.custom.program_status_clear_date %}
      <meta itemprop="expires" content="{{ post.custom.program_status_clear_date }}" />
    {% endif %}

    <section class="wrap screen-desktop:layout-sidebar-small-gutter">
      <aside>
        <nav class="c-side-nav print:hidden" data-js="program-nav">
          <ol>
            {% for item in post.get_field('field_589e43563c471') %} {# show_section #}
            <li>
              <a id="nav-link-{{ item.value }}" data-js="program-nav-step-link" {% if (loop.index == 1 and step == '') or step == '{{ item.value }}' %}class="active"{% endif %} href="?step={{ item.value }}">
                {{ __(item.label, 'accessnyc-program-detail') }}
              </a>
            </li>
            {% endfor %}
          </ol>
        </nav>
        <div class="c-share print:hidden pb-2">
          {% spaceless %}
          <a class="c-share__link" href="{{ post.get_permalink }}?print=1" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-ui-printer">
              <use xlink:href="#icon-ui-printer"></use>
            </svg>{{ __('Print the whole guide', 'accessnyc-program-detail') }}
          </a>
          {% endspaceless %}
        </div>
      </aside>

      <article class="pt-2 screen-desktop:pt-0" data-js="program-detail-content">
        {% set sectionArray = [] %}

        {% for item in post.get_field('field_589e43563c471') %} {# show_section #}
        {% set sectionArray = sectionArray | merge([item.value])  %}
        {% endfor %}

        {% for item in post.get_field('field_589e43563c471') %} {# show_section #}
        {% include 'programs/' ~ item.value ~ '.twig' with {
            'stepNumber': loop.index,
            'nextStep': post.get_field('field_589e43563c471')[loop.index]
          } %}
        {% endfor %}
      </article>
    </section>

    <section class="wrap print:hidden">
      <header>
        <h3 class="text-blue-dark border-t-2 border-yellow-access pt-4 mt-4">
          {{ __('More ways to get help with this program', 'accessnyc-program-detail') }}
        </h3>
      </header>

      <div class="screen-desktop:layout-columns-gutter">
        {# {% for method in [
          'get_help_online',
          'get_help_by_email',
          'get_help_by_calling_311',
          'get_help_by_calling_other_than_311',
          'get_help_in_person'
        ] %} #}
        {% for method in [
          'field_58912c1a8a996',
          'field_58912c1a8a9a8',
          'field_58912c1a8a9cb',
          'field_58912c1a8a9ba',
          'field_58912c1a8a984'
        ] %}
        {% if post.get_field(method) %}
        <div>
          {{ post.get_field(method) }}
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </section>

    <div itemprop="governmentBenefitsInfo" itemtype="http://schema.org/GovernmentService" itemscope>
      {% if post.structured_data_url %}
        <meta itemprop="url" content="{{ post.structured_data_url }}" />
      {% endif %}

      <div itemprop="provider" itemtype="http://schema.org/GovernmentOrganization" itemscope>
        <meta itemprop="name" content="{{ post.government_agency }}" />
      </div>

      {% if post.structured_data_service_type %}
        <meta itemprop="serviceType" content="http://schema.org/{{ post.structured_data_service_type[0] }}" />
      {% endif %}
    </div>

    {% if post.item_scope == 'SpecialAnnouncement' %}
      <meta itemprop="category" content="https://www.wikidata.org/wiki/Q81068910" />
    {% endif %}

    <footer class="wrap pt-4">
      <p class="color__alt">
        {{ __('Last Updated', 'accessnyc-page') }} {{ post.post_modified|date('l, F jS, g:ia') }}
      </p>
    </footer>

    <div class="wrap sticky bottom-0 text-end pb-3">
      <a href="#content" class="btn btn-small bg-blue-light text-blue">{{ __('Back to top', 'accessnyctheme') }}</a>
    </div>
  </main>
{% endblock %}
