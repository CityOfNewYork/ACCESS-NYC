!function(e,t,s){function r(e){var t=document.createElement("a");return t.href=e,t}function a(t){var s="No response from sever";if(t&&t.responseJSON)return t.responseJSON;try{return e.parseJSON(t.responseText)}catch(r){return{status:"fail",code:503,message:s,error:s}}}function n(t){return t&&"success"===t.status?t:e.Deferred().rejectWith(this,[t])}function i(e,t,s){e.one("change keyup",function(){e.val()!==s&&t.setCustomValidity("")})}function o(e){this.trigger("bsd-success",[e]),this.data("bsdsignup").no_redirect!==!0&&e.thanks_url&&(t.href=e.thanks_url)}function u(t){var s=this,r=!1,a=this.data("bsdsignup"),n={};t&&t.field_errors&&t.field_errors.length&&(e.each(t.field_errors,function(e,o){var u=s.find('[name="'+o.field+'"]'),d=u.get()[0];"submit-btn"===o.field?t.message=o.message:d&&d.setCustomValidity&&l&&!s[0].noValidate&&!a.no_html5validate&&(d.setCustomValidity(o.message),i(u,d,o.message),r=!0),o.$field=u,n[o.field]=o.message,u.trigger("invalid",o.message)}),r&&l&&s.find('[type="submit"],[type="image"]').eq(0).click()),s.trigger("bsd-error",[t,n])}function d(s,i,d){return function(c){if(s.data("isPaused")!==!0){var l=s.serializeObject(),f=i.replace(/\/page\/(signup|s)/,"/page/sapi"),p=e.ajax({url:f,type:"POST",method:"POST",dataType:"json",timeout:d.timeout||3e4,context:s,data:l,beforeSend:function(s,a){if(d.proxyall||a.crossDomain&&!e.support.cors&&(!e.oldiexdr||r(a.url).protocol!==t.protocol)){if(!d.oldproxy&&!d.proxyall)return!1;a.url=d.oldproxy||d.proxyall,a.crossDomain=!1,a.data+="&purl="+f}c.preventDefault()}});"canceled"!==p.statusText&&(s.trigger("bsd-submit",l),p.then(n,a).done(o).fail(u))}else c.preventDefault()}}function c(t,s,r){var a,n=t.find('[name="'+s+'"]');n.length||(n=e("<input/>",{type:"hidden",name:s}).appendTo(t)),r&&(a=n.val(),n.val((""!==a?a+",":"")+r))}e.fn.serializeObject=function(){var t={},r=this.serializeArray();return e.each(r,function(){t[this.name]!==s?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t};var l="reportValidity"in e("<form/>").get()[0],f=function(e){var s=new RegExp("[\\?&]"+e.replace(/(\[|\])/g,"\\$1")+"=([^&#]*)"),r=s.exec(t.href);return null===r?"":r[1]},p="source",m="subsource",h=f(p)||f("fb_ref"),g=f(m);e.fn.bsdSignup=function(t){return t=t||{},this.each(function(){var s=e(this),r=s.attr("action");"remove"===t?s.off("submit.bsdsignup").removeData("bsdsignup isPaused"):s.is("form")&&r.indexOf("page/s")>-1&&(s.data("bsdsourced")===!0||t.nosource||(c(s,p,h),c(s,m,g),s.data("bsdsourced",!0)),s.data("bsdsignup",t),t.startPaused&&s.data("isPaused",!0),s.on("submit.bsdsignup",d(s,r,t)))})}}(jQuery,window.location);