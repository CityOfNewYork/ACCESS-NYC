/*! GatherContent Plugin - v3.1.13 - 2019-05-22 | http://www.gathercontent.com | Copyright (c) 2019 GatherContent | Licensed GPLv2 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=Backbone.Collection.extend({getById:function(a){return this.find(function(b){var c=b.get("id");return c===a||c&&a&&c==a})}})},{}],2:[function(a,b,c){"use strict";b.exports=function(b){b.models={base:a("./models/base.js")},b.collections={base:a("./collections/base.js")},b.views={base:a("./views/base.js")}}},{"./collections/base.js":1,"./models/base.js":3,"./views/base.js":7}],3:[function(a,b,c){"use strict";b.exports=Backbone.Model.extend({sync:function(){return!1}})},{}],4:[function(a,b,c){"use strict";b.exports=function(a){return a.prototype._get=function(a,b){return this["_get_"+b]&&(a=this["_get_"+b](a)),a},a.prototype.get=function(a){return this._get(Backbone.Model.prototype.get.call(this,a),a)},a.prototype.toJSON=function(){return _.mapObject(Backbone.Model.prototype.toJSON.call(this),_.bind(this._get,this))},a}},{}],5:[function(a,b,c){"use strict";b.exports=function(b){return a("./../models/modify-json.js")(Backbone.Model.extend({defaults:{id:0,item:0,itemName:"",updated_at:"",current:!0,editLink:"",mapping:0,mappingName:"",mappingLink:"",mappingStatus:"",mappingStatusId:"",status:{},checked:!1,disabled:!1,canPull:!1,canPush:!1,statuses:[],statusesChecked:!1,ptLabel:!1},searchAttributes:["itemName","mappingName","post_title"],url:function(){var a=window.ajaxurl+"?action=gc_fetch_js_post&id="+this.get("id");return this.get("uncached")&&(this.set("uncached",!1),a+="&flush_cache=force"),a},_get_disabled:function(a){return!this.get("mapping")},_get_canPull:function(a){return this.get("item")>0&&this.get("mapping")>0},_get_canPush:function(a){return this.get("mapping")>0},_get_mappingLink:function(a){return"failed"===Backbone.Model.prototype.get.call(this,"mappingStatus")&&(a+="&sync-items=1"),a},_get_mappingStatus:function(a){return b._statuses[a]?b._statuses[a]:""},_get_mappingStatusId:function(a){return Backbone.Model.prototype.get.call(this,"mappingStatus")}}))}},{"./../models/modify-json.js":4}],6:[function(a,b,c){"use strict";window.GatherContent=window.GatherContent||{},function(b,c,d,e,f){e.single=e.single||{};var g=e.single;a("./initiate-objects.js")(g),g.models.post=a("./models/post.js")(e),g.views.statusSelect2=a("./views/status-select2.js")(g),g.init=function(){e._post.mapping?(g.views.metabox=a("./views/metabox.js")(g,d,e),g.metaboxView=new g.views.metabox({model:new g.models.post(e._post)})):(g.views.metabox=a("./views/mapping-metabox.js")(g,d,e),g.metaboxView=new g.views.metabox({model:new g.models.post(e._post)}),g.metaboxView.on("complete",g.reinit))},g.reinit=function(b){g.metaboxView.unbind(),g.metaboxView.onClose&&g.metaboxView.onClose(),g.views.metabox=a("./views/metabox.js")(g,d,e),g.metaboxView=new g.views.metabox({model:b})},d(g.init)}(window,document,jQuery,window.GatherContent)},{"./initiate-objects.js":2,"./models/post.js":5,"./views/mapping-metabox.js":8,"./views/metabox.js":11,"./views/status-select2.js":12}],7:[function(a,b,c){"use strict";b.exports=Backbone.View.extend({toggleExpanded:function(a){this.model.set("expanded",!this.model.get("expanded"))},getRenderedModels:function(a,b){b=b||this.collection;var c=document.createDocumentFragment();return b.each(function(b){var d=new a({model:b}).render();c.appendChild(d.el)}),c},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},close:function(){this.remove(),this.unbind(),this.onClose&&this.onClose()}})},{}],8:[function(a,b,c){"use strict";b.exports=function(b,c,d){var e;return a("./../views/metabox-base.js")(b,c,d).extend({template:wp.template("gc-mapping-metabox"),stepArgs:!1,events:{"click #gc-map":"step","change #select-gc-next-step":"setProperty","click #gc-map-cancel":"cancel"},initialize:function(){e=this,this.listenTo(this.model,"change:waiting",this.toggleWaitingRender),this.listenTo(this.model,"change",this.maybeEnableAndRender),this.listenTo(this.model,"change:step",this.changeStep),this.listenTo(this,"cancel",this.resetAndRender),this.render(),this.$el.removeClass("no-js").addClass("gc-mapping-metabox")},changeStep:function(a){"accounts"===a.changed.step&&this.$el.addClass("gc-mapping-started"),a.changed.step&&(this.stepArgs=this["step_"+a.changed.step]())},setProperty:function(a){var b=c(a.target).val();this.model.set(this.stepArgs.property,b),"account"!==this.stepArgs.property&&"project"!==this.stepArgs.property||this.step()},setMapping:function(){var a=function(a){this.model.set("waiting",!1),this.trigger("complete",this.model,a)};this.ajax({action:"gc_save_mapping_id"},a,this.failMsg)},maybeEnableAndRender:function(a){(a.changed.account||a.changed.project||a.changed.mapping)&&(this.model.set("btnDisabled",!1),this.render())},toggleWaitingRender:function(a){a.changed.waiting&&this.model.set("btnDisabled",!0),this.render()},step:function(){if(this.model.set("waiting",!0),"mapping"===this.stepArgs.property)return this.setMapping();this.setStep();var a=this.model.get(this.stepArgs.properties);return a&&a.length?this.successHandler(a):this.ajax({action:"gc_wp_filter_mappings",property:this.stepArgs.property},this.successHandler,this.failMsg),this},failMsg:function(a){a="string"==typeof a?a:d._errors.unknown,window.alert(a),e.model.set("waiting",!1)},successHandler:function(a){this.model.set(this.stepArgs.properties,a),a.length<2&&this.model.set("btnDisabled",!1),this.model.set("waiting",!1)},setStep:function(){return this.model.get("step")?"accounts"===this.model.get("step")?this.model.set("step","projects"):"projects"===this.model.get("step")?this.model.set("step","mappings"):void 0:this.model.set("step","accounts")},step_accounts:function(){return{property:"account",properties:"accounts"}},step_projects:function(){return{property:"project",properties:"projects"}},step_mappings:function(){return{property:"mapping",properties:"mappings"}},cancel:function(a){this.trigger("cancel",a)},resetModel:function(){return this.stepArgs=!1,this.model.set({step:!1,account:0,project:0,mapping:0}),this.model},resetAndRender:function(){this.resetModel(),this.render()},render:function(){var a=this.model.toJSON();return this.stepArgs&&(a.label=d._step_labels[a.step],a.property=this.stepArgs.property),this.$el.html(this.template(a)),this}})}},{"./../views/metabox-base.js":9}],9:[function(a,b,c){"use strict";b.exports=function(a,b,c){return a.views.base.extend({el:"#gc-related-data",ajax:function(a,d,e){var f=this,g=function(a){a.success?d.call(f,a.data):e&&e.call(f,a.data)},h=b.post(window.ajaxurl,b.extend({action:"",post:this.model.toJSON(),nonce:c.$id("gc-edit-nonce").val(),flush_cache:c.queryargs.flush_cache?1:0},a),g);return e&&h.fail(function(){e.call(f)}),h}})}},{}],10:[function(a,b,c){"use strict";b.exports=function(a,b,c){var d;return a.views.statusSelect2.extend({className:"misc-pub-section",select2template:wp.template("gc-status-select2"),template:wp.template("gc-metabox-statuses"),isOpen:!1,rendered:!1,initialize:function(){d=this,this.listenTo(this,"render",this.render),this.listenTo(this,"statusesOpen",this.statusesOpen),this.listenTo(this,"statusesClose",this.statusesClose)},statusesOpen:function(){this.isOpen=!0,this.model.get("statusesChecked")||this.asyncInit(),this.$(".edit-gc-status").addClass("hidden"),this.$("#gc-post-status-select").slideDown("fast")},statusesClose:function(){this.isOpen=!1,this.$(".edit-gc-status").removeClass("hidden"),this.$("#gc-post-status-select").slideUp("fast")},asyncInit:function(){this.rendered=!1,b.post(window.ajaxurl,{action:"gc_get_post_statuses",postId:this.model.get("id"),flush_cache:c.queryargs.flush_cache?1:0},this.ajaxResponse.bind(this)).done(function(){d.firstToRender()}).fail(function(){d.model.set("statusesChecked",!1)}),this.model.set("statusesChecked",!0)},ajaxResponse:function(a){if(!a.data||!a.success)return void this.model.set("statusesChecked",!1);this.model.set("statusesChecked",!0),this.model.set("statuses",a.data.statuses),this.model.get("statuses").length&&(d.$(".gc-select2").each(function(){b(this).select2("destroy")}),d.firstToRender())},firstToRender:function(){d.rendered||(d.renderStatuses(),d.rendered=!0)},renderStatuses:function(){this.model.get("id");this.$("#gc-status-selec2").html(this.select2template(this.model.toJSON())),this.model.get("statuses").length&&this.renderSelect2(this.$el)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("statusesChecked")&&d.renderStatuses(),this}})}},{}],11:[function(a,b,c){"use strict";b.exports=function(b,c,d){var e,f=a("./../views/metabox-base.js")(b,c,d),g=a("./../views/metabox-statuses.js")(b,c,d);return f.extend({template:wp.template("gc-metabox"),statusesView:null,timeoutID:null,events:{"click .edit-gc-status":"editStatus","click .cancel-gc-status":"cancelEditStatus","click .save-gc-status":"saveStatus","click #gc-pull":"pull","click #gc-push":"push","click #gc-disconnect":"disconnect"},initialize:function(){e=this,this.listenTo(this.model,"change:status",this.renderStatusView),this.listenTo(this.model,"change:mappingStatus",this.render),this.listenTo(this.model,"render",this.render),this.statusesView=new g({model:this.model}),this.render(),this.$el.removeClass("no-js"),this.refreshData()},refreshData:function(){this.model.set("uncached",!0),this.model.fetch().done(function(a){e.statusesView.isOpen||e.render()})},updateModel:function(a){var b=this.model.get("id");b in a&&(a[b].status&&this.model.set("status",a[b].status),a[b].itemName&&this.model.set("itemName",a[b].itemName),a[b].updated_at&&this.model.set("updated_at",a[b].updated_at))},editStatus:function(a){a.preventDefault(),this.statusesView.trigger("statusesOpen")},cancelEditStatus:function(a){a.preventDefault(),this.statusesView.trigger("statusesClose")},saveStatus:function(){var a,b,c=this.$(".gc-default-mapping-select").val(),d=this.model.get("status"),e=!(!d||!d.id)&&d.id;if(c===e)return this.statusesView.trigger("statusesClose");b=this.model.get("statuses"),a=_.find(b,function(a){return parseInt(c,10)===parseInt(a.id,10)}),this.statusesView.trigger("statusesClose"),this.model.set("status",a),this.ajax({action:"set_gc_status",status:c},this.refreshData,function(){this.model.set("status",d)})},disconnect:function(){window.confirm(d._sure.disconnect)&&(e.model.set("mappingStatus","starting"),this.ajax({action:"gc_disconnect_post",data:e.model.toJSON(),nonce:d._edit_nonce},this.disconnectResponse,this.syncFail))},pull:function(){window.confirm(d._sure.pull)&&(e.model.set("mappingStatus","starting"),this.doSync("pull"))},push:function(){var a=this.model.get("item")?d._sure.push:d._sure.push_no_item;window.confirm(a)&&(e.model.set("mappingStatus","starting"),this.doSync("push"))},syncFail:function(a){a="string"==typeof a?a:d._errors.unknown,window.alert(a),this.model.set("mappingStatus","failed"),this.clearTimeout()},disconnectResponse:function(a){this.clearTimeout(),this.$el.html(wp.template("gc-mapping-metabox"))},syncResponse:function(a){a.mappings?a.mappings.length&&-1!==_.indexOf(a.mappings,this.model.get("mapping"))?(this.model.set("mappingStatus","syncing"),this.checkStatus(a.direction)):this.finishedSync(a.direction):this.syncFail(a)},doSync:function(a,b){this.ajax({action:"gc_"+a+"_items",data:b||[this.model.toJSON()],nonce:d._edit_nonce},this.syncResponse,this.syncFail)},finishedSync:function(a){this.clearTimeout(),this.model.set("mappingStatus","complete"),"push"===a?window.setTimeout(function(){e.refreshData()},800):window.location.href=window.location.href},checkStatus:function(a){this.clearTimeout(),this.timeoutID=window.setTimeout(function(){e.doSync(a,{check:[e.model.get("mapping")]})},1e3)},clearTimeout:function(){window.clearTimeout(this.timeoutID),this.timeoutID=null},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$(".misc-pub-section.gc-item-name").after(this.statusesView.render().el),this},renderStatusView:function(){this.statusesView.$el.replaceWith(this.statusesView.render().el)}})}},{"./../views/metabox-base.js":9,"./../views/metabox-statuses.js":10}],12:[function(a,b,c){"use strict";b.exports=function(a){var b;return a.views.base.extend({select2ItemTemplate:wp.template("gc-select2-item"),width:"250px",renderSelect2:function(a){var c=a?a.find(".gc-select2"):this.$(".gc-select2");return b=this,c.each(function(){var a=jQuery(this),c=a.data();a.select2(b.select2Args(c));var d=a.data("select2");d.$results.addClass("select2-"+c.column),d.$container.addClass("select2-"+c.column)}),this},select2Args:function(a){var c={width:b.width};return c.templateResult=function(a,c){var d=jQuery.extend(a,jQuery(a.element).data());return d.description=!1!==c&&(d.description||""),jQuery(b.select2ItemTemplate(a))}.bind(b),c.templateSelection=function(a){return c.templateResult(a,!1)},c}})}},{}]},{},[6]);