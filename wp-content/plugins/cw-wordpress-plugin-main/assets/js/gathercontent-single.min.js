/*! Content Workflow (by Bynder) - v1.0.0 - 2024-06-25 |  | Copyright (c) 2024 Content Workflow (by Bynder) | Licensed GPLv2 */
!function i(n,o,a){function c(s,t){if(!o[s]){if(!n[s]){var e="function"==typeof require&&require;if(!t&&e)return e(s,!0);if(r)return r(s,!0);t=new Error("Cannot find module '"+s+"'");throw t.code="MODULE_NOT_FOUND",t}e=o[s]={exports:{}};n[s][0].call(e.exports,function(t){var e=n[s][1][t];return c(e||t)},e,e.exports,i,n,o,a)}return o[s].exports}for(var r="function"==typeof require&&require,t=0;t<a.length;t++)c(a[t]);return c}({1:[function(t,e,s){"use strict";e.exports=Backbone.Collection.extend({getById:function(e){return this.find(function(t){t=t.get("id");return t===e||t&&e&&t==e})}})},{}],2:[function(e,t,s){"use strict";t.exports=function(t){t.models={base:e("./models/base.js")},t.collections={base:e("./collections/base.js")},t.views={base:e("./views/base.js")}}},{"./collections/base.js":1,"./models/base.js":3,"./views/base.js":7}],3:[function(t,e,s){"use strict";e.exports=Backbone.Model.extend({sync:function(){return!1}})},{}],4:[function(t,e,s){"use strict";e.exports=function(t){return t.prototype._get=function(t,e){return t=this["_get_"+e]?this["_get_"+e](t):t},t.prototype.get=function(t){return this._get(Backbone.Model.prototype.get.call(this,t),t)},t.prototype.toJSON=function(){return _.mapObject(Backbone.Model.prototype.toJSON.call(this),_.bind(this._get,this))},t}},{}],5:[function(t,e,s){"use strict";e.exports=function(e){return t("./../models/modify-json.js")(Backbone.Model.extend({defaults:{id:0,item:0,itemName:"",updated_at:"",current:!0,editLink:"",mapping:0,mappingName:"",mappingLink:"",mappingStatus:"",mappingStatusId:"",status:{},checked:!1,disabled:!1,canPull:!1,canPush:!1,statuses:[],statusesChecked:!1,ptLabel:!1},searchAttributes:["itemName","mappingName","post_title"],url:function(){var t=window.ajaxurl+"?action=cwby_fetch_js_post&id="+this.get("id");return this.get("uncached")&&(this.set("uncached",!1),t+="&flush_cache=force"),t},_get_disabled:function(t){return!this.get("mapping")},_get_canPull:function(t){return 0<this.get("item")&&0<this.get("mapping")},_get_canPush:function(t){return 0<this.get("mapping")},_get_mappingLink:function(t){return"failed"===Backbone.Model.prototype.get.call(this,"mappingStatus")&&(t+="&sync-items=1"),t},_get_mappingStatus:function(t){return e._statuses[t]||""},_get_mappingStatusId:function(t){return Backbone.Model.prototype.get.call(this,"mappingStatus")}}))}},{"./../models/modify-json.js":4}],6:[function(e,t,s){"use strict";var i,n,o;window.GatherContent=window.GatherContent||{},window,document,i=jQuery,(n=window.GatherContent).single=n.single||{},o=n.single,e("./initiate-objects.js")(o),o.models.post=e("./models/post.js")(n),o.views.statusSelect2=e("./views/status-select2.js")(o),o.init=function(){n._post.mapping?(o.views.metabox=e("./views/metabox.js")(o,i,n),o.metaboxView=new o.views.metabox({model:new o.models.post(n._post)})):(o.views.metabox=e("./views/mapping-metabox.js")(o,i,n),o.metaboxView=new o.views.metabox({model:new o.models.post(n._post)}),o.metaboxView.on("complete",o.reinit))},o.reinit=function(t){o.metaboxView.unbind(),o.metaboxView.onClose&&o.metaboxView.onClose(),o.views.metabox=e("./views/metabox.js")(o,i,n),o.metaboxView=new o.views.metabox({model:t})},i(o.init)},{"./initiate-objects.js":2,"./models/post.js":5,"./views/mapping-metabox.js":8,"./views/metabox.js":11,"./views/status-select2.js":12}],7:[function(t,e,s){"use strict";e.exports=Backbone.View.extend({toggleExpanded:function(t){this.model.set("expanded",!this.model.get("expanded"))},getRenderedModels:function(e,t){t=t||this.collection;var s=document.createDocumentFragment();return t.each(function(t){t=new e({model:t}).render();s.appendChild(t.el)}),s},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},close:function(){this.remove(),this.unbind(),this.onClose&&this.onClose()}})},{}],8:[function(n,t,e){"use strict";t.exports=function(t,e,s){var i;return n("./../views/metabox-base.js")(t,e,s).extend({template:wp.template("gc-mapping-metabox"),stepArgs:!1,events:{"click #gc-map":"step","change #select-gc-next-step":"setProperty","click #gc-map-cancel":"cancel"},initialize:function(){(i=this).listenTo(this.model,"change:waiting",this.toggleWaitingRender),this.listenTo(this.model,"change",this.maybeEnableAndRender),this.listenTo(this.model,"change:step",this.changeStep),this.listenTo(this,"cancel",this.resetAndRender),this.render(),this.$el.removeClass("no-js").addClass("gc-mapping-metabox")},changeStep:function(t){"accounts"===t.changed.step&&this.$el.addClass("gc-mapping-started"),t.changed.step&&(this.stepArgs=this["step_"+t.changed.step]())},setProperty:function(t){t=e(t.target).val();this.model.set(this.stepArgs.property,t),"account"!==this.stepArgs.property&&"project"!==this.stepArgs.property||this.step()},setMapping:function(){this.ajax({action:"cwby_save_mapping_id"},function(t){this.model.set("waiting",!1),this.trigger("complete",this.model,t)},this.failMsg)},maybeEnableAndRender:function(t){(t.changed.account||t.changed.project||t.changed.mapping)&&(this.model.set("btnDisabled",!1),this.render())},toggleWaitingRender:function(t){t.changed.waiting&&this.model.set("btnDisabled",!0),this.render()},step:function(){if(this.model.set("waiting",!0),"mapping"===this.stepArgs.property)return this.setMapping();this.setStep();var t=this.model.get(this.stepArgs.properties);return t&&t.length?this.successHandler(t):this.ajax({action:"cwby_wp_filter_mappings",property:this.stepArgs.property},this.successHandler,this.failMsg),this},failMsg:function(t){t="string"==typeof t?t:s._errors.unknown,window.alert(t),i.model.set("waiting",!1)},successHandler:function(t){this.model.set(this.stepArgs.properties,t),t.length<2&&this.model.set("btnDisabled",!1),this.model.set("waiting",!1)},setStep:function(){return this.model.get("step")?"accounts"===this.model.get("step")?this.model.set("step","projects"):"projects"===this.model.get("step")?this.model.set("step","mappings"):void 0:this.model.set("step","accounts")},step_accounts:function(){return{property:"account",properties:"accounts"}},step_projects:function(){return{property:"project",properties:"projects"}},step_mappings:function(){return{property:"mapping",properties:"mappings"}},cancel:function(t){this.trigger("cancel",t)},resetModel:function(){return this.stepArgs=!1,this.model.set({step:!1,account:0,project:0,mapping:0}),this.model},resetAndRender:function(){this.resetModel(),this.render()},render:function(){var t=this.model.toJSON();return this.stepArgs&&(t.label=s._step_labels[t.step],t.property=this.stepArgs.property),this.$el.html(this.template(t)),this}})}},{"./../views/metabox-base.js":9}],9:[function(t,e,s){"use strict";e.exports=function(t,n,o){return t.views.base.extend({el:"#gc-related-data",ajax:function(t,e,s){var i=this,t=n.post(window.ajaxurl,n.extend({action:"",post:this.model.toJSON(),nonce:o.$id("gc-edit-nonce").val(),flush_cache:o.queryargs.flush_cache?1:0},t),function(t){t.success?e.call(i,t.data):s&&s.call(i,t.data)});return s&&t.fail(function(){s.call(i)}),t}})}},{}],10:[function(t,e,s){"use strict";e.exports=function(t,e,s){var i;return t.views.statusSelect2.extend({className:"misc-pub-section",select2template:wp.template("gc-status-select2"),template:wp.template("gc-metabox-statuses"),isOpen:!1,rendered:!1,initialize:function(){(i=this).listenTo(this,"render",this.render),this.listenTo(this,"statusesOpen",this.statusesOpen),this.listenTo(this,"statusesClose",this.statusesClose)},statusesOpen:function(){this.isOpen=!0,this.model.get("statusesChecked")||this.asyncInit(),this.$(".edit-gc-status").addClass("hidden"),this.$("#gc-post-status-select").slideDown("fast")},statusesClose:function(){this.isOpen=!1,this.$(".edit-gc-status").removeClass("hidden"),this.$("#gc-post-status-select").slideUp("fast")},asyncInit:function(){this.rendered=!1,e.post(window.ajaxurl,{action:"cwby_get_post_statuses",postId:this.model.get("id"),flush_cache:s.queryargs.flush_cache?1:0},this.ajaxResponse.bind(this)).done(function(){i.firstToRender()}).fail(function(){i.model.set("statusesChecked",!1)}),this.model.set("statusesChecked",!0)},ajaxResponse:function(t){t.data&&t.success?(this.model.set("statusesChecked",!0),this.model.set("statuses",t.data.statuses),this.model.get("statuses").length&&(i.$(".gc-select2").each(function(){e(this).select2("destroy")}),i.firstToRender())):this.model.set("statusesChecked",!1)},firstToRender:function(){i.rendered||(i.renderStatuses(),i.rendered=!0)},renderStatuses:function(){this.model.get("id");this.$("#gc-status-selec2").html(this.select2template(this.model.toJSON())),this.model.get("statuses").length&&this.renderSelect2(this.$el)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("statusesChecked")&&i.renderStatuses(),this}})}},{}],11:[function(a,t,e){"use strict";t.exports=function(t,e,s){var i,n=a("./../views/metabox-base.js")(t,e,s),o=a("./../views/metabox-statuses.js")(t,e,s);return n.extend({template:wp.template("gc-metabox"),statusesView:null,timeoutID:null,events:{"click .edit-gc-status":"editStatus","click .cancel-gc-status":"cancelEditStatus","click .save-gc-status":"saveStatus","click #gc-pull":"pull","click #gc-push":"push","click #gc-disconnect":"disconnect"},initialize:function(){(i=this).listenTo(this.model,"change:status",this.renderStatusView),this.listenTo(this.model,"change:mappingStatus",this.render),this.listenTo(this.model,"render",this.render),this.statusesView=new o({model:this.model}),this.render(),this.$el.removeClass("no-js"),this.refreshData()},refreshData:function(){this.model.set("uncached",!0),this.model.fetch().done(function(t){i.statusesView.isOpen||i.render()})},updateModel:function(t){var e=this.model.get("id");e in t&&(t[e].status&&this.model.set("status",t[e].status),t[e].itemName&&this.model.set("itemName",t[e].itemName),t[e].updated_at)&&this.model.set("updated_at",t[e].updated_at)},editStatus:function(t){t.preventDefault(),this.statusesView.trigger("statusesOpen")},cancelEditStatus:function(t){t.preventDefault(),this.statusesView.trigger("statusesClose")},saveStatus:function(){var e=this.$(".gc-default-mapping-select").val(),t=this.model.get("status"),s=!(!t||!t.id)&&t.id;if(e===s)return this.statusesView.trigger("statusesClose");s=this.model.get("statuses"),s=_.find(s,function(t){return parseInt(e,10)===parseInt(t.id,10)}),this.statusesView.trigger("statusesClose"),this.model.set("status",s),this.ajax({action:"set_cwby_status",status:e},this.refreshData,function(){this.model.set("status",t)})},disconnect:function(){window.confirm(s._sure.disconnect)&&(i.model.set("mappingStatus","starting"),this.ajax({action:"cwby_disconnect_post",data:i.model.toJSON(),nonce:s._edit_nonce},this.disconnectResponse,this.syncFail))},pull:function(){window.confirm(s._sure.pull)&&(i.model.set("mappingStatus","starting"),this.doSync("pull"))},push:function(){var t=this.model.get("item")?s._sure.push:s._sure.push_no_item;window.confirm(t)&&(i.model.set("mappingStatus","starting"),this.doSync("push"))},syncFail:function(t){t="string"==typeof t?t:s._errors.unknown,window.alert(t),this.model.set("mappingStatus","failed"),this.clearTimeout()},disconnectResponse:function(t){this.clearTimeout(),this.$el.html(wp.template("gc-mapping-metabox"))},syncResponse:function(t){t.mappings?t.mappings.length&&-1!==_.indexOf(t.mappings,this.model.get("mapping"))?(this.model.set("mappingStatus","syncing"),this.checkStatus(t.direction)):this.finishedSync(t.direction):this.syncFail(t)},doSync:function(t,e){this.ajax({action:"cwby_"+t+"_items",data:e||[this.model.toJSON()],nonce:s._edit_nonce},this.syncResponse,this.syncFail)},finishedSync:function(t){this.clearTimeout(),this.model.set("mappingStatus","complete"),"push"===t?window.setTimeout(function(){i.refreshData()},800):window.location.href=window.location.href},checkStatus:function(t){this.clearTimeout(),this.timeoutID=window.setTimeout(function(){i.doSync(t,{check:[i.model.get("mapping")]})},1e3)},clearTimeout:function(){window.clearTimeout(this.timeoutID),this.timeoutID=null},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$(".misc-pub-section.gc-item-name").after(this.statusesView.render().el),this},renderStatusView:function(){this.statusesView.$el.replaceWith(this.statusesView.render().el)}})}},{"./../views/metabox-base.js":9,"./../views/metabox-statuses.js":10}],12:[function(t,e,s){"use strict";e.exports=function(t){var i;return t.views.base.extend({select2ItemTemplate:wp.template("gc-select2-item"),width:"250px",renderSelect2:function(t){t=t?t.find(".gc-select2"):this.$(".gc-select2");return i=this,t.each(function(){var t=jQuery(this),e=t.data(),t=(t.select2(i.select2Args(e)),t.data("select2"));t.$results.addClass("select2-"+e.column),t.$container.addClass("select2-"+e.column)}),this},select2Args:function(t){var e={width:i.width};return e.templateResult=function(t,e){var s=jQuery.extend(t,jQuery(t.element).data());return s.description=!1!==e&&(s.description||""),jQuery(i.select2ItemTemplate(t))}.bind(i),e.templateSelection=function(t){return e.templateResult(t,!1)},e}})}},{}]},{},[6]);