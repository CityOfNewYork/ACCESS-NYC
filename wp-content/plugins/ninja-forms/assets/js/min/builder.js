!function(){var e,t,n;!function(i){function r(e,t){return b.call(e,t)}function a(e,t){var n,i,r,a,l,s,o,c,d,h,u,p=t&&t.split("/"),g=y.map,f=g&&g["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),l=e.length-1,y.nodeIdCompat&&j.test(e[l])&&(e[l]=e[l].replace(j,"")),e=p.slice(0,p.length-1).concat(e),d=0;d<e.length;d+=1)if(u=e[d],"."===u)e.splice(d,1),d-=1;else if(".."===u){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||f)&&g){for(n=e.split("/"),d=n.length;d>0;d-=1){if(i=n.slice(0,d).join("/"),p)for(h=p.length;h>0;h-=1)if(r=g[p.slice(0,h).join("/")],r&&(r=r[i])){a=r,s=d;break}if(a)break;!o&&f&&f[i]&&(o=f[i],c=d)}!a&&o&&(a=o,s=c),a&&(n.splice(0,s,a),e=n.join("/"))}return e}function l(e,t){return function(){var n=C.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(i,n.concat([e,t]))}}function s(e){return function(t){return a(t,e)}}function o(e){return function(t){m[e]=t}}function c(e){if(r(v,e)){var t=v[e];delete v[e],w[e]=!0,u.apply(i,t)}if(!r(m,e)&&!r(w,e))throw new Error("No "+e);return m[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function h(e){return function(){return y&&y.config&&y.config[e]||{}}}var u,p,g,f,m={},v={},y={},w={},b=Object.prototype.hasOwnProperty,C=[].slice,j=/\.js$/;g=function(e,t){var n,i=d(e),r=i[0];return e=i[1],r&&(r=a(r,t),n=c(r)),r?e=n&&n.normalize?n.normalize(e,s(t)):a(e,t):(e=a(e,t),i=d(e),r=i[0],e=i[1],r&&(n=c(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},f={require:function(e){return l(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:h(e)}}},u=function(e,t,n,a){var s,d,h,u,p,y,b=[],C=typeof n;if(a=a||e,"undefined"===C||"function"===C){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(u=g(t[p],a),d=u.f,"require"===d)b[p]=f.require(e);else if("exports"===d)b[p]=f.exports(e),y=!0;else if("module"===d)s=b[p]=f.module(e);else if(r(m,d)||r(v,d)||r(w,d))b[p]=c(d);else{if(!u.p)throw new Error(e+" missing "+d);u.p.load(u.n,l(a,!0),o(d),{}),b[p]=m[d]}h=n?n.apply(m[e],b):void 0,e&&(s&&s.exports!==i&&s.exports!==m[e]?m[e]=s.exports:h===i&&y||(m[e]=h))}else e&&(m[e]=n)},e=t=p=function(e,t,n,r,a){if("string"==typeof e)return f[e]?f[e](t):c(g(e,t).f);if(!e.splice){if(y=e,y.deps&&p(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=i}return t=t||function(){},"function"==typeof n&&(n=r,r=a),r?u(i,e,t,n):setTimeout(function(){u(i,e,t,n)},4),p},p.config=function(e){return p(e)},e._defined=m,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),r(m,e)||r(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../lib/almond",function(){}),n("views/app/menuItem",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-app-menu-item",initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.render),this.model.on("change",this.render,this)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},events:{"click a":"clickAppMenu"},clickAppMenu:function(e){i.channel("app").trigger("click:menu",e,this.model)},templateHelpers:function(){return{renderDashicons:function(){return this.dashicons?'<span class="dashicons '+this.dashicons+'"></span>':""},renderClasses:function(){var e=this.classes,t=i.channel("app").request("get:currentDomain");return t.get("id")==this.id&&(e+=" active"),e},renderUrl:function(){if(""!=this.url){var e=i.channel("app").request("get:formModel");return this.url+e.get("id")}return"#"},renderTarget:function(){return""!=this.url?"_blank":"_self"},renderDisabled:function(){return this.disabled?"disabled":""}}}});return e}),n("views/app/menu",["views/app/menuItem"],function(e){var t=Marionette.CollectionView.extend({tagName:"div",childView:e,onShow:function(){jQuery(this.el).find("li:last").unwrap()}});return t}),n("views/app/menuButtons",[],function(){var e=Marionette.ItemView.extend({tagName:"span",template:"#tmpl-nf-app-header-action-button",initialize:function(){this.listenTo(i.channel("app"),"change:clean",this.render,this),this.listenTo(i.channel("app"),"change:loading",this.render,this),this.listenTo(i.channel("app"),"response:updateDB",this.bounceIcon,this)},templateHelpers:function(){var e=this;return{renderPublish:function(){if(e.publishWidth?this.publishWidth='style="width:'+e.publishWidth+'px !important"':this.publishWidth="",i.channel("app").request("get:setting","loading"))var t=i.channel("app").request("get:template","#tmpl-nf-add-header-publish-loading");else var t=i.channel("app").request("get:template","#tmpl-nf-app-header-publish-button");return t(this)},maybeDisabled:function(){return i.channel("app").request("get:setting","clean")?"disabled":""},maybeRenderCancel:function(){if(i.channel("app").request("get:setting","clean"))return"";var e=i.channel("app").request("get:template","#tmpl-nf-app-header-view-changes");return e(this)}}},onShow:function(){jQuery(this.el).find(".publish")},events:{"click .publish":"clickPublish","click .viewChanges":"clickViewChanges"},clickPublish:function(e){i.channel("app").trigger("click:publish",e)},clickViewChanges:function(e){i.channel("app").trigger("click:viewChanges",e)},bounceIcon:function(e){jQuery(this.el).find(".dashicons-backup").effect("bounce",{times:3},600)}});return e}),n("views/app/mobileMenuButton",[],function(){var e=Marionette.ItemView.extend({tagName:"span",template:"#tmpl-nf-mobile-menu-button",initialize:function(){this.listenTo(i.channel("app"),"change:clean",this.render,this)},templateHelpers:function(){return{maybeDisabled:function(){return i.channel("app").request("get:setting","clean")?"disabled":""}}},events:{"click .nf-mobile-menu":"clickMobileMenu"},clickMobileMenu:function(e){var t=i.channel("app").request("get:builderEl");jQuery(t).toggleClass("nf-menu-expand")}});return e}),n("views/app/header",["views/app/menu","views/app/menuButtons","views/app/mobileMenuButton"],function(e,t,n){var r=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-app-header",regions:{menu:".nf-app-menu",buttons:".nf-app-buttons",mobileMenuButton:".nf-mobile-menu-button"},onRender:function(){var r=i.channel("app").request("get:domainCollection");this.menu.show(new e({collection:r})),this.buttons.show(new t),this.mobileMenuButton.show(new n)},events:{"click #nf-logo":"clickLogo"},clickLogo:function(e){}});return r}),n("views/app/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-sub-header"});return e}),n("views/app/builderHeader",["views/app/header","views/app/subHeader"],function(e,t){var n=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-header",regions:{app:"#nf-app-header",formTitle:"#nf-app-form-title",appSub:"#nf-app-sub-header"},initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.changeSubHeader)},onShow:function(){this.app.show(new e);var t=i.channel("app").request("get:formModel"),n=t.get("settings"),r=i.channel("views").request("get:formTitle");this.formTitle.show(new r({model:n})),this.changeSubHeader()},changeSubHeader:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("getSubHeaderView").call(e);this.appSub.show(t)}});return n}),n("views/app/main",[],function(){var e=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-main",className:"nf-main-test",maybeDone:!1,offsetRight:!1,offsetLeft:!1,regions:{gutterLeft:"#nf-main-gutter-left",body:"#nf-main-body",gutterRight:"#nf-main-gutter-right"},initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.render),i.channel("app").reply("get:mainEl",this.getMainEl,this),jQuery(window).on("resize",{context:this},this.resizeBothGutters),this.listenTo(i.channel("drawer"),"before:open",this.setBothGuttersAbsolute),this.listenTo(i.channel("drawer"),"opened",this.setBothGuttersFixed),this.listenTo(i.channel("drawer"),"before:close",this.setBothGuttersAbsolute),this.listenTo(i.channel("drawer"),"closed",this.setBothGuttersFixed),i.channel("app").reply("update:gutters",this.updateGutters,this)},onShow:function(){i.channel("main").trigger("show:main",this)},onRender:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("getMainContentView").call(e);this.body.show(t);var n=e.get("getGutterLeftView").call(e);this.gutterLeft.show(n);var r=e.get("getGutterRightView").call(e);this.gutterRight.show(r),i.channel("main").trigger("render:main")},getMainEl:function(){return jQuery(this.el).parent()},onAttach:function(){this.initialGutterResize()},onBeforeDestroy:function(){jQuery(window).off("resize",this.resize)},initialGutterResize:function(){this.resizeGutter(this.gutterLeft.el),this.resizeGutter(this.gutterRight.el),this.setBothGuttersFixed(this)},resizeBothGutters:function(e){var t=e?e.data.context:this,n=t.gutterLeft.el,i=t.gutterRight.el;t.resizeGutter(n,t),t.resizeGutter(i,t),t.setBothGuttersAbsolute(t),clearTimeout(t.maybeDone),t.maybeDone=setTimeout(t.setBothGuttersFixed,100,t)},resizeGutter:function(e,t){var n=jQuery(e).offset().top,i=jQuery(window).height(),r=i-n;jQuery(e).height(r)},setBothGuttersFixed:function(e){e=e||this;var t=jQuery(e.gutterLeft.el).offset(),n=t.top,i=t.left;jQuery(e.gutterLeft.el).css({position:"fixed",left:i,top:n});var t=jQuery(e.gutterLeft.el).offset(),r=jQuery(e.gutterRight.el).offset(),a=r.top,l=r.left;jQuery(e.gutterRight.el).css({position:"fixed",left:l,top:a})},setBothGuttersAbsolute:function(e){e=e||this;var t=(jQuery(e.gutterLeft.el).offset(),jQuery(e.gutterRight.el).offset(),jQuery("#nf-main").scrollTop());jQuery(e.gutterLeft.el).css({position:"absolute",left:0,top:t}),jQuery(e.gutterRight.el).css({position:"absolute",top:t,right:0,left:"auto"})},updateGutters:function(){this.resizeBothGutters()}});return e}),n("views/app/mobileMenuItem",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-mobile-menu-item",onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},events:{"click a":"clickAppMenu"},clickAppMenu:function(e){i.channel("app").trigger("click:menu",e,this.model)},templateHelpers:function(){return{renderDashicons:function(){return this.mobileDashicon?'<span class="dashicons '+this.mobileDashicon+'"></span>':""},renderClasses:function(){var e=this.classes,t=i.channel("app").request("get:currentDomain");return t.get("id")==this.id&&(e+=" active"),e},renderUrl:function(){if(""!=this.url){var e=i.channel("app").request("get:formModel");return this.url+e.get("id")}return"#"},renderTarget:function(){return""!=this.url?"_blank":"_self"},renderDisabled:function(){return this.disabled?"disabled":""}}}});return e}),n("views/app/mobileMenu",["views/app/mobileMenuItem"],function(e){var t=Marionette.CompositeView.extend({tagName:"div",template:"#tmpl-nf-mobile-menu",childView:e,initialize:function(){this.listenTo(i.channel("app"),"change:clean",this.render,this)},attachHtml:function(e,t){jQuery(e.el).find(".secondary").append(t.el)},templateHelpers:function(){return{maybeDisabled:function(){return i.channel("app").request("get:setting","clean")?"disabled":""}}},events:{"click .nf-publish":"clickPublish"},clickPublish:function(e){i.channel("app").trigger("click:publish",e);var t=i.channel("app").request("get:builderEl");jQuery(t).toggleClass("nf-menu-expand")}});return t}),n("views/app/drawer/contentEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-empty"});return e}),n("views/app/drawer",["views/app/drawer/contentEmpty"],function(e){var t=Marionette.LayoutView.extend({template:"#tmpl-nf-drawer",regions:{header:"#nf-drawer-header",content:"#nf-drawer-content",footer:"#nf-drawer-footer"},initialize:function(){i.channel("app").reply("get:drawerEl",this.getEl,this),i.channel("drawer").reply("load:drawerContent",this.loadContent,this),i.channel("drawer").reply("empty:drawerContent",this.emptyContent,this)},onShow:function(){i.channel("app").request("is:mobile")||jQuery(this.el).parent().perfectScrollbar()},loadContent:function(e,t){console.log(t);var n=i.channel("app").request("get:drawer",e),r=n.get("getContentView").call(n,t),a=n.get("getHeaderView").call(n,t),l=n.get("getFooterView").call(n,t);this.header.show(a),this.content.show(r),this.footer.show(l)},emptyContent:function(){this.header.empty(),this.content.empty(),this.footer.empty()},getEl:function(){return jQuery(this.el).parent()},events:{"click .nf-toggle-drawer":"clickToggleDrawer"},clickToggleDrawer:function(){i.channel("app").trigger("click:toggleDrawerSize")}});return t}),n("views/app/drawer/mergeTagItem",[],function(){var e=Marionette.ItemView.extend({tagName:"li",template:"#tmpl-nf-merge-tags-item",onBeforeDestroy:function(){this.model.off("change:active",this.render)},initialize:function(){this.model.on("change:active",this.render,this)},events:{"click a":"clickTag"},clickTag:function(e){i.channel("mergeTags").trigger("click:mergeTag",e,this.model)},templateHelpers:function(){return{renderClasses:function(){if(this.active)return"active"}}}});return e}),n("views/app/drawer/mergeTagsSection",["views/app/drawer/mergeTagItem"],function(e){var t=Marionette.CompositeView.extend({tagName:"div",childView:e,template:"#tmpl-nf-merge-tags-section",initialize:function(){this.collection=this.model.get("tags"),this.model.on("change",this.render,this),"fields"==this.model.get("id")},onBeforeDestroy:function(){if(this.model.off("change",this.render),"fields"==this.model.get("id")){var e=i.channel("fields").request("get:collection");e.off("all",this.updateFields,this)}},attachHtml:function(e,t){jQuery(e.el).find(".merge-tags").append(t.el)},updateFields:function(){var e=i.channel("fields").request("get:collection");this.model.set("tags",e)}});return t}),n("models/app/mergeTagModel",[],function(){var e=Backbone.Model.extend({defaults:{active:!1,exclude:!1}});return e}),n("models/app/mergeTagCollection",["models/app/mergeTagModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("views/app/drawer/mergeTagsContent",["views/app/drawer/mergeTagsSection","models/app/mergeTagCollection"],function(e,t){var n=Marionette.CollectionView.extend({tagName:"div",template:"#tmpl-nf-merge-tags-content",childView:e,initialize:function(){i.channel("mergeTags").reply("get:view",this.getMergeTagsView,this)},reRender:function(e){var n=i.channel("mergeTags").request("get:collection"),r=n.where({default_group:!0});this.collection=new t(r);var a=this,l=e.get("use_merge_tags");"object"==typeof l&&("undefined"!=typeof l.exclude&&_.each(l.exclude,function(e){a.collection.remove(e)}),"undefined"!=typeof l.include&&_.each(n.models,function(e){-1!=l.include.indexOf(e.get("id"))&&a.collection.add(e)})),this.render()},getMergeTagsView:function(){return this}});return n}),n("views/app/builder",["views/app/builderHeader","views/app/main","views/app/mobileMenu","views/app/drawer","views/app/drawer/mergeTagsContent"],function(e,t,n,r,a){var l=Marionette.LayoutView.extend({template:"#tmpl-nf-builder",el:"#nf-builder",regions:{header:"#nf-header",main:"#nf-main",menuDrawer:"#nf-menu-drawer",drawer:"#nf-drawer",mergeTagsContent:".merge-tags-content"},initialize:function(){i.channel("app").reply("get:builderEl",this.getBuilderEl,this),i.channel("app").reply("get:builderView",this.getBuilderView,this),this.render();var l=i.channel("mergeTags").request("get:collection"),s=l.clone();this.mergeTagsContent.show(new a({collection:s})),this.header.show(new e),this.main.show(new t);var o=i.channel("app").request("get:domainCollection");this.menuDrawer.show(new n({collection:o})),this.drawer.show(new r)},onRender:function(){},getBuilderEl:function(){return this.el},getBuilderView:function(){return this},events:{"click .nf-open-drawer":"openDrawer","click .nf-change-domain":"changeDomain","click .nf-close-drawer":"closeDrawer"},openDrawer:function(e){i.channel("app").trigger("click:openDrawer",e)},closeDrawer:function(){i.channel("app").trigger("click:closeDrawer")},changeDomain:function(e){i.channel("app").trigger("click:menu",e)}});return l}),n("controllers/app/remote",[],function(){return Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("setting"),"remote",this.addListener)},addListener:function(e,t){var n=e.get("remote").listen;this.listenTo(i.channel("fieldSetting-"+n),"update:setting",this.updateSetting),this.listenTo(i.channel("actionSetting-"+n),"update:setting",this.updateSetting),this.listenTo(i.channel("setting-type-"+e.get("type")),"click:extra",this.clickExtra),e.listenTo(i.channel("setting-remote"),"get:remote",this.getRemote,e),i.channel("setting-remote").trigger("get:remote",t)},clickExtra:function(e,t,n,r){jQuery(e.srcElement).addClass("spin"),i.channel("setting-remote").trigger("get:remote",n)},updateSetting:function(e,t){i.channel("setting-remote").trigger("get:remote",e)},getRemote:function(e){var t=this.get("remote"),n={parentValue:e.get(t.listen),action:t.action,security:t.security?t.security:nfAdmin.ajaxNonce},i=this;jQuery.post(ajaxurl,n,function(t){var t=JSON.parse(t);"textbox"==i.get("type")&&e.set(i.get("name"),t.value),"select"==i.get("type")&&(i.set("options",t.options),i.trigger("rerender"))})}})}),n("controllers/app/drawer",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:openDrawer",this.clickOpenDrawer),this.listenTo(i.channel("app"),"click:closeDrawer",this.closeDrawer),this.listenTo(i.channel("app"),"click:toggleDrawerSize",this.toggleDrawerSize),i.channel("app").reply("open:drawer",this.openDrawer,this),i.channel("app").reply("close:drawer",this.closeDrawer,this),i.channel("drawer").reply("get:closedRightPos",this.getClosedDrawerPos,this),i.channel("drawer").reply("prevent:close",this.preventClose,this),i.channel("drawer").reply("enable:close",this.enableClose,this),i.channel("drawer").reply("get:preventClose",this.maybePreventClose,this),this.objPreventClose={},this.listenTo(i.channel("drawer"),"filter:focused",this.filterFocused)},closeDrawer:function(){var e=i.channel("app").request("get:currentDrawer");if(!e||this.maybePreventClose())return!1;i.channel("drawer-"+e.get("id")).trigger("before:closeDrawer"),i.channel("drawer").trigger("before:closeDrawer"),i.channel("drawer").trigger("before:close"),i.channel("drawer").request("empty:drawerContent");var t=i.channel("app").request("get:builderEl");jQuery(t).addClass("nf-drawer-closed").removeClass("nf-drawer-opened"),jQuery(t).removeClass("disable-main");var n=this.getClosedDrawerPos(),r=i.channel("app").request("get:drawerEl");jQuery(r).css({right:n});var a=this;this.checkCloseDrawerPos=setInterval(function(){n==jQuery(r).css("right")&&(clearInterval(a.checkCloseDrawerPos),i.channel("app").request("update:currentDrawer",!1),i.channel("drawer").trigger("closed"))},150)},clickOpenDrawer:function(e){var t=jQuery(e.target).data("drawerid");this.openDrawer(t)},openDrawer:function(e,t){if(this.maybePreventClose())return!1;if(t=t||{},"undefined"!=typeof t.model){var n=i.channel("app").request("get:currentDomain"),r=n.get("id");i.channel(r).request("clear:editActive"),t.model.set("editActive",!0),this.dataModel=t.model}i.channel("drawer").request("load:drawerContent",e,t),i.channel("drawer").trigger("before:open");var a=i.channel("app").request("get:builderEl");jQuery(a).addClass("nf-drawer-opened").removeClass("nf-drawer-closed");var l=i.channel("app").request("get:drawerEl");jQuery(l).css({right:"0px"});var s=this;this.hasFocus=!1,this.checkOpenDrawerPos=setInterval(function(){"0px"==jQuery(l).css("right")&&(clearInterval(s.checkOpenDrawerPos),s.hasFocus||(s.focusFilter(),s.hasFocus=!0,i.channel("app").request("update:currentDrawer",e),jQuery(l).scrollTop(0),i.channel("drawer").trigger("opened")))},150)},toggleDrawerSize:function(){var e=i.channel("app").request("get:drawerEl");jQuery(e).toggleClass("nf-drawer-expand")},focusFilter:function(){var e=i.channel("drawer").request("get:filterEl");jQuery(e).focus()},getClosedDrawerPos:function(){var e=i.channel("app").request("get:builderEl"),t=jQuery(e).width()+300;return"-"+t+"px"},maybePreventClose:function(){return 0!=Object.keys(this.objPreventClose).length},preventClose:function(e){this.objPreventClose[e]=!0,this.dataModel.set("drawerDisabled",!0)},enableClose:function(e){delete this.objPreventClose[e],this.maybePreventClose()||this.dataModel.set("drawerDisabled",!1)},filterFocused:function(){clearInterval(this.checkOpenDrawerPos)},getPreventClose:function(){return this.objPreventClose}});return e}),n("views/app/drawer/headerDefault",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-header-default",initialize:function(){this.model&&this.model.on("change:drawerDisabled",this.render,this)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),i.channel("drawer").reply("clear:filter",this.clearFilter,this),i.channel("drawer").reply("blur:filter",this.blurFilter,this),i.channel("drawer").reply("get:filterEl",this.getEl,this)},onBeforeDestroy:function(){this.model&&this.model.off("change:drawerDisabled",this.render)},events:{"keyup .nf-filter":"maybeChangeFilter","input .nf-filter":"changeFilter","focus input":"getFocus"},changeFilter:function(e){var t=i.channel("app").request("get:currentDrawer");i.channel("drawer-"+t.get("id")).trigger("change:filter",e.target.value,e)},maybeChangeFilter:function(e){13==e.keyCode&&(e.addObject=!0,this.changeFilter(e))},clearFilter:function(){var e=jQuery(this.el).find(".nf-filter");""!=jQuery.trim(e.val())&&(e.val(""),e.trigger("input"),e.focus())},blurFilter:function(){jQuery(this.el).find(".nf-filter").blur()},getEl:function(){return jQuery(this.el).find(".nf-filter")},getFocus:function(){i.channel("drawer").trigger("filter:focused")},templateHelpers:function(){return{renderDisabled:function(){return this.drawerDisabled?"disabled":""}}}});return e}),n("views/app/drawer/footerDefault",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-empty"});return e}),n("models/app/drawerModel",["views/app/drawer/headerDefault","views/app/drawer/footerDefault"],function(e,t){var n=Backbone.Model.extend({defaults:{getHeaderView:function(t){return new e(t)},getFooterView:function(e){return new t(e)}}});return n}),n("models/app/drawerCollection",["models/app/drawerModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("views/fields/drawer/stagedField",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-staged-field",onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},events:{"click .dashicons-dismiss":"removeStagedField"},removeStagedField:function(e){i.channel("drawer-addField").trigger("click:removeStagedField",e,this.model)}});return e}),n("views/fields/drawer/stagingEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-staged-fields-empty",onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)}});return e}),n("views/fields/drawer/stagingCollection",["views/fields/drawer/stagedField","views/fields/drawer/stagingEmpty"],function(e,t){var n=Marionette.CollectionView.extend({tagName:"div",childView:e,emptyView:t,activeClass:"nf-staged-fields-active",initialize:function(){i.channel("app").reply("get:stagedFieldsEl",this.getStagedFieldsEl,this)},onShow:function(){this.$el=jQuery(this.el).parent(),jQuery(this.$el).find("span:first").unwrap(),this.setElement(this.$el);jQuery(this.el).sortable({placeholder:"nf-staged-fields-sortable-placeholder",helper:"clone",tolerance:"pointer",over:function(e,t){i.channel("drawer-addField").trigger("over:stagedFields",e,t)},out:function(e,t){i.channel("drawer-addField").trigger("out:stagedFields",t)},receive:function(e,t){i.channel("drawer-addField").trigger("receive:stagedFields",t)},update:function(e,t){i.channel("fields").request("sort:staging")},start:function(e,t){i.channel("drawer-addField").trigger("start:stagedFields",t)},stop:function(e,t){i.channel("drawer-addField").trigger("stop:stagedFields",t)}}),jQuery(this.el).parent().draggable({opacity:.9,connectToSortable:".nf-field-type-droppable",appendTo:"#nf-main",refreshPositions:!0,grid:[3,3],tolerance:"pointer",helper:function(e){var t=jQuery(e.target).parent().width(),n=jQuery(e.target).parent().height(),i=jQuery(e.target).parent().clone(),r=t/4,a=n/2;return jQuery(this).draggable("option","cursorAt",{top:a,left:r}),jQuery(i).zIndex(1e3),i},start:function(e,t){i.channel("drawer-addField").trigger("startDrag:fieldStaging",this,t)},stop:function(e,t){i.channel("drawer-addField").trigger("stopDrag:fieldStaging",this,t)}})},getStagedFieldsEl:function(){return jQuery(this.el)},onAddChild:function(){jQuery(this.el).addClass(this.activeClass)},onRemoveChild:function(){this.hasStagedFields()||jQuery(this.el).removeClass(this.activeClass)},hasStagedFields:function(){return 0!=this.collection.length}});return n}),n("models/fields/stagingModel",[],function(){var e=Backbone.Model.extend({});return e}),n("models/fields/stagingCollection",["models/fields/stagingModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order"});return t}),n("views/fields/drawer/typeSection",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-field-type-section",initialize:function(){_.bindAll(this,"render"),i.channel("fields").reply("get:typeSection",this.getTypeSection,this)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),this.dragging=!1;var e=this;i.channel("app").request("is:mobile")||(jQuery(this.el).find("div.nf-field-type-draggable").draggable({opacity:.9,tolerance:"pointer",connectToSortable:".nf-field-type-droppable",refreshPositions:!0,grid:[5,5],appendTo:"#nf-builder",helper:function(e){var t=jQuery(e.target).parent().width(),n=jQuery(e.target).parent().height(),i=jQuery(e.target).parent().clone(),r=t/4,a=n/2;return jQuery(this).draggable("option","cursorAt",{top:a,left:r}),jQuery(i).zIndex(1e3),i},start:function(t,n){e.dragging=!0,i.channel("drawer-addField").trigger("startDrag:type",this,n)},stop:function(t,n){e.dragging=!1,i.channel("drawer-addField").trigger("stopDrag:type",this,n)},drag:function(e,t){i.channel("drawer-addField").trigger("drag:type",this,t,e)}}).disableSelection(),jQuery(this.el).find(".nf-item").focus(function(){jQuery(this).addClass("active")}).blur(function(){jQuery(this).removeClass("active")}))},events:{"click .nf-item":"clickFieldType","keydown .nf-item":"maybeClickFieldType","mousedown .nf-item":"mousedownFieldType"},clickFieldType:function(e){this.dragging||i.channel("drawer").trigger("click:fieldType",e)},mousedownFieldType:function(e){jQuery(e.target).addClass("clicked"),setTimeout(function(){jQuery(e.target).removeClass("clicked")},1500)},maybeClickFieldType:function(e){13==e.keyCode&&(this.clickFieldType(e),i.channel("drawer").request("clear:filter"))},templateHelpers:function(){return{renderFieldTypes:function(){var e="",t=this;return _.each(this.fieldTypes,function(n){var r=i.channel("fields").request("get:type",n),a=r.get("nicename"),l=r.get("icon"),s=i.channel("app").request("get:template","#tmpl-nf-drawer-field-type-button");e+=s({id:n,nicename:a,icon:l,type:r,savedField:t.savedField})}),e},savedField:function(){return this.type.get("savedField")?"nf-saved":""}}},getTypeSection:function(){return this.el}});return e}),n("views/fields/drawer/typeSectionCollection",["views/fields/drawer/typeSection"],function(e){var t=Marionette.CollectionView.extend({tagName:"div",childView:e,onShow:function(){jQuery(this.el).find(".nf-settings").unwrap(),i.channel("fields").request("clear:editActive")}});return t}),n("views/fields/drawer/addField",["views/fields/drawer/stagingCollection","models/fields/stagingCollection","views/fields/drawer/typeSectionCollection"],function(e,t,n){var r=Marionette.LayoutView.extend({template:"#tmpl-nf-drawer-content-add-field",regions:{staging:"#nf-drawer-staging .nf-reservoir",primary:"#nf-drawer-primary",secondary:"#nf-drawer-secondary"},initialize:function(){this.listenTo(i.channel("drawer"),"filter:fieldTypes",this.filterFieldTypes),this.listenTo(i.channel("drawer"),"clear:filter",this.removeFieldTypeFilter),this.savedCollection=i.channel("fields").request("get:savedFields"),this.primaryCollection=this.savedCollection,this.fieldTypeSectionCollection=i.channel("fields").request("get:typeSections"),this.secondaryCollection=this.fieldTypeSectionCollection},onShow:function(){var t=i.channel("fields").request("get:staging");this.staging.show(new e({collection:t})),this.primary.show(new n({collection:this.primaryCollection})),this.secondary.show(new n({collection:this.secondaryCollection}))},getEl:function(){return jQuery(this.el).parent()},filterFieldTypes:function(e){this.primary.reset(),this.secondary.reset(),this.filteredSectionCollection=e,this.primary.show(new n({collection:this.filteredSectionCollection}))},removeFieldTypeFilter:function(){this.primary.show(new n({collection:this.savedCollection})),this.secondary.show(new n({collection:this.fieldTypeSectionCollection}))}});return r}),n("views/app/drawer/itemSettingCollection",[],function(){var e=Marionette.CollectionView.extend({tagName:"div",initialize:function(e){this.childViewOptions={dataModel:e.dataModel}},getChildView:function(e){return i.channel("app").request("get:settingChildView",e)}});return e}),n("views/app/drawer/itemSettingGroup",["views/app/drawer/itemSettingCollection"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-drawer-content-edit-field-setting-group",regions:{settings:".nf-field-settings"},initialize:function(e){this.model.on("change",this.render,this),this.dataModel=e.dataModel},onBeforeDestroy:function(){this.model.off("change",this.render)},onRender:function(){this.model.get("display")?this.settings.show(new e({collection:this.model.get("settings"),dataModel:this.dataModel})):this.settings.empty(),i.channel("drawer").trigger("render:settingGroup",this)},events:{"click .toggle":"clickToggleGroup"},clickToggleGroup:function(e){i.channel("drawer").trigger("click:toggleSettingGroup",e,this.model)},templateHelpers:function(){return{renderLabel:function(){if(""!=this.label){var e=i.channel("app").request("get:template","#tmpl-nf-drawer-content-edit-setting-group-label");return e(this)}return""},renderArrowDir:function(){return this.display?"down":"right"}}}});return t}),n("views/app/drawer/itemSettingGroupCollection",["views/app/drawer/itemSettingGroup"],function(e){var t=Marionette.CollectionView.extend({tagName:"div",childView:e,initialize:function(e){this.childViewOptions={dataModel:e.dataModel}}});return t}),n("views/app/drawer/editSettings",["views/app/drawer/itemSettingGroupCollection"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-drawer-content-edit-settings",regions:{settingTitle:".nf-setting-title",settingGroups:".nf-setting-groups"},initialize:function(e){this.dataModel=e.model,this.groupCollection=e.groupCollection},onRender:function(){var t=i.channel("app").request("get:currentDomain"),n=t.get("getSettingsTitleView").call(t,{model:this.model});this.settingTitle.show(n),this.settingGroups.show(new e({collection:this.groupCollection,dataModel:this.dataModel}))},templateHelpers:function(){return{maybeRenderTitle:function(){if("undefined"!=typeof this.type){var e=i.channel("app").request("get:template","#tmpl-nf-drawer-content-edit-settings-title");return e(this)}return""},renderTypeNicename:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("id"),n=i.channel(t).request("get:type",this.type);return n.get("nicename")}}}});return t}),n("views/app/drawer/headerEditSettings",[],function(){var e=Marionette.ItemView.extend({
tagName:"div",template:"#tmpl-nf-drawer-header-edit-settings",initialize:function(){this.model&&this.model.on("change:drawerDisabled",this.render,this)},onBeforeDestroy:function(){this.model&&this.model.off("change:drawerDisabled",this.render)},templateHelpers:function(){return{renderDisabled:function(){return this.drawerDisabled?"disabled":""}}}});return e}),n("views/actions/drawer/typeButton",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-action-type-button",onRender:function(){if(this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),jQuery(this.el).disableSelection(),"installed"==this.model.get("section")){var e=this;jQuery(this.el).draggable({opacity:.9,tolerance:"intersect",scroll:!1,helper:"clone",start:function(t,n){e.dragging=!0,i.channel("drawer-addAction").trigger("startDrag:type",this,n)},stop:function(t,n){e.dragging=!1,i.channel("drawer-addAction").trigger("stopDrag:type",this,n)}})}},events:{"click .nf-item":"clickAddAction"},clickAddAction:function(e){this.dragging||("installed"==this.model.get("section")?i.channel("actions").trigger("click:addAction",this.model):window.open(this.model.get("link"),"_blank"))},templateHelpers:function(){return{renderClasses:function(){var e="nf-item";return""!=jQuery.trim(this.image)&&(e+=" nf-has-img"),"installed"==this.section&&(e+=" nf-action-type"),e},renderStyle:function(){return""!=jQuery.trim(this.image)?'style="background-image: url('+this.image+');"':""}}}});return e}),n("views/actions/drawer/typeCollection",["views/actions/drawer/typeButton"],function(e){var t=Marionette.CompositeView.extend({template:"#tmpl-nf-drawer-action-type-section",childView:e,templateHelpers:function(){var e=this;return{renderNicename:function(){return e.collection.nicename},renderClasses:function(){return e.collection.slug}}},attachHtml:function(e,t){jQuery(e.el).find(".action-types").append(t.el)}});return t}),n("views/actions/drawer/addAction",["views/actions/drawer/typeCollection"],function(e){var t=Marionette.LayoutView.extend({template:"#tmpl-nf-drawer-content-add-action",regions:{primary:"#nf-drawer-primary",secondary:"#nf-drawer-secondary"},initialize:function(){this.listenTo(i.channel("drawer"),"filter:actionTypes",this.filteractionTypes),this.listenTo(i.channel("drawer"),"clear:filter",this.removeactionTypeFilter),this.installedActions=i.channel("actions").request("get:installedActions"),this.primaryCollection=this.installedActions,this.availableActions=i.channel("actions").request("get:availableActions"),this.secondaryCollection=this.availableActions},onShow:function(){this.primary.show(new e({collection:this.primaryCollection})),this.secondary.show(new e({collection:this.secondaryCollection}))},getEl:function(){return jQuery(this.el).parent()},filteractionTypes:function(t,n){this.primary.reset(),this.secondary.reset(),this.primary.show(new e({collection:t})),this.secondary.show(new e({collection:n}))},removeactionTypeFilter:function(){this.primary.show(new e({collection:this.installedActions})),this.secondary.show(new e({collection:this.availableActions}))}});return t}),n("views/app/drawer/contentViewChangesItem",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-content-view-changes-item",initialize:function(){this.model.on("change:disabled",this.render,this)},onBeforeDestroy:function(){this.model.off("change:disabled",this.render)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},events:{"click .undoSingle":"undoSingle"},undoSingle:function(e){i.channel("drawer").trigger("click:undoSingle",this.model)}});return e}),n("views/app/drawer/contentViewChanges",["views/app/drawer/contentViewChangesItem"],function(e){var t=Marionette.CollectionView.extend({tagName:"table",className:"nf-changes",childView:e});return t}),n("views/app/drawer/headerViewChanges",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-header-view-changes",events:{"click .undoChanges":"clickUndoChanges"},clickUndoChanges:function(e){i.channel("drawer").trigger("click:undoChanges")}});return e}),n("views/app/drawer/settingError",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-edit-setting-error"});return e}),n("views/app/drawer/itemSetting",["views/app/drawer/mergeTagsContent","views/app/drawer/settingError"],function(e,t){var n=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-edit-setting-wrap",regions:{error:".nf-setting-error"},initialize:function(e){this.dataModel=e.dataModel;var t="undefined"!=typeof i.channel("setting-type-"+this.model.get("type")).request("renderOnChange")&&i.channel("setting-type-"+this.model.get("type")).request("renderOnChange");t&&this.dataModel.on("change:"+this.model.get("name"),this.render,this),this.model.on("change:error",this.renderError,this);var n=this.model.get("deps");if(n)for(var r in n)n.hasOwnProperty(r)&&this.dataModel.on("change:"+r,this.render,this);var a=this.model.get("remote");if(a){if("undefined"!=typeof a.refresh||a.refresh){var l=this.model.get("label");this.model.set("label",l+' <a class="extra"><span class="dashicons dashicons-update"></span></a>')}i.channel("setting").trigger("remote",this.model,this.dataModel,this),this.model.on("rerender",this.render,this)}this.listenTo(i.channel("drawer"),"opened",this.drawerOpened),this.listenTo(i.channel("drawer"),"closed",this.drawerClosed)},onBeforeDestroy:function(){this.dataModel.off("change:"+this.model.get("name"),this.render),this.model.off("change:error",this.renderError);var e=this.model.get("deps");if(e)for(var t in e)e.hasOwnProperty(t)&&this.dataModel.off("change:"+t,this.render);if(this.model.get("remote")&&this.model.off("rerender",this.render,this),i.channel("setting-"+this.model.get("name")).trigger("destroy:setting",this.model,this.dataModel,this),i.channel("setting-type-"+this.model.get("type")).trigger("destroy:setting",this.model,this.dataModel,this),"textbox"==this.model.get("type")){var n=this.model.get("name"),r=this.dataModel.get(n);this.dataModel.set(n,_.unescape(r),{silent:!0})}},onBeforeRender:function(){if("textbox"==this.model.get("type")){var e=this.model.get("name"),t=this.dataModel.get(e);this.dataModel.set(e,_.escape(t),{silent:!0})}i.channel("app").trigger("before:renderSetting",this.model,this.dataModel),i.channel("setting-type-"+this.model.get("type")).trigger("before:renderSetting",this.model,this.dataModel,this),i.channel("setting-"+this.model.get("name")).trigger("before:renderSetting",this.model,this.dataModel,this)},onRender:function(){this.mergeTagsContentView=!1;i.channel("setting-"+this.model.get("name")).trigger("render:setting",this.model,this.dataModel,this),i.channel("setting-type-"+this.model.get("type")).trigger("render:setting",this.model,this.dataModel,this),jQuery(this.el).find(".nf-help").each(function(){var e=jQuery(this).next(".nf-help-text");jQuery(this).jBox("Tooltip",{content:e,maxWidth:200,theme:"TooltipBorder",trigger:"click",closeOnClick:!0})}),this.model.get("use_merge_tags")&&i.channel("mergeTags").request("init",this);var e=this.model.get("mask");if("undefined"!=typeof e){var t=jQuery(this.$el).find("input");switch(e.type){case"numeric":t.autoNumeric({aSep:thousandsSeparator,aDec:decimalPoint});break;case"currency":var n=i.channel("settings").request("get:setting","currency"),r=nfAdmin.currencySymbols[n]||"";t.autoNumeric({aSign:jQuery("<div />").html(r).text(),aSep:thousandsSeparator,aDec:decimalPoint});break;case"custom":e.format&&t.mask(e.format);break;default:console.log('Notice: Mask type of "'+e.type+'" is not supported.')}}this.renderError()},onShow:function(){i.channel("setting-"+this.model.get("name")).trigger("show:setting",this.model,this.dataModel,this),i.channel("setting-type-"+this.model.get("type")).trigger("show:setting",this.model,this.dataModel,this)},onAttach:function(){i.channel("setting-"+this.model.get("name")).trigger("attach:setting",this.model,this.dataModel,this),i.channel("setting-type-"+this.model.get("type")).trigger("attach:setting",this.model,this.dataModel,this)},renderError:function(){this.model.get("error")?(jQuery(this.el).find(".nf-setting").addClass("nf-error"),this.error.show(new t({model:this.model}))):(jQuery(this.el).find(".nf-setting").removeClass("nf-error"),this.error.empty())},templateHelpers:function(){var e=this;return{renderVisible:function(){if(this.deps)for(var t in this.deps)if(this.deps.hasOwnProperty(t)&&e.dataModel.get(t)!=this.deps[t])return'style="display:none;"';return""},renderSetting:function(){"undefined"!=typeof e.dataModel.get(this.name)?this.value=e.dataModel.get(this.name):"undefined"==typeof this.value&&(this.value="");var t=i.channel("app").request("get:template","#tmpl-nf-edit-setting-"+this.type);return t(this)},renderLabelClasses:function(){var e="";return this.use_merge_tags&&(e+=" has-merge-tags"),"rte"==this.type&&(e+=" rte"),e},renderClasses:function(){var e="nf-setting ";return e+="undefined"!=typeof this.width?"nf-"+this.width:" nf-one-half",this.error&&(e+=" nf-error"),e},renderTooltip:function(){return this.help?'<a class="nf-help" href="#"><span class="dashicons dashicons-admin-comments"></span></a><div class="nf-help-text">'+this.help+"</div>":""},renderMergeTags:function(){return this.use_merge_tags&&!this.hide_merge_tags?'<span class="dashicons dashicons-list-view merge-tags"></span>':""},renderPlaceholder:function(){return this.placeholder?'placeholder="'+this.placeholder+'"':""}}},events:{"change .setting":"changeSetting","keyup .setting":"keyUpSetting","click .setting":"clickSetting","click .extra":"clickExtra"},changeSetting:function(e){i.channel("app").trigger("change:setting",e,this.model,this.dataModel)},keyUpSetting:function(e){i.channel("app").trigger("keyup:setting",e,this.model,this.dataModel),i.channel("setting-"+this.model.get("name")).trigger("keyup:setting",e,this.model,this.dataModel)},clickSetting:function(e){i.channel("app").trigger("click:setting",e,this.model,this.dataModel),i.channel("setting-type-"+this.model.get("type")).trigger("click:setting",e,this.model,this.dataModel,this)},clickExtra:function(e){i.channel("setting-type-"+this.model.get("type")).trigger("click:extra",e,this.model,this.dataModel,this),i.channel("setting-type-"+this.model.get("name")).trigger("click:extra",e,this.model,this.dataModel,this),i.channel("setting-name-"+this.model.get("name")).trigger("click:extra",e,this.model,this.dataModel,this)},drawerOpened:function(){i.channel("setting-type-"+this.model.get("type")).trigger("drawer:opened",this.model,this.dataModel,this)},drawerClosed:function(){i.channel("setting-type-"+this.model.get("type")).trigger("drawer:closed",this.model,this.dataModel,this)}});return n}),n("views/app/drawer/contentNewForm",["views/app/drawer/itemSetting"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-drawer-content-new-form",regions:{formName:".new-form-name",formSubmit:".new-form-submit"},onRender:function(){var t=i.channel("settings").request("get:settingModel","title"),n=i.channel("settings").request("get:settingModel","add_submit"),r=i.channel("settings").request("get:settings");this.formName.show(new e({model:t,dataModel:r}));var a=i.channel("fields").request("get:collection"),l=a.findWhere({type:"submit"});"undefined"==typeof l?this.formSubmit.show(new e({model:n,dataModel:r})):r.set("add_submit",0)},events:{"click .publish":"clickPublish"},clickPublish:function(e){i.channel("app").trigger("click:confirmPublish",e)}});return t}),n("views/app/drawer/headerNewForm",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-header-new-form"});return e}),n("controllers/app/drawerConfig",["models/app/drawerCollection","views/fields/drawer/addField","views/app/drawer/editSettings","views/app/drawer/headerEditSettings","views/actions/drawer/addAction","views/app/drawer/contentViewChanges","views/app/drawer/headerViewChanges","views/app/drawer/contentNewForm","views/app/drawer/headerNewForm"],function(e,t,n,r,a,l,s,o,c,d){var h=Marionette.Object.extend({initialize:function(){this.collection=new e([{id:"addField",getContentView:function(e){return new t(e)}},{id:"addAction",getContentView:function(e){return new a(e)}},{id:"editSettings",getHeaderView:function(e){if("undefined"!=typeof e.typeModel)var t=i.channel(e.typeModel.get("id")).request("get:drawerHeaderView")||r;else var t=r;return new t(e)},getContentView:function(e){return new n(e)}},{id:"viewChanges",getHeaderView:function(e){return new s(e)},getContentView:function(e){return new l(e)}},{id:"newForm",getHeaderView:function(e){return new c(e)},getContentView:function(e){return new o(e)}}]),i.channel("app").reply("get:drawerCollection",this.getDrawerCollection,this),i.channel("app").reply("get:drawer",this.getDrawer,this)},getDrawerCollection:function(){return this.collection},getDrawer:function(e){return this.collection.get(e)}});return h}),n("views/app/drawer/defaultSettingsTitle",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-drawer-content-edit-settings-title-default",templateHelpers:function(){return{renderTypeNicename:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("id"),n=i.channel(t).request("get:type",this.type);return"undefined"!=typeof n?n.get("nicename"):""}}}});return e}),n("views/app/empty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-empty"});return e}),n("models/app/domainModel",["views/app/drawer/defaultSettingsTitle","views/app/empty"],function(e,t){var n=Backbone.Model.extend({defaults:{dashicons:"",classes:"",active:!1,url:"",hotkeys:!1,disabled:!1,getSettingsTitleView:function(t){return new e(t)},getDefaultSettingsTitleView:function(t){return new e(t)},getGutterLeftView:function(e){return new t},getGutterRightView:function(e){return new t}}});return n}),n("models/app/domainCollection",["models/app/domainModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("views/fields/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-sub-header-fields"});return e}),n("views/fields/mainContentFieldCollection",[],function(){var e=Marionette.CollectionView.extend({tagName:"div",reorderOnSort:!0,getChildView:function(){return i.channel("views").request("get:fieldItem")},getEmptyView:function(){return i.channel("views").request("get:mainContentEmpty")},initialize:function(){i.channel("fields").reply("get:sortableEl",this.getSortableEl,this),i.channel("fields").reply("init:sortable",this.initSortable,this),i.channel("fields").reply("destroy:sortable",this.destroySortable,this)},onRender:function(){if(this.collection.models.length>0){jQuery(this.el).addClass("nf-field-type-droppable").addClass("nf-fields-sortable");this.initSortable()}i.channel("app").trigger("render:fieldsSortable",this)},getSortableEl:function(){return this.el},initSortable:function(){if(i.channel("app").request("is:mobile"));else;jQuery(this.el).sortable({helper:"clone",cancel:".nf-item-controls",placeholder:"nf-fields-sortable-placeholder",opacity:.95,grid:[5,5],appendTo:"#nf-builder",scrollSensitivity:10,receive:function(e,t){t.item.dropping||i.channel("app").request("receive:fieldsSortable",t)},over:function(e,t){t.item.dropping||i.channel("app").request("over:fieldsSortable",t)},out:function(e,t){t.item.dropping||i.channel("app").request("out:fieldsSortable",t)},start:function(e,t){t.item.dropping||i.channel("app").request("start:fieldsSortable",t)},update:function(e,t){t.item.dropping||i.channel("app").request("update:fieldsSortable",t,this)},stop:function(e,t){t.item.dropping||i.channel("app").request("stop:fieldsSortable",t)}})},destroySortable:function(){jQuery(this.el).sortable("destroy")},onAddChild:function(e){i.channel("fields").request("get:adding")&&(e.$el.hide().show("clip"),i.channel("fields").request("set:adding",!1))}});return e}),n("views/fields/drawer/addSavedField",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-add-saved-field",initialize:function(){this.model.on("change:addSavedLoading",this.renderAddButton,this)},onRender:function(){this.renderAddButton()},renderAddButton:function(){if(this.model.get("addSavedLoading"))var e=i.channel("app").request("get:template","#tmpl-nf-add-saved-field-loading");else var e=i.channel("app").request("get:template","#tmpl-nf-add-saved-field-button");jQuery(this.el).find(".add-button").html(e(this))},onBeforeDestroy:function(){this.model.off("change:addSavedLoading",this.render)},events:{"click .nf-button":"clickAddSavedField"},clickAddSavedField:function(e){i.channel("drawer").trigger("click:addSavedField",e,this.model)}});return e}),n("views/fields/drawer/settingsTitle",["views/fields/drawer/addSavedField"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-drawer-content-edit-settings-title-fields",initialize:function(){this.model.on("change:saved",this.render,this),this.model.on("change:label",this.renderjBoxContent,this)},regions:{addSaved:".nf-add-saved-field"},onBeforeDestroy:function(){this.model.off("change:saved",this.render),this.addSavedjBox.destroy(),this.model.unset("jBox",{silent:!0})},onRender:function(){this.renderjBoxContent();var e=this;this.addSavedjBox=new jBox("Tooltip",{trigger:"click",title:"Add to Saved Fields",position:{x:"left",y:"center"},outside:"x",closeOnClick:"body",onCreated:function(){this.setContent(jQuery(e.el).find(".nf-add-saved-field"))}}),this.addSavedjBox.attach(jQuery(this.el).find(".dashicons")),this.model.set("jBox",this.addSavedjBox,{silent:!0})},renderjBoxContent:function(){this.addSaved&&this.addSaved.show(new e({model:this.model}))},templateHelpers:function(){return{renderTypeNicename:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("id"),n=i.channel(t).request("get:type",this.type),r=n.get("nicename");if(this.saved){var a=i.channel(t).request("get:type",n.get("type"));r+=" - "+a.get("nicename")}return r},renderSavedStar:function(){if(this.saved)var e="filled";else var e="empty";return'<span class="dashicons dashicons-star-'+e+'"></span>'}}}});return t}),n("views/actions/mainHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-main-header-actions",initialize:function(){var e=i.channel("actions").request("get:collection");this.listenTo(e,"add",this.render),this.listenTo(e,"remove",this.render)},onRender:function(){var e=i.channel("actions").request("get:collection");0==e.models.length?jQuery(this.el).hide():jQuery(this.el).show()}});return e}),n("views/actions/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-sub-header-actions"});return e}),n("views/app/itemControls",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-item-controls",initialize:function(){},onRender:function(){this.currentDomain=i.channel("app").request("get:currentDomain")},events:{"mouseover .nf-item-control":"mouseoverItemControl","click .nf-edit-settings":"clickEdit","singletap .nf-edit-settings":"singleTapEdit","click .nf-delete":"clickDelete","click .nf-duplicate":"clickDuplicateField"},clickEdit:function(e){i.channel("app").request("is:mobile")||i.channel("app").trigger("click:edit",e,this.model)},singleTapEdit:function(e){i.channel("app").trigger("click:edit",e,this.model)},clickDelete:function(e){i.channel("app").trigger("click:delete",e,this.model)},clickDuplicateField:function(e){i.channel("app").trigger("click:duplicate",e,this.model)},mouseoverItemControl:function(e){i.channel("app").trigger("mouseover:itemControl",e,this.model)}});return e}),n("views/actions/actionItem",["views/app/itemControls"],function(e){var t=Marionette.LayoutView.extend({tagName:"tr",template:"#tmpl-nf-action-item",regions:{itemControls:".nf-item-controls"},initialize:function(){this.model.on("change:label",this.render,this),this.model.on("change:editActive",this.render,this),this.model.on("change:active",this.maybeDeactivate,this)},onBeforeDestroy:function(){this.model.off("change:label",this.render),this.model.off("change:editActive",this.render),this.model.off("change:active",this.maybeDeactivate)},onRender:function(){this.model.get("editActive")?jQuery(this.el).addClass("active"):jQuery(this.el).removeClass("active"),this.maybeDeactivate(),this.itemControls.show(new e({model:this.model}))},maybeDeactivate:function(){0==this.model.get("active")?jQuery(this.el).addClass("deactivated"):jQuery(this.el).removeClass("deactivated")},events:{"change input":"changeToggle",click:"maybeClickEdit"},maybeClickEdit:function(e){"TR"==jQuery(e.target).parent().prop("tagName")&&i.channel("app").trigger("click:edit",e,this.model)},changeToggle:function(e){var t=i.channel("actions").request("get:settingModel","active");i.channel("app").request("change:setting",e,t,this.model),i.channel("app").request("update:db")},templateHelpers:function(){return{renderToggle:function(){var e=this.label;this.label="",this.value=this.active,this.name=this.id+"-active";var t=i.channel("app").request("get:template","#tmpl-nf-edit-setting-toggle");return t=t(this),this.label=e,t},renderTypeNicename:function(){var e=i.channel("actions").request("get:type",this.type);if("undefined"!=typeof e)return e.get("nicename")},renderTooltip:function(){return this.help?'<a class="nf-help" href="#"><span class="dashicons dashicons-admin-comments"></span></a><div class="nf-help-text">'+this.help+"</div>":""},renderMergeTags:function(){return this.use_merge_tags?'<span class="dashicons dashicons-list-view merge-tags"></span>':""}}}});return t}),n("views/actions/mainContentEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-main-content-actions-empty",onBeforeDestroy:function(){jQuery(this.el).parent().parent().removeClass("nf-actions-empty")},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},onShow:function(){jQuery(this.el).parent().parent().addClass("nf-actions-empty")}});return e}),n("views/actions/mainContent",["views/actions/actionItem","views/actions/mainContentEmpty"],function(e,t){var n=Marionette.CompositeView.extend({template:"#tmpl-nf-action-table",childView:e,emptyView:t,onRender:function(){jQuery(this.el).droppable({accept:".nf-action-type-draggable",activeClass:"nf-droppable-active",hoverClass:"nf-droppable-hover",drop:function(e,t){i.channel("app").request("drop:actionType",e,t)}})},attachHtml:function(e,t){"undefined"!=typeof i.channel("actions").request("get:type",t.model.get("type"))&&jQuery(e.el).find("tbody").append(t.el)}});return n}),n("views/advanced/mainHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-main-header-settings"});return e}),n("views/advanced/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-sub-header-settings"});return e}),n("views/advanced/settingItem",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-form-setting-type",onBeforeDestroy:function(){this.model.off("change:editActive",this.updateActiveClass)},initialize:function(){this.model.on("change:editActive",this.updateActiveClass,this)},events:{click:"clickEdit"},clickEdit:function(e){i.channel("settings").trigger("click:edit",e,this.model)},templateHelpers:function(){return{renderClasses:function(){var e="nf-setting-wrap "+this.id;return this.editActive&&(e+=" active"),e}}},updateActiveClass:function(){this.model.get("editActive")?jQuery(this.el).find(".nf-setting-wrap").addClass("active"):jQuery(this.el).find(".nf-setting-wrap").removeClass("active")}});return e}),n("views/advanced/mainContent",["views/advanced/settingItem"],function(e){var t=Marionette.CollectionView.extend({childView:e});return t}),n("models/fields/fieldModel",[],function(){var e=Backbone.Model.extend({defaults:{objectType:"Field",objectDomain:"fields",editActive:!1,order:999},initialize:function(){if("undefined"!=typeof this.get("type")){this.on("change",this.changeSetting,this);var e=i.channel("fields").request("get:type",this.get("type")),t=e.get("parentType");_.each(e.get("settingDefaults"),function(e,t){"undefined"==typeof this.get(t)&&this.set(t,e,{silent:!0})},this),i.channel("fields").trigger("init:fieldModel",this),i.channel("fields-"+t).trigger("init:fieldModel",this),i.channel("fields-"+this.get("type")).trigger("init:fieldModel",this),this.listenTo(i.channel("app"),"fire:updateFieldKey",this.updateFieldKey)}},changeSetting:function(e,t){i.channel("fieldSetting-"+_.keys(e.changedAttributes())[0]).trigger("update:setting",this,t.settingModel),i.channel("fields").trigger("update:setting",this,t.settingModel),i.channel("app").trigger("update:setting",this,t.settingModel)},updateFieldKey:function(e,t){i.channel("app").trigger("replace:fieldKey",this,e,t)}});return e}),n("models/fields/fieldCollection",["models/fields/fieldModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order",tmpNum:1,initialize:function(){this.on("add",this.addField,this),this.on("remove",this.removeField,this),this.listenTo(this,"add:field",this.addNewField),this.listenTo(this,"append:field",this.appendNewField),this.listenTo(this,"remove:field",this.removeFieldResponse),this.newIDs=[]},addField:function(e){this.newIDs.push(e.get("id"))},removeField:function(e){this.removedIDs=this.removedIDs||{},this.removedIDs[e.get("id")]=e.get("id")},addNewField:function(e){this.add(e)},appendNewField:function(e){if(0==this.length)var t=0;else var t=this.at(this.length-1).get("order")+1;e.set("order",t,{silent:!0}),this.add(e)},removeFieldResponse:function(e){this.remove(e)},fieldExists:function(e){return-1!=this.indexOf(e)}});return t}),n("controllers/app/domainConfig",["models/app/domainCollection","views/fields/subHeader","views/fields/mainContentFieldCollection","views/fields/drawer/settingsTitle","views/actions/mainHeader","views/actions/subHeader","views/actions/mainContent","views/advanced/mainHeader","views/advanced/subHeader","views/advanced/mainContent","views/app/empty","models/fields/fieldCollection"],function(e,t,n,r,a,l,s,o,c,d,h,u){var p=Marionette.Object.extend({initialize:function(){i.channel("formContent").request("add:viewFilter",this.defaultFormContentView,10,this),i.channel("formContent").request("add:loadFilter",this.defaultFormContentLoad,10,this),i.channel("formContentGutters").request("add:leftFilter",this.defaultFormContentGutterView,10,this),i.channel("formContentGutters").request("add:rightFilter",this.defaultFormContentGutterView,10,this),this.collection=new e([{id:"fields",nicename:nfi18n.domainFormFields,hotkeys:{Esc:"close:drawer","Ctrl+Shift+n":"add:newField","Ctrl+Shift+a":"changeDomain:actions","Ctrl+Shift+s":"changeDomain:settings","Alt+Ctrl+t":"open:mergeTags",up:"up:mergeTags",down:"down:mergeTags","Shift+return":"return:mergeTags"},mobileDashicon:"dashicons-menu",getSubHeaderView:function(){return new t},getMainContentView:function(e){var t=i.channel("settings").request("get:setting","formContentData");t||(t=i.channel("settings").request("get:setting","fieldContentsData"));var n=i.channel("formContent").request("get:loadFilters"),r=_.without(n,void 0),a=_.first(r);t=a(t,i.channel("app").request("get:formModel"),!0);var l=i.channel("formContent").request("get:viewFilters"),r=_.without(l,void 0),a=_.first(r);return formContentView=a(),i.channel("settings").request("update:setting","formContentData",t,!0),new formContentView({collection:t})},getSettingsTitleView:function(e){return"fields"==e.model.get("objectDomain")?new r(e):this.get("getDefaultSettingsTitleView").call(this,e)},getGutterLeftView:function(e){var t=i.channel("formContentGutters").request("get:leftFilters"),n=_.without(t,void 0),r=_.first(n);return gutterView=r(),new gutterView},getGutterRightView:function(){var e=i.channel("formContentGutters").request("get:rightFilters"),t=_.without(e,void 0),n=_.first(t);return gutterView=n(),new gutterView}},{id:"actions",nicename:nfi18n.domainActions,hotkeys:{Esc:"close:drawer","Ctrl+Shift+n":"add:newAction","Ctrl+Shift+f":"changeDomain:fields","Ctrl+Shift+s":"changeDomain:settings","Alt+Ctrl+t":"open:mergeTags",up:"up:mergeTags",down:"down:mergeTags","Shift+return":"return:mergeTags"},mobileDashicon:"dashicons-external",getSubHeaderView:function(){return new l},getMainContentView:function(){var e=i.channel("actions").request("get:collection");return new s({collection:e})}},{id:"settings",nicename:nfi18n.domainAdvanced,hotkeys:{Esc:"close:drawer","Ctrl+Shift+f":"changeDomain:fields","Ctrl+Shift+a":"changeDomain:actions","Alt+Ctrl+t":"open:mergeTags",up:"up:mergeTags",down:"down:mergeTags","Shift+return":"return:mergeTags"},mobileDashicon:"dashicons-admin-generic",getSubHeaderView:function(){return new c},getMainContentView:function(){var e=i.channel("settings").request("get:typeCollection");return new d({collection:e})}},{id:"preview",nicename:"Preview Form",classes:"preview",dashicons:"dashicons-visibility",mobileDashicon:"dashicons-visibility",url:nfAdmin.previewurl}]),i.channel("app").trigger("init:domainCollection",this.collection),i.channel("app").reply("get:domainCollection",this.getDomainCollection,this),i.channel("app").reply("get:domainModel",this.getDomainModel,this)},getDomainCollection:function(){return this.collection},getDomainModel:function(e){return this.collection.get(e)},defaultFormContentView:function(e){return n},defaultFormContentLoad:function(e){var t=i.channel("fields").request("get:collection"),n=i.channel("formContent").request("get:loadFilters"),r=_.without(n,void 0);if(1==r.length||"undefined"==typeof e||!0==e instanceof Backbone.Collection)return t;var a=_.map(e,function(e){return t.findWhere({key:e})},this);return new u(a)},defaultFormContentGutterView:function(e){return h}});return p}),n("models/app/appModel",[],function(){var e=Backbone.Model.extend({defaults:{loading:!1},initialize:function(){this.on("change:clean",this.changeStatus,this)},changeStatus:function(){i.channel("app").trigger("change:clean",this.get("clean"))}});return e}),n("controllers/app/data",["models/app/appModel"],function(e){var t=Marionette.Object.extend({initialize:function(){var t=i.channel("app").request("get:domainCollection");this.model=new e({currentDrawer:!1,currentDomain:t.get("fields"),clean:!0});var n=1==nfAdmin.mobile;this.model.set("mobile",n),i.channel("app").reply("is:mobile",this.isMobile,this),i.channel("app").reply("get:data",this.getData,this),i.channel("app").reply("get:setting",this.getSetting,this),i.channel("app").reply("get:currentDomain",this.getCurrentDomain,this),i.channel("app").reply("get:currentDrawer",this.getCurrentDrawer,this),i.channel("drawer").reply("get:current",this.getCurrentDrawer,this),i.channel("app").reply("update:currentDomain",this.updateCurrentDomain,this),i.channel("app").reply("update:currentDrawer",this.updateCurrentDrawer,this),i.channel("app").reply("update:setting",this.updateSetting,this)},updateCurrentDomain:function(e){this.updateSetting("currentDomain",e)},updateSetting:function(e,t){return this.model.set(e,t),!0},getSetting:function(e){return this.model.get(e)},getData:function(){return this.model},getCurrentDomain:function(){return this.model.get("currentDomain")},updateCurrentDrawer:function(e){return this.updateSetting("currentDrawer",e),!0},getCurrentDrawer:function(){var e=this.model.get("currentDrawer");return i.channel("app").request("get:drawer",e)},isMobile:function(){return this.model.get("mobile")}});return t}),n("controllers/app/drawerToggleSettingGroup",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer"),"click:toggleSettingGroup",this.toggleSettingGroup)},toggleSettingGroup:function(e,t){if(t.get("display")){var n=!1;_.each(t.get("settings").models,function(e){e.get("error")&&(n=!0)}),n||t.set("display",!1)}else t.set("display",!0)}});return e}),n("controllers/app/updateDB",[],function(){
var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer"),"closed",this.updateDB),i.channel("app").reply("update:db",this.updateDB,this),i.channel("formContent").request("add:saveFilter",this.defaultSaveFilter,10,this)},updateDB:function(e){if(i.channel("app").request("get:setting","clean"))return!1;if(e=e||"preview","preview"==e)var t="nf_preview_update";else if("publish"==e)var t="nf_save_form";var n=i.channel("app").request("get:formModel");_.each(n.get("fields").models,function(e,t){e.unset("jBox",{silent:!0})});var r=i.channel("settings").request("get:setting","formContentData");r||(r=i.channel("settings").request("get:setting","fieldContentsData"));var a=i.channel("formContent").request("get:saveFilters"),l=_.without(a,void 0),s=_.first(l);if(r=s(r),"publish"==e&&n.get("show_publish_options")){i.channel("app").request("open:drawer","newForm");var o=i.channel("app").request("get:builderEl");return jQuery(o).addClass("disable-main"),!1}var c=i.channel("app").request("get:formModel"),d=JSON.parse(JSON.stringify(c));d.settings.formContentData=r;var h=c.get("fields").removedIDs;_.each(d.fields,function(e){var t=e.id;delete e.id,delete e.parent_id;var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i],delete e[i]);for(var r in n)null!==n[r]&&""!=n[r]||delete n[r];e.settings=n,e.id=t}),d.deleted_fields=h;var h=c.get("actions").removedIDs;_.each(d.actions,function(e){var t=e.id;delete e.id,delete e.parent_id;var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i],delete e[i]);e.settings=n,e.id=t}),d.deleted_actions=h,d=JSON.stringify(d),i.channel("app").trigger("before:updateDB",d),"publish"==e&&(i.channel("app").request("update:setting","loading",!0),i.channel("app").trigger("change:loading"),i.channel("app").request("is:mobile")&&i.channel("notices").request("add","publishing","Your Changes Are Being Published",{autoClose:!1})),jQuery.post(ajaxurl,{action:t,form:d,security:nfAdmin.ajaxNonce},function(t){try{t=JSON.parse(t),t.action=e,i.channel("app").trigger("response:updateDB",t),!i.channel("app").request("is:mobile")&&"preview"==e}catch(e){console.log("Something went wrong!"),console.log(e)}})},defaultSaveFilter:function(e){return e.pluck("key")}});return e}),n("models/app/formModel",[],function(){var e=Backbone.Model.extend({initialize:function(){jQuery.isNumeric(this.get("id"))?this.set("show_publish_options",!1,{silent:!0}):this.set("show_publish_options",!0,{silent:!0})}});return e}),n("controllers/app/formData",["models/app/formModel"],function(e){var t=Marionette.Object.extend({initialize:function(){this.model=new e({id:preloadedFormData.id}),this.model.set("fields",i.channel("fields").request("get:collection")),this.model.set("actions",i.channel("actions").request("get:collection")),this.model.set("settings",i.channel("settings").request("get:settings")),i.channel("app").reply("get:formModel",this.getFormModel,this)},getFormModel:function(){return this.model}});return t}),n("controllers/app/previewLink",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"before:sendChanges",this.disablePreview,this),this.listenTo(i.channel("app"),"response:sendChanges",this.enablePreview,this),this.listenTo(i.channel("app"),"change:clean",this.changePreviewNicename,this)},disablePreview:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("preview");t.set("disabled",!0)},changePreviewNicename:function(e){var t=i.channel("app").request("get:domainCollection"),n=t.get("preview");if(e)var r="Preview Form";else var r="Preview Changes";n.set("nicename",r)},enablePreview:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("preview");t.set("disabled",!1)}});return e}),n("controllers/app/menuButtons",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:publish",this.publish),this.listenTo(i.channel("app"),"click:viewChanges",this.viewChanges)},publish:function(){i.channel("app").request("update:db","publish")},viewChanges:function(){var e=i.channel("changes").request("get:collection");i.channel("app").request("open:drawer","viewChanges",{collection:e})}});return e}),n("models/app/changeModel",[],function(){var e=Backbone.Model.extend({defaults:{disabled:!1}});return e}),n("models/app/changeCollection",["models/app/changeModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:function(e){var t=parseInt(e.cid.replace("c",""));return-t}});return t}),n("controllers/app/trackChanges",["models/app/changeCollection","models/app/changeModel"],function(e,t){var n=Marionette.Object.extend({initialize:function(){this.collection=new e,i.channel("changes").reply("register:change",this.registerChange,this),i.channel("changes").reply("get:collection",this.getCollection,this),this.listenTo(i.channel("app"),"change:clean",this.maybeResetCollection)},registerChange:function(e,n,i,r,a){var a="undefined"!=typeof a?a:{};"undefined"==typeof r.dashicon&&(r.dashicon="admin-generic");var l=new t({action:e,model:n,changes:i,label:r,data:a});return this.collection.add(l),l},getCollection:function(){return this.collection},maybeResetCollection:function(e){e&&this.collection.reset()}});return n}),n("controllers/app/undoChanges",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer"),"click:undoChanges",this.undoChanges,this),this.listenTo(i.channel("drawer"),"click:undoSingle",this.undoSingle,this)},undoChanges:function(){var e=i.channel("changes").request("get:collection");e.sort();var t=this;_.each(e.models,function(e){t.undoSingle(e,!0)}),e.reset(),i.channel("app").request("update:db"),i.channel("app").request("update:setting","clean",!0),i.channel("app").request("close:drawer")},undoSingle:function(e,t){i.channel("changes").request("undo:"+e.get("action"),e,t)}});return e}),n("controllers/app/publishResponse",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"response:updateDB",this.publishResponse)},publishResponse:function(e){return"publish"===e.action&&("undefined"!=typeof e.data.new_ids&&("undefined"!=typeof e.data.new_ids.fields&&_.each(e.data.new_ids.fields,function(e,t){var n=i.channel("fields").request("get:field",t);n&&n.set("id",e)}),"undefined"!=typeof e.data.new_ids.actions&&_.each(e.data.new_ids.actions,function(e,t){var n=i.channel("actions").request("get:action",t);n&&n.set("id",e)}),"undefined"!=typeof e.data.new_ids.forms&&_.each(e.data.new_ids.forms,function(e,t){var n=i.channel("app").request("get:formModel");n.set("id",e),history.replaceState("","","admin.php?page=ninja-forms&form_id="+e)})),i.channel("app").request("update:setting","loading",!1),i.channel("app").trigger("change:loading"),i.channel("app").request("is:mobile")&&i.channel("notices").request("close","publishing"),i.channel("notices").request("add","published","Changes Published"),i.channel("app").trigger("app:published",e),void i.channel("app").request("update:setting","clean",!0))}});return e}),n("controllers/app/changeDomain",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:menu",this.changeAppDomain),i.channel("app").reply("change:currentDomain",this.changeAppDomain,this),i.channel("app").reply("prevent:changeDomain",this.preventChange,this),i.channel("app").reply("enable:changeDomain",this.enableChange,this),this.objPreventChange={}},changeAppDomain:function(e,t){if(this.maybePreventChange())return!1;if("undefined"==typeof t)var n=jQuery(e.target).data("domain"),t=i.channel("app").request("get:domainModel",n);if(i.channel("app").request("get:currentDrawer")&&i.channel("app").request("close:drawer"),0==t.get("url").length){var r=i.channel("app").request("get:mainEl");i.channel("app").request("update:currentDomain",t),jQuery(r).scrollTop(0),i.channel("app").trigger("change:currentDomain",t)}},maybePreventChange:function(){return 0!=Object.keys(this.objPreventChange).length},preventChange:function(e){this.objPreventChange[e]=!0},enableChange:function(e){delete this.objPreventChange[e]}});return e}),n("controllers/app/pushstate",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.changePushState)},changePushState:function(){var e=i.channel("app").request("get:currentDomain");history.pushState(null,null,window.location.href+"&domain="+e.get("id"));var t=/domain=\\d+/,n=window.location.toString(),r=n.replace(t,"");console.log(r)}});return e}),n("controllers/app/hotkeys",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("main"),"render:main",this.changeHotkeys),this.listenTo(i.channel("drawer"),"opened",this.changeHotkeys),this.listenTo(i.channel("drawer"),"render:settingGroup",this.changeHotkeys),this.listenTo(i.channel("hotkeys"),"add:newField",this.addNewField),this.listenTo(i.channel("hotkeys"),"add:newAction",this.addNewAction),this.listenTo(i.channel("hotkeys"),"changeDomain:fields",this.changeDomainFields),this.listenTo(i.channel("hotkeys"),"changeDomain:actions",this.changeDomainActions),this.listenTo(i.channel("hotkeys"),"changeDomain:settings",this.changeDomainSettings),this.listenTo(i.channel("hotkeys"),"close:drawer",this.closeDrawer)},changeHotkeys:function(){var e=i.channel("app").request("get:currentDomain");jQuery(document).off(".nfDomainHotkeys"),jQuery("input").off(".nfDomainHotkeys"),e.get("hotkeys")&&jQuery.each(e.get("hotkeys"),function(e,t){jQuery(document).on("keydown.nfDomainHotkeys",null,e,function(e){i.channel("hotkeys").trigger(t,e)}),jQuery("input").on("keydown.nfDomainHotkeys",null,e,function(e){i.channel("hotkeys").trigger(t,e)}),jQuery("textarea").on("keydown.nfDomainHotkeys",null,e,function(e){i.channel("hotkeys").trigger(t,e)})})},addNewField:function(){"addField"!=i.channel("app").request("get:currentDrawer")?i.channel("app").request("open:drawer","addField"):i.channel("app").request("close:drawer")},addNewAction:function(){"addAction"!=i.channel("app").request("get:currentDrawer")?i.channel("app").request("open:drawer","addAction"):i.channel("app").request("close:drawer")},changeDomainFields:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("fields");i.channel("app").request("change:currentDomain",{},t)},changeDomainActions:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("actions");i.channel("app").request("change:currentDomain",{},t)},changeDomainSettings:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("settings");i.channel("app").request("change:currentDomain",{},t)},closeDrawer:function(){i.channel("app").request("close:drawer")}});return e}),n("controllers/app/cleanState",[],function(){var e=Marionette.Object.extend({initialize:function(){this.ignoreAttributes=["editActive"],this.listenTo(i.channel("app"),"update:setting",this.setAppClean)},setAppClean:function(e){for(var t in e.changedAttributes())var n=t,r=e.changedAttributes()[t];i.channel("undo-"+e.get("type")).request("ignore:attributes",this.ignoreAttributes)||this.ignoreAttributes;return-1==this.ignoreAttributes.indexOf(t)&&void i.channel("app").request("update:setting","clean",!1)}});return e}),n("controllers/app/coreUndo",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("changes").reply("undo:changeSetting",this.undoChangeSetting,this),i.channel("changes").reply("undo:addObject",this.undoAddObject,this),i.channel("changes").reply("undo:removeObject",this.undoRemoveObject,this),i.channel("changes").reply("undo:duplicateObject",this.undoDuplicateObject,this),i.channel("changes").reply("undo:sortFields",this.undoSortFields,this),i.channel("changes").reply("undo:addListOption",this.undoAddListOption,this),i.channel("changes").reply("undo:removeListOption",this.undoRemoveListOption,this),i.channel("changes").reply("undo:sortListOptions",this.undoSortListOptions,this)},undoChangeSetting:function(e,t){var n=e.get("model"),i=e.get("changes"),r=i.attr,a=i.before;n.set(r,a),this.maybeRemoveChange(e,t)},undoAddObject:function(e,t){var n=e.get("model"),r=e.get("data").collection;if("undefined"!=typeof r.newIDs&&delete r.newIDs[n.get("id")],!t){var a=i.channel("changes").request("get:collection"),l=a.where({model:n});_.each(l,function(t){t!==e&&a.remove(t)})}r.remove(n),this.maybeRemoveChange(e,t)},undoDuplicateObject:function(e,t){var n=e.get("model"),r=e.get("data").collection;if(!t){var a=i.channel("changes").request("get:collection"),l=a.where({model:n});_.each(l,function(t){t!==e&&a.remove(t)})}r.remove(n),this.maybeRemoveChange(e,t)},undoRemoveObject:function(e,t){var n=e.get("model"),r=e.get("data").collection;if(i.channel(n.get("objectDomain")).request("add",n),delete r.removedIDs[n.get("id")],!t){var a=i.channel("changes").request("get:collection"),l=a.where({model:n});_.each(l,function(t){t!==e&&t.set("disabled",!1)})}r.trigger("reset",r),this.maybeRemoveChange(e,t)},undoSortFields:function(e,t){var n=e.get("data"),r=n.fields,a=i.channel("fields").request("get:collection");_.each(r,function(e){var t=e.before,n=e.model;n.set("order",t)}),a.sort(),this.maybeRemoveChange(e,t)},undoAddListOption:function(e,t){var n=e.get("model");if(!t){var r=i.channel("changes").request("get:collection"),a=r.where({model:n});_.each(a,function(t){t!==e&&r.remove(t)})}n.collection.remove(n),this.maybeRemoveChange(e,t)},undoRemoveListOption:function(e,t){var n=e.get("model"),r=e.get("data").collection;if(r.add(n),!t){var a=i.channel("changes").request("get:collection"),l=a.where({model:n});_.each(l,function(t){t!==e&&t.set("disabled",!1)})}this.maybeRemoveChange(e,t)},undoSortListOptions:function(e,t){var n=e.get("data"),i=n.collection,r=n.objModels;_.each(r,function(e){var t=e.before,n=e.model;n.set("order",t)}),i.sort(),this.maybeRemoveChange(e,t)},maybeRemoveChange:function(e,t){var t="undefined"!=typeof t&&t;if(!t){i.channel("app").request("update:db");var n=i.channel("changes").request("get:collection");n.remove(e),0==n.length&&(i.channel("app").request("update:setting","clean",!0),i.channel("app").request("close:drawer"))}}});return e}),n("controllers/app/cloneModelDeep",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("app").reply("clone:modelDeep",this.cloneModelDeep,this)},cloneModelDeep:function(e){var t={};_.each(e.attributes,function(e,n){if(e instanceof Backbone.Collection){var r=i.channel("app").request("clone:collectionDeep",e);t[n]=r}else e instanceof Backbone.Model&&(t[n]=this.cloneModelDeep(e))},this);var n=e.clone();return _.each(t,function(e,t){n.set(t,e)}),n}});return e}),n("controllers/app/getSettingChildView",["views/app/drawer/itemSetting"],function(e){var t=Marionette.Object.extend({initialize:function(){i.channel("app").reply("get:settingChildView",this.getSettingChildView,this)},getSettingChildView:function(t){var n=t.get("type"),r=i.channel(n).request("get:settingChildView",t)||e;return r}});return t}),n("controllers/app/changeSettingDefault",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("app").reply("change:setting",this.changeSetting,this),this.listenTo(i.channel("app"),"change:setting",this.changeSetting,this)},changeSetting:function(e,t,n,r){var a=t.get("name"),l=n.get(a),r=r||null;r||(r=i.channel(t.get("type")).request("before:updateSetting",e,n,a,t)),"undefined"==typeof r&&(r=jQuery(e.target).val()),n.set(a,r,{settingModel:t}),i.channel("setting-"+a,"after:updateSetting",n,t);var s=r,o={attr:a,before:l,after:s},c=i.channel("app").request("get:currentDomain"),d=(c.get("id"),{object:n.get("objectType"),label:n.get("label"),change:"Changed "+t.get("label")+" from "+l+" to "+s});i.channel("changes").request("register:change","changeSetting",n,o,d)}});return e}),n("views/app/drawer/typeSettingFieldset",["views/app/drawer/itemSetting"],function(e){var t=Marionette.CompositeView.extend({template:"#tmpl-nf-edit-setting-wrap",childView:e,initialize:function(e){this.collection=this.model.get("settings"),this.childViewOptions={dataModel:e.dataModel},this.dataModel=e.dataModel;var t=this.model.get("deps");if(t)for(var n in t)t.hasOwnProperty(n)&&this.dataModel.on("change:"+n,this.render,this)},onBeforeDestroy:function(){var e=this.model.get("deps");if(e)for(var t in e)e.hasOwnProperty(t)&&this.dataModel.off("change:"+t,this.render)},onRender:function(){},templateHelpers:function(){var e=this;return{renderVisible:function(){if(this.deps)for(var t in this.deps)if(this.deps.hasOwnProperty(t)&&e.dataModel.get(t)!==this.deps[t])return'style="display:none;"';return""},renderSetting:function(){var e=i.channel("app").request("get:template","#tmpl-nf-edit-setting-"+this.type);return e(this)},renderClasses:function(){var e="";return e+="undefined"!=typeof this.width?this.width:" one-half",this.error&&(e+=" nf-error"),e},renderError:function(){return this.error?this.error:""}}},attachHtml:function(e,t){jQuery(e.el).find(".nf-field-sub-settings").append(t.el)}});return t}),n("models/app/settingModel",[],function(){var e=Backbone.Model.extend({defaults:{settings:!1,hide_merge_tags:!1,error:!1},initialize:function(){i.channel("app").trigger("init:settingModel",this),i.channel(this.get("type")).trigger("init:settingModel",this),i.channel("setting-name-"+this.get("name")).trigger("init:settingModel",this),this.on("change:error",this.maybePreventUI,this),"undefined"!=typeof this.collection&&this.get("use_merge_tags")&&"undefined"!=typeof this.collection.options.objectType&&this.listenTo(i.channel("app"),"update:fieldKey",this.updateKey)},updateKey:function(e){i.channel("app").trigger("fire:updateFieldKey",e,this)},maybePreventUI:function(){this.get("error")?(i.channel("drawer").request("prevent:close","setting-"+this.get("name")+"-error"),i.channel("app").request("prevent:changeDomain","setting-"+this.get("name")+"-error")):(i.channel("drawer").request("enable:close","setting-"+this.get("name")+"-error"),i.channel("app").request("enable:changeDomain","setting-"+this.get("name")+"-error"))}});return e}),n("models/app/settingCollection",["models/app/settingModel"],function(e){var t=Backbone.Collection.extend({model:e,initialize:function(e,t){this.options=t||{}}});return t}),n("controllers/app/fieldset",["views/app/drawer/typeSettingFieldset","models/app/settingCollection"],function(e,t){var n=Marionette.Object.extend({initialize:function(){i.channel("fieldset").reply("get:settingChildView",this.getSettingChildView,this),this.listenTo(i.channel("fieldset"),"init:settingModel",this.createSettingsCollection)},getSettingChildView:function(t){return e},createSettingsCollection:function(e){e.set("settings",new t(e.get("settings")))}});return n}),n("controllers/app/toggleSetting",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("setting-type-toggle").reply("renderOnChange",function(){return!1}),i.channel("toggle").reply("before:updateSetting",this.updateSetting,this)},updateSetting:function(e,t,n,i){if(jQuery(e.target).attr("checked"))var r=1;else var r=0;return r}});return e}),n("controllers/app/itemControls",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:edit",this.clickEdit),this.listenTo(i.channel("app"),"click:delete",this.clickDelete),this.listenTo(i.channel("app"),"click:duplicate",this.clickDuplicate)},clickEdit:function(e,t){var n=i.channel("app").request("get:currentDomain"),r=n.get("id"),a=i.channel(r).request("get:type",t.get("type"));i.channel("app").request("open:drawer","editSettings",{model:t,groupCollection:a.get("settingGroups")})},clickDelete:function(e,t){var n=i.channel("app").request("clone:modelDeep",t),r={object:t.get("objectType"),label:t.get("label"),change:"Removed",dashicon:"dismiss"},a={collection:t.collection},l=i.channel("changes").request("get:collection"),s=l.where({model:t});_.each(s,function(e){var i=e.get("data");"undefined"!=typeof i.fields&&_.each(i.fields,function(e,r){e.model==t&&(i.fields[r].model=n)}),e.set("data",i),e.set("model",n),e.set("disabled",!0)}),i.channel("changes").request("register:change","removeObject",n,null,r,a);var o=i.channel("app").request("get:currentDomain"),c=o.get("id");i.channel(c).request("delete",t)},clickDuplicate:function(e,t){var n=i.channel("app").request("clone:modelDeep",t),r=i.channel("app").request("get:currentDomain"),a=r.get("id");n.set("label",n.get("label")+" Copy");var l=i.channel(a).request("get:tmpID");n.set("id",l),i.channel(a).request("add",n,!1,!1,"duplicate");var s={object:t.get("objectType"),label:t.get("label"),change:"Duplicated",dashicon:"admin-page"},o={collection:i.channel(a).request("get:collection")};i.channel("changes").request("register:change","duplicateObject",n,null,s,o),t.trigger("change:label",t),i.channel("app").request("update:db")}});return e}),n("controllers/app/mergeTags",["models/app/mergeTagCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.tagSectionCollection=new e;var t=this;_.each(mergeTags,function(n){if(n.tags)var i=new e(n.tags);else var i="";t.tagSectionCollection.add({id:n.id,label:n.label,tags:i,default_group:n.default_group})});var n=this.tagSectionCollection.get("fields").get("tags"),r=i.channel("fields").request("get:collection");_.each(r.models,function(e){"submit"!==e.get("type")&&n.add({id:e.get("id"),label:e.get("label"),tag:t.getFieldKeyFormat(e.get("key"))})});var a=new e,l=i.channel("app").request("get:formModel"),s=l.get("settings").get("calculations");_.each(s.models,function(e){a.add({label:e.get("name"),tag:"{calc:"+e.get("name")+"}"})}),this.tagSectionCollection.get("calcs").set("tags",a),this.currentElement={},this.settingModel={},this.open=!1,i.channel("mergeTags").reply("init",this.initMergeTags,this),this.listenTo(i.channel("mergeTags"),"click:mergeTag",this.clickMergeTag),this.listenTo(i.channel("fields"),"add:field",this.addFieldTags),this.listenTo(i.channel("fields"),"delete:field",this.deleteFieldTags),this.listenTo(i.channel("option-repeater-calculations"),"update:option",this.updateCalcTags),this.listenTo(i.channel("option-repeater-calculations"),"remove:option",this.updateCalcTags),i.channel("mergeTags").reply("update:currentElement",this.updateCurrentElement,this),i.channel("mergeTags").reply("update:currentSetting",this.updateCurrentSetting,this),i.channel("mergeTags").reply("get:collection",this.getCollection,this),i.channel("mergeTags").reply("get:mergeTag",this.getSectionModel,this),this.listenTo(i.channel("fieldSetting-key"),"update:setting",this.updateKey),this.listenTo(i.channel("app"),"replace:fieldKey",this.replaceFieldKey),i.channel("app").reply("get:fieldKeyFormat",this.getFieldKeyFormat,this)},initMergeTags:function(e){var t=i.channel("mergeTags").request("get:view"),n=this;this.jBoxes={};var n=this;jQuery(e.el).find(".merge-tags").each(function(){if("undefined"==typeof jQuery(this).data("jBox-id")){var i=jQuery(this).jBox("Tooltip",{title:"Insert Merge Tag",trigger:"click",position:{x:"center",y:"bottom"},closeOnClick:"body",closeOnEsc:!0,theme:"TooltipBorder",maxHeight:200,onOpen:function(){t.reRender(e.model),this.setContent(jQuery(".merge-tags-content"));var i=jQuery(this.target).prev(".setting");0==i.length&&(i=jQuery(e.el).find(".setting")),n.updateCurrentSetting(e.model),n.updateCurrentElement(i)},onClose:function(){}});jQuery(this).data("jBox-id",i.id)}})},clickMergeTag:function(e,t){if("undefined"!=typeof this.settingModel.get("settingModel")&&"calculations"==this.settingModel.get("settingModel").get("name")){console.log(t);var n=jQuery(this.currentElement).val(),i=jQuery(this.currentElement).caret(),r=i+t.get("tag").length,a="undefined"!=typeof t.get("calcTag")?t.get("calcTag"):t.get("tag");n=n.substr(0,i)+a+n.substr(i),jQuery(this.currentElement).val(n).caret(r).trigger("change")}else if("rte"==this.settingModel.get("type"))jQuery(this.currentElement).summernote("insertText",t.get("tag"));else{var n=jQuery(this.currentElement).val(),i=jQuery(this.currentElement).caret(),r=i+t.get("tag").length;n=n.substr(0,i)+t.get("tag")+n.substr(i),jQuery(this.currentElement).val(n).caret(r).trigger("change")}},addFieldTags:function(e){"submit"!==e.get("type")&&this.tagSectionCollection.get("fields").get("tags").add({id:e.get("id"),label:e.get("label"),tag:this.getFieldKeyFormat(e.get("key")),calcTag:this.getFieldKeyFormatCalc(e.get("key"))})},deleteFieldTags:function(e){var t=e.get("id"),n=this.tagSectionCollection.get("fields").get("tags").get(t);this.tagSectionCollection.get("fields").get("tags").remove(n)},updateCalcTags:function(t){var n=new e,r=i.channel("app").request("get:formModel"),a=r.get("settings").get("calculations");_.each(a.models,function(e){n.add({label:e.get("name"),tag:"{calc:"+e.get("name")+"}"})}),this.tagSectionCollection.get("calcs").set("tags",n)},openMergeTags:function(e){"TEXTAREA"!=jQuery(e.target)[0].tagName&&"INPUT"!=jQuery(e.target)[0].tagName||jQuery(e.target).parent().find(".merge-tags").click()},returnMergeTags:function(e){if(this.open){e.preventDefault();var t=this.fields.where({active:!0})[0];t&&this.clickMergeTag(e,t)}},upMergeTags:function(e){this.open&&(e.preventDefault(),this.changeActiveTag("up"))},downMergeTags:function(e){this.open&&(e.preventDefault(),this.changeActiveTag("down"))},changeActiveTag:function(e){if("down"==e)var t=1;else var t=-1;if(0<this.fields.where({active:!0}).length){var n=this.fields.where({active:!0})[0],i=this.fields.indexOf(n);n.set("active",!1);var r=this.fields.models[i+t];r&&r.set("active",!0)}else 0<this.fields.where({active:!0})?console.log("system"):0<this.userInfo.where({active:!0})?console.log("userinfo"):0<this.fields.models.length?this.fields.models[0].set("active",!0):this.system.models[0].set("active",!0)},updateCurrentElement:function(e){this.currentElement=e},updateCurrentSetting:function(e){this.settingModel=e},getCollection:function(){return this.tagSectionCollection},getSectionModel:function(e){return this.tagSectionCollection.get(e)},updateOpen:function(e){this.open=e,_.each(this.tagSectionCollection.get("fields").models,function(e){e.set("active",!1)})},updateKey:function(e){var t=e.get("key"),n=this.tagSectionCollection.get("fields").get("tags").get(e.get("id"));"undefined"!=typeof n&&n.set("tag",this.getFieldKeyFormat(t))},getFieldKeyFormat:function(e){return"{field:"+e+"}"},getFieldKeyFormatCalc:function(e){return"{field:"+e+":calc}"},replaceFieldKey:function(e,t,n){var i=this.getFieldKeyFormat(t._previousAttributes.key),r=this.getFieldKeyFormat(t.get("key")),a=n.get("name"),l=e.get(a);if("string"==typeof l){var s=new RegExp(i,"g");newVal=l.replace(s,r),e.set(a,newVal)}}});return t}),n("controllers/app/itemSettingFill",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"before:renderSetting",this.beforeRenderSetting)},beforeRenderSetting:function(e,t){"fields"==e.get("fill")}});return e}),n("controllers/app/confirmPublish",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:confirmPublish",this.confirmPublish)},confirmPublish:function(){var e=i.channel("app").request("get:formModel");1==e.get("settings").get("add_submit")&&i.channel("fields").request("add",{type:"submit",label:"Submit",order:9999}),e.set("show_publish_options",!1),i.channel("app").request("update:db","publish")}});return e}),n("controllers/app/rte",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("setting-type-rte").reply("renderOnChange",function(){return!1}),this.listenTo(i.channel("rte"),"init:settingModel",this.initSettingModel),this.listenTo(i.channel("setting-type-rte"),"render:setting",this.renderSetting),this.listenTo(i.channel("setting-type-rte"),"destroy:setting",this.destroySetting),this.listenTo(i.channel("setting-type-rte"),"click:extra",this.clickExtra),this.meta_image_frame,jQuery.summernote.options.icons={align:"dashicons dashicons-editor-alignleft",alignCenter:"dashicons dashicons-editor-aligncenter",alignJustify:"dashicons dashicons-editor-justify",alignLeft:"dashicons dashicons-editor-alignleft",alignRight:"dashicons dashicons-editor-alignright",indent:"dashicons dashicons-editor-indent",outdent:"dashicons dashicons-editor-outdent",bold:"dashicons dashicons-editor-bold",caret:"dashicons dashicons-arrow-down",close:"dashicons dashicons-dismiss",code:"dashicons dashicons-editor-code",eraser:"dashicons dashicons-editor-removeformatting",italic:"dashicons dashicons-editor-italic",link:"dashicons dashicons-admin-links",unlink:"dashicons dashicons-editor-unlink",magic:"dashicons dashicons-editor-paragraph",minus:"dashicons dashicons-minus",orderedlist:"dashicons dashicons-editor-ol",redo:"dashicons dashicons-redo",square:"dashicons fa-square",table:"dashicons dashicons-editor-table",underline:"dashicons dashicons-editor-underline",undo:"dashicons dashicons-undo",unorderedlist:"dashicons dashicons-editor-ul"},this.currentContext={}},initSettingModel:function(e){e.set("hide_merge_tags",!0)},initRTE:function(e,t,n){var i=this,r=function(e){return i.linkButton(e)},a=function(e){return i.mediaButton(e)},l=this.mergeTags(),s=[["paragraphStyle",["style"]],["fontStyle",["bold","italic","underline","clear"]],["lists",["ul","ol"]],["paragraph",["paragraph"]],["customGroup",["linkButton","unlink"]],["table",["table"]],["actions",["undo","redo"]],["tools",["mediaButton","mergeTags","codeview"]]];jQuery(n.el).find("div.setting").summernote({toolbar:s,buttons:{linkButton:r,mergeTags:l,mediaButton:a},height:150,codemirror:{theme:"monokai",lineNumbers:!0,callbacks:{onBlur:function(n){var r=n.getValue();i.updateDataModel(e,t,r)}}},prettifyHtml:!0,callbacks:{onBlur:function(){var n=jQuery(this).summernote("code");i.updateDataModel(e,t,n)}}})},updateDataModel:function(e,t,n){var r=e.get("name"),a=t.get(r),l=n,s={attr:r,before:a,after:l},o={object:t.get("objectType"),label:t.get("label"),change:"Changed "+e.get("label")+" from "+a+" to "+l};i.channel("changes").request("register:change","changeSetting",t,s,o),t.set(e.get("name"),l)},renderSetting:function(e,t,n){this.initRTE(e,t,n);var i=jQuery(n.el).find(".link-button").next(".dropdown-menu").find("button");i.replaceWith(function(){return jQuery("<div/>",{class:jQuery(i).attr("class"),html:this.innerHTML})})},destroySetting:function(e,t,n){this.removeRTE(e,t,n)},removeRTE:function(e,t,n){jQuery(n.el).find("div.setting").summernote("destroy")},drawerOpened:function(e,t,n){this.initRTE(e,t,n)},linkButton:function(e){var t=this,n=jQuery.summernote.ui,r=i.channel("app").request("get:template","#tmpl-nf-rte-link-button"),a=i.channel("app").request("get:template","#tmpl-nf-rte-link-dropdown");return n.buttonGroup([n.button({className:"dropdown-toggle link-button",contents:r({}),tooltip:"Insert Link",click:function(n){t.clickLinkButton(n,e)},data:{toggle:"dropdown"}}),n.dropdown([n.buttonGroup({children:[n.button({contents:a({}),tooltip:""})]})])]).render()},mergeTags:function(e){var t=jQuery.summernote.ui,n=i.channel("app").request("get:template","#tmpl-nf-rte-merge-tags-button");return t.button({className:"dropdown-toggle merge-tags",contents:n({}),tooltip:"Merge Tags"}).render()},mediaButton:function(e){var t=this,n=jQuery.summernote.ui,r=i.channel("app").request("get:template","#tmpl-nf-rte-media-button");return n.button({className:"dropdown-toggle",contents:r({}),tooltip:"Insert Media",click:function(n){t.openMediaManager(n,e)}}).render()},openMediaManager:function(e,t){if(t.invoke("editor.saveRange"),this.meta_image_frame)return void this.meta_image_frame.open();this.meta_image_frame=wp.media.frames.meta_image_frame=wp.media({title:"Select a file",button:{text:"insert"}});var n=this;this.meta_image_frame.on("select",function(){var e=n.meta_image_frame.state().get("selection").first().toJSON();n.insertMedia(e,t)}),this.meta_image_frame.open()},clickLinkButton:function(e,t){var n=t.invoke("editor.createRange");t.invoke("editor.saveRange");var i=n.toString();this.currentContext=t,
jQuery(e.target).closest(".note-customGroup > .note-btn-group").on("hide.bs.dropdown",function(e){return!1}),jQuery(e.target).closest(".note-customGroup > .note-btn-group").on("shown.bs.dropdown",function(e){jQuery(e.target).parent().parent().find(".link-text").val(i),jQuery(e.target).parent().parent().find(".link-url").focus()})},clickExtra:function(e,t,n,i){var r=jQuery(e.target).parent().find(".link-text"),a=jQuery(e.target).parent().find(".link-url"),l=jQuery(e.target).parent().find(".link-new-window");if(this.currentContext.invoke("editor.restoreRange"),jQuery(e.target).hasClass("insert-link")){var s=r.val(),o=a.val(),c=!!l.prop("checked");0!=s.length&&0!=o.length&&this.currentContext.invoke("editor.createLink",{text:s,url:o,isNewWindow:c})}r.val(""),a.val(""),l.prop("checked",!1),jQuery(e.target).closest("div.note-btn-group.open").removeClass("open")},insertMedia:function(e,t){t.invoke("editor.restoreRange"),"image"==e.type?t.invoke("editor.insertImage",e.url):t.invoke("editor.createLink",{text:e.filename,url:e.url})}});return e}),n("controllers/app/settingFieldSelect",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("field-select"),"init:settingModel",this.trackKeyChanges),this.listenTo(i.channel("setting-type-field-select"),"before:renderSetting",this.beforeRender),this.listenTo(i.channel("field-select"),"init:settingModel",function(){this.listenTo(i.channel("app"),"change:setting",this.maybeSwitchToFieldsDomain)}),this.listenTo(i.channel("app"),"change:currentDomain",this.autoOpenDrawer),this.listenTo(i.channel("drawer"),"opened",this.filterDrawerContents),this.listenTo(i.channel("drawer"),"closed",this.SwitchToFieldsDomain)},trackKeyChanges:function(e){e.listenTo(i.channel("app"),"update:fieldKey",e.updateKey),this.listenTo(i.channel("app"),"replace:fieldKey",this.updateFieldMap)},updateFieldMap:function(e,t,n){var i=t._previousAttributes.key,r=t.get("key");"field-select"==n.get("type")&&e.get(n.get("name"))==i&&e.set(n.get("name"),r)},beforeRender:function(e,t){var n=i.channel("fields").request("get:collection"),r=e.get("field_types"),a=[{label:"--",value:0}];_.each(n.models,function(n){if(t.cid!=n.cid&&("undefined"==typeof r||0==r.length||_.contains(r,n.get("type")))){var i=e.get("field_filter");if(i&&"undefined"!=typeof i[n.get("type")]){var l=!1;if(_.each(i[n.get("type")],function(e,t){console.log(e+":"+n.get(t)),e!=n.get(t)&&(l=!0)}),l)return}var s=n.get("key");switch(e.get("field_value_format")){case"key":s=n.get("key");break;case"merge_tag":default:s="{field:"+n.get("key")+"}"}a.push({label:n.get("label"),value:s})}}),"undefined"!=typeof r&&0!=r.length&&_.each(r,function(e){var t=i.channel("fields").request("get:type",e);a.push({label:"-- Add "+t.get("nicename")+" Field",value:"addField:"+e})}),e.set("options",a)},maybeSwitchToFieldsDomain:function(e,t,n){if("field-select"==t.get("type")){var r=t.get("name"),a=n.get(r),l=a.split(":");"addField"==l[0]&&(this.openDrawer="addField",this.filterDrawer=l[1],n.set(r,""),this.switchDomain=!0,i.channel("app").request("close:drawer"))}},SwitchToFieldsDomain:function(){if(this.switchDomain){var e=i.channel("app").request("get:domainModel","fields");i.channel("app").request("change:currentDomain",null,e),this.switchDomain=null}},autoOpenDrawer:function(){this.openDrawer&&(i.channel("app").request("open:drawer",this.openDrawer),this.openDrawer=null)},filterDrawerContents:function(){this.filterDrawer&&(i.channel("drawer-addField").trigger("change:filter",this.filterDrawer),this.filterDrawer=null)}});return e}),n("controllers/app/settingFieldList",["views/app/drawer/typeSettingFieldset","models/app/settingCollection"],function(e,t){return Marionette.Object.extend({fieldListSettings:[],initialize:function(){this.listenTo(i.channel("field-list"),"init:settingModel",this.registerFieldListSettings),this.listenTo(i.channel("fields"),"update:setting",this.updateFieldListSettingKeys),i.channel("field-list").reply("get:settingChildView",this.getSettingChildView,this)},registerFieldListSettings:function(e){this.fieldListSettings.push(e.get("name"))},updateFieldListSettingKeys:function(e){if("undefined"!=typeof e.changed.key){var t=e._previousAttributes.key,n=e.changed.key,i=this;_.each(Backbone.Radio.channel("actions").request("get:collection").models,function(e){_.each(e.attributes,function(r,a){var l="";_.each(i.fieldListSettings,function(i){if(a==i+"-"+t&&l!=t){var r=e.get(i+"-"+t);e.set(i+"-"+n,r),e.set(i+"-"+t,0),l=t}})})})}},getSettingChildView:function(n){var r=_.filter(i.channel("fields").request("get:collection").models,function(e){return _.contains(n.get("field_types"),e.get("type"))}),a=_.map(r,function(e){return{name:n.get("name")+"-"+e.get("key"),type:"toggle",label:e.get("label"),width:"full"}});return n.set("settings",new t(a)),e}})}),n("controllers/app/settingHTML",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("setting-type-html"),"before:renderSetting",this.init)},init:function(e,t){"undefined"!=e.get("mirror")&&t.on("change:"+e.get("mirror"),this.update,e)},update:function(e,t){e.set(this.get("name"),t)}});return e}),n("controllers/app/settingColor",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("setting-type-color").reply("renderOnChange",this.setRenderFalse),this.listenTo(i.channel("setting-type-color"),"destroy:setting",this.closeColorPickers),this.listenTo(i.channel("setting-type-color"),"render:setting",this.initColorPicker)},initColorPicker:function(e,t,n){var r=(e.get("name"),jQuery(n.el).find("input"));jQuery(r).wpColorPicker({change:function(n,r){i.channel("app").request("change:setting",n,e,t,r.color.toString())}})},setRenderFalse:function(){return!1},closeColorPickers:function(e,t,n){jQuery(n.el).find(".wp-color-picker").wpColorPicker("close")}});return e}),n("controllers/app/changeMenu",[],function(){var e=Marionette.Object.extend({editFormText:"",initialize:function(){this.editFormText=nfAdmin.editFormText||"Edit Form",this.listenTo(i.channel("app"),"after:appStart",this.changeMenu),this.listenTo(i.channel("app"),"response:updateDB",this.formPublish)},changeMenu:function(){var e=i.channel("app").request("get:formModel");this.isNewForm(e.id)?this.highlightAddNew():this.appendEditForm()},isNewForm:function(e){return isNaN(e)},highlightAddNew:function(){jQuery(".wp-submenu li").removeClass("current"),jQuery('a[href="admin.php?page=ninja-forms&form_id=new"]').parent().addClass("current")},appendEditForm:function(){var e='<li class="current"><a href="#">'+this.editFormText+"</a></li>";0==jQuery('li a:contains("'+this.editFormText+'")').length&&(jQuery(".wp-submenu li").removeClass("current"),jQuery('a[href="admin.php?page=ninja-forms&form_id=new"]').parent().after(e))},formPublish:function(e){return"publish"===e.action&&void this.changeMenu()}});return e}),n("controllers/app/mobile",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:menu",this.closeMobileMenu)},closeMobileMenu:function(){var e=i.channel("app").request("get:builderEl");jQuery(e).removeClass("nf-menu-expand")}});return e}),n("controllers/app/notices",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("notices").reply("add",this.addNotice,this),i.channel("notices").reply("close",this.closeNotice,this),this.notices={}},addNotice:function(e,t,n){var r={content:t,color:"green",zIndex:12e3,constructOnInit:!0,stack:!0,animation:{open:"flip",close:"flip"}},a={position:{x:"center",y:"top"},animation:{open:"slide:top",close:"slide:left"},autoClose:2e3,offset:{x:0,y:55}},l={attributes:{x:"left",y:"bottom"},autoClose:4e3};if(i.channel("app").request("is:mobile"))var s=a;else var s=l;s=jQuery.extend(s,r);var n=jQuery.extend(s,n);this.notices[e]=new jBox("Notice",n)},closeNotice:function(e){"undefined"!=typeof this.notices[e]&&this.notices[e].close()},openNotice:function(e){"undefined"!=typeof this.notices[e]&&this.notices[e].open()}});return e}),n("controllers/app/unloadCheck",[],function(){var e=Marionette.Object.extend({initialize:function(){jQuery(window).bind("beforeunload",this.maybePrompt)},maybePrompt:function(e){if(!i.channel("app").request("get:setting","clean"))return"You have unsaved changes."}});return e}),n("controllers/app/formContentFilters",[],function(){var e=Marionette.Object.extend({initialize:function(){this.viewFilters=[],this.saveFilters=[],this.loadFilters=[],i.channel("formContent").reply("add:viewFilter",this.addViewFilter,this),i.channel("formContent").reply("add:saveFilter",this.addSaveFilter,this),i.channel("formContent").reply("add:loadFilter",this.addLoadFilter,this),i.channel("formContent").reply("get:viewFilters",this.getViewFilters,this),i.channel("formContent").reply("get:saveFilters",this.getSaveFilters,this),i.channel("formContent").reply("get:loadFilters",this.getLoadFilters,this),i.channel("fieldContents").reply("add:viewFilter",this.addViewFilter,this),i.channel("fieldContents").reply("add:saveFilter",this.addSaveFilter,this),i.channel("fieldContents").reply("add:loadFilter",this.addLoadFilter,this),i.channel("fieldContents").reply("get:viewFilters",this.getViewFilters,this),i.channel("fieldContents").reply("get:saveFilters",this.getSaveFilters,this),i.channel("fieldContents").reply("get:loadFilters",this.getLoadFilters,this)},addViewFilter:function(e,t){this.viewFilters[t]=e},getViewFilters:function(){return this.viewFilters},addSaveFilter:function(e,t){this.saveFilters[t]=e},getSaveFilters:function(){return this.saveFilters},addLoadFilter:function(e,t){this.loadFilters[t]=e},getLoadFilters:function(){return this.loadFilters}});return e}),n("controllers/app/formContentGutterFilters",[],function(){var e=Marionette.Object.extend({initialize:function(){this.leftFilters=[],this.rightFilters=[],i.channel("formContentGutters").reply("add:leftFilter",this.addLeftFilter,this),i.channel("formContentGutters").reply("add:rightFilter",this.addRightFilter,this),i.channel("formContentGutters").reply("get:leftFilters",this.getLeftFilters,this),i.channel("formContentGutters").reply("get:rightFilters",this.getRightFilters,this)},addLeftFilter:function(e,t){this.leftFilters[t]=e},addRightFilter:function(e,t){this.rightFilters[t]=e},getLeftFilters:function(){return this.leftFilters},getRightFilters:function(){return this.rightFilters}});return e}),n("controllers/app/cloneCollectionDeep",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("app").reply("clone:collectionDeep",this.cloneCollectionDeep,this)},cloneCollectionDeep:function(e){var t=[];return _.each(e.models,function(e){var n=i.channel("app").request("clone:modelDeep",e);t.push(n)}),new e.constructor(t,e.options)}});return e}),n("controllers/app/trackKeyDown",[],function(){var e=Marionette.Object.extend({keys:[],initialize:function(){var e=this;jQuery(document).on("keydown",function(t){e.keyDown(t,e)}),jQuery(document).on("keyup",function(t){e.keyUp(t,e)}),i.channel("app").reply("get:keydown",this.getKeyDown,this)},keyDown:function(e,t){t.keys[e.keyCode]=e.keyCode},keyUp:function(e,t){-1!=t.keys.indexOf(e.keyCode)&&delete t.keys[e.keyCode]},getKeyDown:function(){return this.keys}});return e}),n("controllers/app/perfectScroll",[],function(){var e=Marionette.Object.extend({movedPos:!1,initialize:function(){this.listenTo(i.channel("main"),"show:main",this.initPerfectScroll),this.listenTo(i.channel("drawer"),"opened",this.moveRail),this.listenTo(i.channel("drawer"),"before:closeDrawer",this.resetRail)},initPerfectScroll:function(e){i.channel("app").request("is:mobile")||jQuery(e.el).parent().perfectScrollbar({suppressScrollX:!0}),jQuery("head").append('<style id="ps-scrollbar-css" type="text/css"></style>')},moveRail:function(){var e=i.channel("app").request("get:drawerEl"),t=jQuery(e).outerWidth();jQuery("#ps-scrollbar-css").text(".ps-scrollbar-moved { right: "+t+"px !important; } "),jQuery("#nf-main .ps-scrollbar-y-rail").addClass("ps-scrollbar-moved ")},resetRail:function(){jQuery(".ps-scrollbar-y-rail").removeClass("ps-scrollbar-moved ")}});return e}),n("models/app/settingGroupModel",["models/app/settingCollection"],function(e){var t=Backbone.Model.extend({defaults:{display:!1},initialize:function(t){0==this.get("settings")instanceof Backbone.Collection&&this.set("settings",new e(this.get("settings")))}});return t}),n("models/app/settingGroupCollection",["models/app/settingGroupModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("controllers/app/getNewSettingGroupCollection",["models/app/settingGroupCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){i.channel("app").reply("get:settingGroupCollectionDefinition",this.getNewSettingGroupCollection,this)},getNewSettingGroupCollection:function(){return e}});return t}),n("models/app/typeModel",["models/app/settingGroupCollection"],function(e){var t=Backbone.Model.extend({initialize:function(){!1==this.get("settingGroups")instanceof Backbone.Collection&&this.set("settingGroups",new e(this.get("settingGroups"))),i.channel("fields").trigger("init:typeModel",this)}});return t}),n("models/app/typeCollection",["models/app/typeModel"],function(e){var t=Backbone.Collection.extend({model:e,type:!1,initialize:function(e,t){_.each(t,function(e,t){this[t]=e},this)}});return t}),n("models/fields/typeSectionModel",[],function(){var e=Backbone.Model.extend({defaults:{classes:""}});return e}),n("models/fields/typeSectionCollection",["models/fields/typeSectionModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("controllers/fields/types",["models/app/typeCollection","models/fields/typeSectionCollection"],function(e,t){var n=Marionette.Object.extend({initialize:function(){this.sections=new t(fieldTypeSections),this.listenTo(i.channel("fields"),"init:typeModel",this.registerSection),this.collection=new e(fieldTypeData,{type:"fields"}),i.channel("fields").reply("get:type",this.getFieldType,this),i.channel("fields").reply("get:typeCollection",this.getTypeCollection,this),i.channel("fields").reply("get:typeSections",this.getTypeSections,this),i.channel("fields").reply("get:savedFields",this.getSavedFields,this),this.listenTo(i.channel("drawer"),"click:fieldType",this.addField)},registerSection:function(e){"fields"==e.collection.type&&e.get("section")&&this.sections.get(e.get("section")).get("fieldTypes").push(e.get("id"))},getFieldType:function(e){return this.collection.get(e)},getTypeCollection:function(e){return this.collection},addField:function(e){var t=jQuery(e.target).data("id");if(e.shiftKey)return void i.channel("fields").request("add:stagedField",t);var n=i.channel("fields").request("add",{type:t,label:i.channel("fields").request("get:type",t).get("nicename")}),r={object:"Field",label:n.get("label"),change:"Added",dashicon:"plus-alt"},a={collection:i.channel("fields").request("get:collection")};i.channel("changes").request("register:change","addObject",n,null,r,a),i.channel("fields").request("redraw:collection")},getTypeSections:function(){return this.sections},getSavedFields:function(){console.log(this.sections.get("saved")),this.sections.get("saved")}});return n}),n("controllers/fields/fieldTypeDrag",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"startDrag:type",this.startDrag),this.listenTo(i.channel("drawer-addField"),"stopDrag:type",this.stopDrag),i.channel("drawer-addField").reply("get:typeHelperClone",this.getCurrentDraggableHelperClone,this)},startDrag:function(e,t){this.drawerEl=i.channel("app").request("get:drawerEl"),this.mainEl=i.channel("app").request("get:mainEl"),jQuery(this.drawerEl)[0].style.setProperty("overflow","visible","important"),this.draggableHelperClone=jQuery(t.helper).clone()},stopDrag:function(e,t){jQuery(this.drawerEl)[0].style.setProperty("overflow","hidden","important")},getCurrentDraggableHelperClone:function(){return this.draggableHelperClone}});return e}),n("controllers/fields/stagingDrag",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"startDrag:fieldStaging",this.startDrag),this.listenTo(i.channel("drawer-addField"),"stopDrag:fieldStaging",this.stopDrag)},startDrag:function(e,t){this.drawerEl=i.channel("app").request("get:drawerEl"),this.mainEl=i.channel("app").request("get:mainEl"),jQuery(this.drawerEl)[0].style.setProperty("overflow","visible","important");var n=i.channel("fields").request("get:staging"),r=i.channel("app").request("get:template","#tmpl-nf-staged-fields-drag");jQuery(t.helper).html(r({num:n.models.length})),jQuery(t.helper).prop("id","nf-staged-fields-drag"),jQuery(t.item).css("opacity","0.7")},stopDrag:function(e,t){jQuery(this.drawerEl)[0].style.setProperty("overflow","hidden","important")}});return e}),n("controllers/fields/staging",["models/fields/stagingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e,i.channel("fields").reply("add:stagedField",this.addStagedField,this),i.channel("fields").reply("remove:stagedField",this.removeStagedField,this),i.channel("fields").reply("get:staging",this.getStagingCollection,this),i.channel("fields").reply("sort:staging",this.sortStagedFields,this),i.channel("fields").reply("clear:staging",this.clearStagedFields,this),this.listenTo(i.channel("drawer-addField"),"click:removeStagedField",this.removeStagedField),this.listenTo(i.channel("drawer-addField"),"before:closeDrawer",this.beforeCloseDrawer)},getStagingCollection:function(){return this.collection},addStagedField:function(e,t){var t=t||!1,n=i.channel("fields").request("get:type",e),r="nf-staged-field-"+jQuery.now(),a={id:r,slug:n.get("type"),nicename:n.get("nicename"),icon:n.get("icon")},l=this.collection.add(a);return t||i.channel("fields").trigger("add:stagedField",l),r},removeStagedField:function(e,t){this.collection.remove(t),i.channel("fields").trigger("remove:stagedField",t)},beforeCloseDrawer:function(){if(0!=this.collection.models.length){var e=i.channel("fields").request("get:collection");_.each(this.collection.models,function(t){var n=i.channel("fields").request("get:tmpID"),r={id:n,label:t.get("nicename"),type:t.get("slug")},a=i.channel("fields").request("add",r,!1),l={object:"Field",label:a.get("label"),change:"Added",dashicon:"plus-alt"},s={collection:e};i.channel("changes").request("register:change","addObject",a,null,l,s)}),e.trigger("reset",e),this.collection.reset()}i.channel("fields").request("sort:fields",null,null,!1)},sortStagedFields:function(){var e=i.channel("app").request("get:stagedFieldsEl"),t=jQuery(e).sortable("toArray");_.each(this.collection.models,function(e){var n=e.get("id"),i=t.indexOf(n);e.set("order",i)}),this.collection.sort()},clearStagedFields:function(){this.collection.reset()}});return t}),n("controllers/fields/stagingSortable",["models/fields/stagingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"receive:stagedFields",this.receiveStagedFields),this.listenTo(i.channel("drawer-addField"),"over:stagedFields",this.overStagedFields),this.listenTo(i.channel("drawer-addField"),"out:stagedFields",this.outStagedFields),this.listenTo(i.channel("drawer-addField"),"start:stagedFields",this.startStagedFields),this.listenTo(i.channel("drawer-addField"),"stop:stagedFields",this.stopStagedFields)},receiveStagedFields:function(e){if(jQuery(e.item).hasClass("nf-field-type-draggable")){var t=jQuery(e.item).data("id"),n=i.channel("fields").request("add:stagedField",t);jQuery(e.helper).prop("id",n),i.channel("fields").request("sort:staging"),jQuery(e.helper).remove(),i.channel("drawer-addField").trigger("drop:fieldType",t)}},addActiveClass:function(){var e=i.channel("app").request("get:stagedFieldsEl");jQuery(e).addClass("nf-droppable-active")},removeActiveClass:function(){var e=i.channel("app").request("get:stagedFieldsEl");jQuery(e).removeClass("nf-droppable-active")},overStagedFields:function(e,t){if(jQuery(t.item).hasClass("nf-field-type-draggable")){var n=jQuery(t.item).data("id"),r=i.channel("fields").request("get:type",n),a=r.get("nicename");this.currentHelper=t.helper,jQuery(t.helper).html(a+'<span class="dashicons dashicons-dismiss"></span>'),jQuery(t.helper).removeClass("nf-field-type-button").addClass("nf-item-dock").css({opacity:"0.8",width:"",height:""});var l=i.channel("app").request("get:stagedFieldsEl");jQuery(l).hasClass("ui-sortable")&&jQuery(l).addClass("nf-droppable-hover")}},outStagedFields:function(e){if(jQuery(e.item).hasClass("nf-field-type-draggable")){var t=i.channel("drawer-addField").request("get:typeHelperClone");jQuery(this.currentHelper).html(jQuery(t).html()),jQuery(this.currentHelper).removeClass("nf-item-dock").addClass("nf-field-type-button");var n=i.channel("app").request("get:stagedFieldsEl");jQuery(n).hasClass("ui-sortable")&&jQuery(n).removeClass("nf-droppable-hover")}},startStagedFields:function(e){jQuery(e.item).show(),jQuery(e.item).css({display:"inline",opacity:"0.7"}),jQuery(e.helper).css("opacity","0.5")},stopStagedFields:function(e){jQuery(e.item).css("opacity",""),jQuery(e.helper).remove()}});return t}),n("controllers/fields/filterTypes",["models/fields/typeSectionCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"change:filter",this.filterFieldTypes)},filterFieldTypes:function(t,n){if(""!=jQuery.trim(t)){var r=[];_.each(this.filterCollection(t),function(e){r.push(e.get("id"))});var a=new e([{id:"filtered",nicename:"Filtered Fields",fieldTypes:r}]);i.channel("drawer").trigger("filter:fieldTypes",a),"undefined"!=typeof n&&n.addObject&&0<r.length&&(i.channel("fields").request("add:stagedField",r[0]),i.channel("drawer").request("clear:filter"))}else i.channel("drawer").trigger("clear:filter")},filterCollection:function(e){e=e.toLowerCase();var t=i.channel("fields").request("get:typeCollection"),n=t.filter(function(t){var n=!1;return t.get("type").toLowerCase().indexOf(e)!=-1?n=!0:t.get("nicename").toLowerCase().indexOf(e)!=-1&&(n=!0),t.get("tags")&&0==e.indexOf("#")&&_.each(t.get("tags"),function(t){e.replace("#","").length>1&&t.toLowerCase().indexOf(e.replace("#",""))!=-1&&(n=!0)}),t.get("alias")&&_.each(t.get("alias"),function(t){t.toLowerCase().indexOf(e)!=-1&&(n=!0)}),n});return n}});return t}),n("controllers/fields/sortable",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"startDrag:type",this.addActiveClass),this.listenTo(i.channel("drawer-addField"),"stopDrag:type",this.removeActiveClass),this.listenTo(i.channel("drawer-addField"),"startDrag:fieldStaging",this.addActiveClass),this.listenTo(i.channel("drawer-addField"),"stopDrag:fieldStaging",this.removeActiveClass),i.channel("app").reply("receive:fieldsSortable",this.receiveFieldsSortable,this),i.channel("app").reply("over:fieldsSortable",this.overfieldsSortable,this),i.channel("app").reply("out:fieldsSortable",this.outFieldsSortable,this),i.channel("app").reply("stop:fieldsSortable",this.stopFieldsSortable,this),i.channel("app").reply("start:fieldsSortable",this.startFieldsSortable,this),i.channel("app").reply("update:fieldsSortable",this.updateFieldsSortable,this)},addActiveClass:function(){var e=i.channel("fields").request("get:sortableEl");jQuery(e).addClass("nf-droppable-active")},removeActiveClass:function(){var e=i.channel("fields").request("get:sortableEl");jQuery(e).removeClass("nf-droppable-active")},receiveFieldsSortable:function(e){if(jQuery(e.item).hasClass("nf-field-type-draggable")){var t=jQuery(e.item).data("id"),n=this.addField(t,!1);jQuery(e.helper).prop("id",n),i.channel("fields").request("sort:fields"),jQuery(e.helper).remove(),i.channel("fields").trigger("drop:fieldType",t,n)}else if(jQuery(e.item).hasClass("nf-stage")){var r=this;i.channel("fields").request("sort:staging");var a=i.channel("fields").request("get:staging"),l=i.channel("fields").request("get:sortableEl");if(jQuery(l).hasClass("ui-sortable"))var s=jQuery(l).sortable("toArray");else var s=["nf-staged-fields-drag"];var o=s.indexOf("nf-staged-fields-drag");_.each(a.models,function(e,t){var n=r.addField(e.get("slug"));s.splice(o+t,0,n)});var o=s.indexOf("nf-staged-fields-drag");s.splice(o,1),i.channel("fields").request("sort:fields",s),i.channel("fields").request("clear:staging"),jQuery(e.helper).remove()}},addField:function(e,t){t=t||!1;var n=i.channel("fields").request("get:type",e),r=i.channel("fields").request("get:tmpID"),a=i.channel("fields").request("add",{id:r,label:n.get("nicename"),type:e},t),l={object:"Field",label:a.get("label"),change:"Added",dashicon:"plus-alt"},s={collection:i.channel("fields").request("get:collection")};return i.channel("changes").request("register:change","addObject",a,null,l,s),r},overfieldsSortable:function(e){if(jQuery(e.item).hasClass("nf-field-type-draggable")){var t=jQuery(e.helper).data("id"),n=i.channel("fields").request("get:type",t),r=n.get("nicename"),a=i.channel("fields").request("get:sortableEl"),l=jQuery(a).width();this.currentHelper=e.helper,jQuery(e.helper).html(r),jQuery(e.helper).removeClass("nf-field-type-button").addClass("nf-field-wrap").css({width:l,height:"50px"}),jQuery(a).hasClass("ui-sortable")&&jQuery(a).addClass("nf-droppable-hover")}else if(jQuery(e.item).hasClass("nf-stage")){var a=i.channel("fields").request("get:sortableEl");jQuery(a).hasClass("ui-sortable")&&jQuery(a).addClass("nf-droppable-hover")}},outFieldsSortable:function(e){if(jQuery(e.item).hasClass("nf-field-type-draggable")){var t=i.channel("drawer-addField").request("get:typeHelperClone");jQuery(this.currentHelper).html(jQuery(t).html()),jQuery(this.currentHelper).removeClass("nf-field-wrap").addClass("nf-field-type-button").css({width:"",height:""});var n=i.channel("fields").request("get:sortableEl");jQuery(n).hasClass("ui-sortable")&&jQuery(n).removeClass("nf-droppable-hover")}else if(jQuery(e.item).hasClass("nf-stage")){var n=i.channel("fields").request("get:sortableEl");jQuery(n).hasClass("ui-sortable")&&jQuery(n).removeClass("nf-droppable-hover")}},stopFieldsSortable:function(e){jQuery(e.item).css("opacity",""),jQuery(e.helper).remove(),i.channel("fields").trigger("sortable:stop",e)},startFieldsSortable:function(e){jQuery(e.item).hasClass("nf-field-type-draggable")||jQuery(e.item).hasClass("nf-stage")||jQuery(e.item).css("opacity","0.5").show(),i.channel("fields").trigger("sortable:start",e)},updateFieldsSortable:function(e,t){if(i.channel("fields").request("sort:fields"),!jQuery(e.item).hasClass("nf-field-type-draggable")&&!jQuery(e.item).hasClass("nf-stage")){var n=i.channel("fields").request("get:collection"),r=jQuery(e.item).prop("id").replace("field-",""),a=n.get(r),l={fields:[]};_.each(n.models,function(e){var t=e._previousAttributes.order,n=e.get("order");l.fields.push({model:e,attr:"order",before:t,after:n})});var s={object:"Field",label:a.get("label"),change:"Re-ordered from "+a._previousAttributes.order+" to "+a.get("order"),dashicon:"sort"};i.channel("changes").request("register:change","sortFields",a,null,s,l)}}});return e}),n("controllers/fields/data",["models/fields/fieldCollection","models/fields/fieldModel"],function(e,t){var n=Marionette.Object.extend({adding:!1,removing:!1,initialize:function(){this.collection=new e(preloadedFormData.fields),this.collection.removedIDs={},i.channel("fields").reply("get:collection",this.getFieldCollection,this),i.channel("fields").reply("get:field",this.getField,this),i.channel("fields").reply("redraw:collection",this.redrawFieldCollection,this),i.channel("fields").reply("get:tmpID",this.getTmpFieldID,this),i.channel("fields").reply("add",this.addField,this),i.channel("fields").reply("delete",this.deleteField,this),i.channel("fields").reply("sort:fields",this.sortFields,this),i.channel("fields").reply("get:adding",this.getAdding,this),i.channel("fields").reply("set:adding",this.setAdding,this),i.channel("fields").reply("get:removing",this.getRemoving,this),i.channel("fields").reply("set:removing",this.setRemoving,this)},getFieldCollection:function(){return this.collection},redrawFieldCollection:function(){this.collection.trigger("reset",this.collection)},getField:function(e){return this.collection.findWhere({key:e})?this.collection.findWhere({key:e}):this.collection.get(e)},addField:function(e,n,r,a){if(i.channel("fields").request("set:adding",!0),n=n||!1,a=a||"",r="undefined"==typeof r||r,!1==e instanceof Backbone.Model){"undefined"==typeof e.id&&(e.id=this.getTmpFieldID());var l=new t(e)}else var l=e;if(jQuery.isNumeric(l.get("type"))){var s=i.channel("fields").request("get:type",l.get("type"));l.set("type",s.get("parentType"))}var o=this.collection.add(l,{silent:n});return i.channel("app").request("update:setting","clean",!1),i.channel("fields").trigger("add:field",l),r&&i.channel("fields").trigger("render:newField",o,a),i.channel("fields").trigger("after:addField",l),l},updateFieldSetting:function(e,t,n){var i=this.collection.get(e);i.set(t,n)},sortFields:function(e,t,n){null==n&&(n=!0);var r=i.channel("fields").request("get:sortableEl");if(jQuery(r).hasClass("ui-sortable")){var e=e||jQuery(r).sortable("toArray");_.each(this.collection.models,function(t){var n=(t.get("order"),t.get("id"));if(jQuery.isNumeric(n))var i="field-"+n;else var i=n;var r=e.indexOf(i)+1;t.set("order",r)}),this.collection.sort(),n&&(i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db"))}},deleteField:function(e){i.channel("fields").trigger("delete:field",e),this.removing=!0,this.collection.remove(e),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},getTmpFieldID:function(){var e=this.collection.tmpNum;return this.collection.tmpNum++,"tmp-"+e},getAdding:function(){return this.adding},setAdding:function(e){this.adding=e},getRemoving:function(){return this.removing},setRemoving:function(e){this.removing=e}});return n}),n("models/app/optionRepeaterModel",[],function(){var e=Backbone.Model.extend({defaults:{errors:{}},initialize:function(){this.on("change:errors",this.changeErrors,this)},changeErrors:function(e){if(0==_.size(e.get("errors"))){var t=!1;_.each(e.collection.models,function(e){0!=_.size(e.get("errors"))&&(t=!0)}),t||e.collection.settingModel.set("error",!1)}else e.collection.settingModel.set("error",!0)}});return e}),n("models/app/optionRepeaterCollection",["models/app/optionRepeaterModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order",initialize:function(e,t){this.on("sort",this.changeCollection,this),this.on("add",this.addOption,this),this.settingModel=t.settingModel},changeCollection:function(){i.channel("option-repeater").trigger("sort:options",this),i.channel("option-repeater-"+this.settingModel.get("name")).trigger("sort:options",this)},addOption:function(e,t){e.set("settingModel",this.settingModel)}});return t}),n("views/app/drawer/optionRepeaterError",[],function(){var e=Marionette.ItemView.extend({tagName:"div",className:"nf-error",template:"#tmpl-nf-edit-setting-option-repeater-error"});return e}),n("views/app/drawer/optionRepeaterOption",["views/app/drawer/optionRepeaterError"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",className:"nf-table-row",template:"#tmpl-nf-edit-setting-option-repeater-default-row",id:function(){return this.model.cid},regions:{error:".nf-option-error"},initialize:function(e){this.settingModel=e.settingModel,this.dataModel=e.dataModel,this.collection=e.collection,this.columns=e.columns,this.model.on("change:errors",this.renderErrors,this),this.model.on("change",this.render,this),"undefined"!=typeof this.settingModel.get("tmpl_row")&&(this.template="#"+this.settingModel.get("tmpl_row")),this.hasErrors=!1},onBeforeDestroy:function(){this.model.off("change",this.render),this.model.off("change:errors",this.renderErrors)},onBeforeRender:function(){if(this.model.get("label")){var e=this.model.get("label");
this.model.set("label",_.escape(e),{silent:!0})}},onRender:function(){if(i.channel("mergeTags").request("init",this),i.channel("setting-"+this.settingModel.get("name")+"-option").trigger("render:setting",this.model,this.dataModel,this),this.model.get("label")){var e=this.model.get("label");this.model.set("label",_.unescape(e),{silent:!0})}},onShow:function(){this.model.get("new")&&(jQuery(this.el).find("input:first").focus(),this.model.set("new",!1))},events:{"change .setting":"changeOption","click .nf-delete":"deleteOption",keyup:"keyupOption"},changeOption:function(e){i.channel("option-repeater").trigger("change:option",e,this.model,this.dataModel,this.settingModel)},deleteOption:function(e){i.channel("option-repeater").trigger("click:deleteOption",this.model,this.collection,this.dataModel)},keyupOption:function(e){this.maybeAddOption(e),i.channel("option-repeater").trigger("keyup:option",e,this.model,this.dataModel,this.settingModel),i.channel("option-repeater-"+this.settingModel.get("name")).trigger("keyup:option",e,this.model,this.dataModel,this.settingModel)},maybeAddOption:function(e){13==e.keyCode&&i.channel("option-repeater").trigger("click:addOption",this.collection,this.dataModel)},renderErrors:function(){0==Object.keys(this.model.get("errors"))&&this.hasErrors?(this.error.empty(),jQuery(this.el).removeClass("nf-error")):(this.hasErrors=!0,this.error.show(new e({model:this.model})),jQuery(this.el).addClass("nf-error"))},templateHelpers:function(){var e=this;return{getColumns:function(){return e.columns},renderOptions:function(t,n){if("undefined"!=typeof e.options.columns[t]){var i="";return _.each(e.options.columns[t].options,function(e){var t=n==e.value?" selected":"";i+='<option value="'+e.value+'"'+t+">"+e.label+"</option>"}),i}}}}});return t}),n("views/app/drawer/optionRepeaterEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"tr",template:"#tmpl-nf-edit-setting-option-repeater-empty"});return e}),n("views/app/drawer/optionRepeaterComposite",["views/app/drawer/optionRepeaterOption","views/app/drawer/optionRepeaterEmpty","models/app/optionRepeaterCollection"],function(e,t,n){var r=Marionette.CompositeView.extend({template:"#tmpl-nf-edit-setting-wrap",childView:e,emptyView:t,reorderOnSort:!1,initialize:function(e){var t=e.dataModel.get(this.model.get("name"));0==t instanceof Backbone.Collection&&(t=new n([],{settingModel:this.model}),t.add(e.dataModel.get(this.model.get("name"))),e.dataModel.set(this.model.get("name"),t,{silent:!0})),this.collection=t,this.dataModel=e.dataModel,this.childViewOptions={settingModel:this.model,collection:this.collection,dataModel:e.dataModel,columns:this.model.get("columns")};var i=this.model.get("deps");if(i)for(var r in i)i.hasOwnProperty(r)&&this.dataModel.on("change:"+r,this.render,this)},onBeforeDestroy:function(){var e=this.model.get("deps");if(e)for(var t in e)e.hasOwnProperty(t)&&this.dataModel.off("change:"+t,this.render)},onRender:function(){var e=this;jQuery(this.el).find(".nf-list-options-tbody").sortable({handle:".handle",helper:"clone",placeholder:"nf-list-options-sortable-placeholder",forcePlaceholderSize:!0,opacity:.95,tolerance:"pointer",start:function(e,t){i.channel("option-repeater").request("start:optionSortable",t)},stop:function(e,t){i.channel("option-repeater").request("stop:optionSortable",t)},update:function(t,n){i.channel("option-repeater").request("update:optionSortable",n,this,e)}}),i.channel("setting-"+this.model.get("name")).trigger("render:setting",this.model,this.dataModel,this)},templateHelpers:function(){var e=this;return{renderHeaders:function(){var e="<div>&nbsp;</div>";return _.each(this.columns,function(t){e+="<div>"+t.header+"</div>"}),e+="<div>&nbsp;</div>"},renderSetting:function(){var e=i.channel("app").request("get:template","#tmpl-nf-edit-setting-"+this.type);return e(this)},renderClasses:function(){var e="";return e+="undefined"!=typeof this.width?this.width:" one-half",this.error&&(e+=" nf-error"),e},renderVisible:function(){if(this.deps)for(var t in this.deps)if(this.deps.hasOwnProperty(t)&&e.dataModel.get(t)!==this.deps[t])return'style="display:none;"';return""},renderError:function(){return this.error?this.error:""},renderFieldsetClasses:function(){return e.model.get("name")},currencySymbol:function(){return i.channel("settings").request("get:setting","currency")||nfi18n.currency_symbol}}},attachHtml:function(e,t){jQuery(e.el).find(".nf-list-options-tbody").append(t.el),i.channel("mergeTags").request("init",this)},events:{"click .nf-add-new":"clickAddOption"},clickAddOption:function(e){i.channel("option-repeater").trigger("click:addOption",this.collection,this.dataModel)}});return r}),n("controllers/app/optionRepeater",["models/app/optionRepeaterModel","models/app/optionRepeaterCollection","views/app/drawer/optionRepeaterComposite"],function(e,t,n){var r=Marionette.Object.extend({initialize:function(){i.channel("option-repeater").reply("get:settingChildView",this.getSettingChildView,this),this.listenTo(i.channel("option-repeater"),"change:option",this.changeOption),this.listenTo(i.channel("option-repeater"),"click:addOption",this.addOption),this.listenTo(i.channel("option-repeater"),"click:deleteOption",this.deleteOption),i.channel("option-repeater").reply("update:optionSortable",this.updateOptionSortable,this),i.channel("option-repeater").reply("stop:optionSortable",this.stopOptionSortable,this),i.channel("option-repeater").reply("start:optionSortable",this.startOptionSortable,this),this.listenTo(i.channel("option-repeater"),"init:dataModel",this.convertSettings)},changeOption:function(e,t,n,r){var a=jQuery(e.target).data("id");if("selected"==a)if(jQuery(e.target).attr("checked"))var l=1;else var l=0;else var l=jQuery(e.target).val();var s=t.get(a);t.set(a,l),this.triggerDataModel(t,n);var o=l,c={attr:a,before:s,after:o},d={object:n.get("objectType"),label:n.get("label"),change:"Option "+t.get("label")+" "+a+" changed from "+s+" to "+o};i.channel("changes").request("register:change","changeSetting",t,c,d),i.channel("option-repeater").trigger("update:option",t,n,r),i.channel("option-repeater-option-"+a).trigger("update:option",e,t,n,r),i.channel("option-repeater-"+r.get("name")).trigger("update:option",t,n,r)},addOption:function(t,n){var r={order:t.length,new:!0,options:{}};_.each(t.settingModel.get("columns"),function(e,t){r[t]=e.default,"undefined"!=typeof e.options&&(r.options[t]=e.options)});var a=new e(r);t.add(a);var l={object:n.get("objectType"),label:n.get("label"),change:"Option Added",dashicon:"plus-alt"};i.channel("changes").request("register:change","addListOption",a,null,l),i.channel("option-repeater-"+t.settingModel.get("name")).trigger("add:option",a),i.channel("option-repeater").trigger("add:option",a),this.triggerDataModel(a,n)},deleteOption:function(e,t,n){var r=i.channel("app").request("clone:modelDeep",e),a={object:n.get("objectType"),label:n.get("label"),change:"Option "+r.get("label")+" Removed",dashicon:"dismiss"},l={collection:t};i.channel("changes").request("register:change","removeListOption",r,null,a,l);var s=i.channel("changes").request("get:collection"),o=s.where({model:e});_.each(o,function(e){"object"==typeof e.get("data")&&_.each(e.get("data"),function(e){e.model==e&&(e.model=r)}),e.set("model",r),e.set("disabled",!0)}),t.remove(e),i.channel("option-repeater").trigger("remove:option",e),i.channel("option-repeater-"+t.settingModel.get("name")).trigger("remove:option",e),this.triggerDataModel(e,n)},triggerDataModel:function(e,t){i.channel("app").trigger("update:setting",e)},getSettingChildView:function(e){return n},updateOptionSortable:function(e,t,n){var r=jQuery(t).sortable("toArray"),a=n.collection.get({cid:jQuery(e.item).prop("id")}),l={collection:n.collection,objModels:[]};_.each(r,function(e,t){var i=n.collection.get({cid:e}),r=i.get("order");i.set("order",t);var a=t;l.objModels.push({model:i,attr:"order",before:r,after:a})}),n.collection.sort({silent:!0});var s={object:n.dataModel.get("objectType"),label:n.dataModel.get("label"),change:"Option "+a.get("label")+" re-ordered from "+a._previousAttributes.order+" to "+a.get("order"),dashicon:"sort"};i.channel("changes").request("register:change","sortListOptions",a,null,s,l),this.triggerDataModel(a,n.dataModel),i.channel("option-repeater").trigger("sort:option",a,n),i.channel("option-repeater-"+n.get("name")).trigger("sort:option",a,n)},stopOptionSortable:function(e){jQuery(e.item).css("opacity","")},startOptionSortable:function(e){jQuery(e.placeholder).find("div").remove(),jQuery(e.item).css("opacity","0.5").show()},convertSettings:function(e,n){var i=e.get(n.get("name"));0==i instanceof Backbone.Collection&&(i=new t([],{settingModel:n}),i.add(e.get(n.get("name"))),e.set(n.get("name"),i,{silent:!0}))}});return r}),n("controllers/fields/editActive",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("fields").reply("clear:editActive",this.clearEditActive,this),this.listenTo(i.channel("drawer-editSettings"),"before:closeDrawer",this.clearEditActive)},clearEditActive:function(){var e=i.channel("fields").request("get:collection");_.each(e.models,function(e){e.set("editActive",!1)})}});return e}),n("controllers/fields/fieldSettings",["models/app/settingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e(fieldSettings,{objectType:"fields"}),i.channel("fields").reply("get:settingModel",this.getSettingModel,this),i.channel("fields").reply("get:settingCollection",this.getSettingCollection,this)},getSettingModel:function(e){return this.collection.findWhere({name:e})},getSettingCollection:function(){return this.collection}});return t}),n("controllers/fields/fieldCreditCard",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("fields"),"after:addField",this.dropCreditCardField)},dropCreditCardField:function(e){if("creditcard"==e.get("type")){var t=e.get("order");i.channel("fields").request("delete",e),_.each(["creditcardfullname","creditcardnumber","creditcardcvc","creditcardexpiration","creditcardzip"],function(e){var n=i.channel("fields").request("get:type",e),r={id:i.channel("fields").request("get:tmpID"),type:e,label:n.get("nicename"),order:t};i.channel("fields").request("add",r)})}},stageCreditCardField:function(e){"creditcard"==e.get("slug")&&(i.channel("fields").request("remove:stagedField","",e),_.each(["creditcardfullname","creditcardnumber","creditcardcvc","creditcardexpiration","creditcardzip"],function(e){i.channel("fields").request("add:stagedField",e)}))}});return e}),n("controllers/fields/fieldList",["models/app/optionRepeaterCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("option-repeater-option-label"),"update:option",this.updateOptionLabel),this.listenTo(i.channel("option-repeater-option-value"),"update:option",this.updateOptionValue),this.listenTo(i.channel("fields-list"),"init:fieldModel",this.convertOptions)},updateOptionLabel:function(e,t,n,i){"list"==fieldTypeData[n.get("type")].parentType&&(t.get("manual_value")||(value=jQuery.slugify(t.get("label"),{separator:"-"}),t.set("value",value),t.trigger("change",t)))},updateOptionValue:function(e,t,n,i){"list"==fieldTypeData[n.get("type")].parentType&&t.set("manual_value",!0)},convertOptions:function(t){var n=t.get("options"),r=i.channel("fields").request("get:settingModel","options");0==n instanceof Backbone.Collection&&(n=new e([],{settingModel:r}),n.add(t.get("options")),t.set("options",n,{silent:!0}))}});return t}),n("controllers/fields/fieldPassword",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("fields"),"drop:fieldType",this.dropField),this.listenTo(i.channel("fields"),"add:stagedField",this.stageField)},dropField:function(e,t){if("password"==e){var n=i.channel("fields").request("get:field",t),r=n.get("order");i.channel("fields").request("delete",n),_.each(["password","passwordconfirm"],function(e){var t=i.channel("fields").request("get:type",e),n={id:i.channel("fields").request("get:tmpID"),type:e,label:t.get("nicename"),order:r};i.channel("fields").request("add",n)})}},stageField:function(e){var t=e.get("slug");"password"==t&&(i.channel("fields").request("remove:stagedField","",e),_.each(["password","passwordconfirm"],function(e){var n=e==t;i.channel("fields").request("add:stagedField",e,n)}))}});return e}),n("controllers/fields/fieldQuantity",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"before:renderSetting",this.beforeRenderSetting)},beforeRenderSetting:function(e,t,n){if("product_assignment"==e.get("name")){var i=this.getProductFields(e);e.set("options",i)}},getProductFields:function(e){var t=[e.get("select_product")],n=i.channel("fields").request("get:collection");return _.each(n.models,function(e){"product"==e.get("type")&&t.push({label:e.get("label"),value:e.get("id")})}),t}});return e}),n("controllers/fields/fieldShipping",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("setting-shipping_options"),"render:setting",this.addMask),this.listenTo(i.channel("setting-shipping_options-option"),"render:setting",this.addMask)},addMask:function(e,t,n){jQuery(n.el).find('[data-id="value"]').each(function(){jQuery(this).autoNumeric({aSign:"$",aSep:thousandsSeparator,aDec:decimalPoint})})}});return e}),n("controllers/fields/key",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("fields"),"add:field",this.newFieldKey),this.listenTo(i.channel("fieldSetting-label"),"update:setting",this.updateLabel),this.listenTo(i.channel("fieldSetting-key"),"update:setting",this.updateKey),this.listenTo(i.channel("setting-key"),"keyup:setting",this.keyUp)},newFieldKey:function(e){var t=new Date,n=t.valueOf(),i=this.keyExists(e.get("type")+"_"+n);e.set("key",i,{silent:!0}),"undefined"==e.get("manual_key")&&e.set("manual_key",!1,{silent:!0})},updateLabel:function(e){if(!e.get("manual_key")&&0!=jQuery.trim(e.get("label")).length){delete e.changed.label;var t=this.keyExists(e.get("label"));e.set("key",t)}},updateKey:function(e){var t=e.get("key");this.settingModel=i.channel("fields").request("get:settingModel","key"),this.setError(t,e)},keyUp:function(e,t,n){n.set("manual_key",!0),this.settingModel=t;var i=jQuery(e.target).val();this.setError(i,n)},setError:function(e,t){var n=!1;""==jQuery.trim(e)?n="Field keys can't be empty. Please enter a key.":e!=this.keyExists(e,t)&&(n="Field keys must be unique. Please enter another key."),n?this.settingModel.set("error",n):(i.channel("app").trigger("update:fieldKey",t),this.settingModel.set("error",!1))},keyExists:function(e,t){var n=jQuery.slugify(e,{separator:"_"});0!=n.length&&(e=n);var r=i.channel("fields").request("get:collection"),a=1,l=e;return _.each(r.models,function(n){t!=n&&l==n.get("key")&&(l=e+"_"+a,a++)}),e=l}});return e}),n("controllers/fields/notices",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("fields"),"add:stagedField",this.addStagedField)},addStagedField:function(e){i.channel("notices").request("add","addStagedField",e.get("nicename")+" added to staging")}});return e}),n("controllers/fields/mobile",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("fields"),"sortable:start",this.startWiggle),this.listenTo(i.channel("fields"),"sortable:stop",this.stopWiggle)},initWiggle:function(e){i.channel("app").request("is:mobile")&&jQuery(e.el).find(".nf-field-wrap").on("taphold",function(){jQuery(this).ClassyWiggle("start",{degrees:[".65","1",".65","0","-.65","-1","-.65","0"],delay:50})})},startWiggle:function(e){i.channel("app").request("is:mobile")&&(jQuery(e.item).removeClass("ui-sortable-helper").ClassyWiggle("stop"),jQuery(e.helper).css("opacity","0.75").ClassyWiggle("start",{degrees:[".5","1",".5","0","-.5","-1","-.5","0"]}))},stopWiggle:function(e){i.channel("app").request("is:mobile")&&(jQuery(e.helper).ClassyWiggle("stop"),jQuery(e.item).removeClass("ui-sortable-helper drag-selected"))}});return e}),n("controllers/fields/savedFields",[],function(){var e=Marionette.Object.extend({ignoreAttributes:["editActive","order","saved","jBox"],initialize:function(){this.listenTo(i.channel("fields"),"update:setting",this.updateField),this.listenTo(i.channel("drawer"),"click:addSavedField",this.clickAddSavedField,this)},updateField:function(e){if(e.get("saved")){var t=!1,n=_.keys(e.changedAttributes()),i=this;_.each(n,function(e){-1==i.ignoreAttributes.indexOf(e)&&(t=!0)}),t&&e.set("saved",!1)}},clickAddSavedField:function(e,t){var n=i.channel("app").request("clone:modelDeep",t),r=n.attributes;r.saved=!0,delete r.jBox,delete r.editActive,delete r.created_at,delete r.order,delete r.id,delete r.formID,delete r.parent_id;var a=i.channel("fields").request("get:type",r.type),l=_.clone(a.attributes),s=jQuery(e.target).parent().parent().find("input").val();console.log(s),l.nicename=s,r.label=s,r.nicename=s,t.set("addSavedLoading",!0);var o=JSON.stringify(r);jQuery.post(ajaxurl,{action:"nf_create_saved_field",field:o,security:nfAdmin.ajaxNonce},function(e){e=JSON.parse(e),l.id=e.data.id,l.nicename=s,l.settingDefaults=r;var n=i.channel("fields").request("get:typeCollection"),a=(n.add(l),i.channel("fields").request("get:typeSections"));a.get("saved").get("fieldTypes").push(l.id),t.set("addSavedLoading",!1),t.unset("addSavedLoading",{silent:!0}),t.get("jBox").close(),i.channel("notices").request("add","addSaved","Saved Field Added")})}});return e}),n("controllers/fields/fieldDatepicker",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("setting-type-datepicker"),"render:setting",this.addDatepicker)},addDatepicker:function(e,t,n){pikadayResponsive(jQuery(n.el).find(".setting")[0])}});return e}),n("controllers/fields/fieldDisplayCalc",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("setting-calc_var"),"before:renderSetting",this.beforeRenderSetting)},beforeRenderSetting:function(e,t,n){},getProductFields:function(e){var t=[e.get("select_product")],n=i.channel("fields").request("get:collection");return _.each(n.models,function(e){"product"==e.get("type")&&t.push({label:e.get("label"),value:e.get("id")})}),t}});return e}),n("controllers/actions/types",["models/app/typeCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.installedActions=new e(_.filter(actionTypeData,function(e){return"installed"==e.section}),{slug:"installed",nicename:nfi18n.installed}),this.availableActions=new e(_.filter(actionTypeData,function(e){return"available"==e.section}),{slug:"available",nicename:nfi18n.available}),i.channel("actions").reply("get:type",this.getType,this),i.channel("actions").reply("get:installedActions",this.getInstalledActions,this),i.channel("actions").reply("get:availableActions",this.getAvailableActions,this)},getType:function(e){var t=this.installedActions.get(e);return t||(t=this.availableActions.get(e)),t},getInstalledActions:function(){return this.installedActions},getAvailableActions:function(){return this.availableActions},addStagedField:function(e){var t=jQuery(e.target).data("id");i.channel("fields").request("add:stagedField",t)},getTypeSections:function(){return this.fieldTypeSections}});return t}),n("models/actions/actionModel",[],function(){var e=Backbone.Model.extend({defaults:{objectType:"Action",objectDomain:"actions",editActive:!1},initialize:function(){this.on("change",this.changeSetting,this);var e=i.channel("actions").request("get:type",this.get("type"));if("undefined"!=typeof e){var t=this;_.each(e.get("settingDefaults"),function(e,n){t.get(n)||t.set(n,e,{silent:!0})}),i.channel("actions").trigger("init:actionModel",this),i.channel("actions-"+this.get("type")).trigger("init:actionModel",this),this.listenTo(i.channel("app"),"fire:updateFieldKey",this.updateFieldKey)}},changeSetting:function(e,t){i.channel("actionSetting-"+_.keys(this.changedAttributes())[0]).trigger("update:setting",this,t.settingModel),i.channel("actions").trigger("update:setting",this,t.settingModel),i.channel("app").trigger("update:setting",this,t.settingModel)},updateFieldKey:function(e,t){i.channel("app").trigger("replace:fieldKey",this,e,t)}});return e}),n("models/actions/actionCollection",["models/actions/actionModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order",tmpNum:1,initialize:function(){this.on("add",this.addAction,this),this.on("remove",this.removeAction,this),this.newIDs=[]},addAction:function(e){this.newIDs.push(e.get("id"))},removeAction:function(e){this.removedIDs[e.get("id")]=e.get("id")}});return t}),n("controllers/actions/data",["models/actions/actionCollection","models/actions/actionModel"],function(e,t){var n=Marionette.Object.extend({initialize:function(){if(this.collection=new e(preloadedFormData.actions),this.collection.tmpNum=1,0!=this.collection.models.length){var t=this;_.each(this.collection.models,function(e){jQuery.isNumeric(e.get("id"))||t.collection.tmpNum++})}this.collection.removedIDs={},i.channel("actions").reply("get:collection",this.getCollection,this),i.channel("actions").reply("get:action",this.getAction,this),i.channel("actions").reply("get:tmpID",this.getTmpID,this),i.channel("actions").reply("add",this.addAction,this),i.channel("actions").reply("delete",this.deleteAction,this)},getCollection:function(){return this.collection},getAction:function(e){return this.collection.get(e)},addAction:function(e,n){if(n=n||!1,!1==e instanceof Backbone.Model)var r=new t(e);else var r=e;return this.collection.add(r,{silent:n}),i.channel("app").request("update:setting","clean",!1),r},deleteAction:function(e){this.collection.remove(e),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},getTmpID:function(){var e=this.collection.tmpNum;return this.collection.tmpNum++,"tmp-"+e}});return n}),n("controllers/actions/actionSettings",["models/app/settingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e(actionSettings,{objectType:"actions"}),i.channel("actions").reply("get:settingModel",this.getSettingModel,this)},getSettingModel:function(e){return this.collection.findWhere({name:e})}});return t}),n("controllers/actions/editActive",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("actions").reply("clear:editActive",this.clearEditActive,this),this.listenTo(i.channel("drawer-editSettings"),"before:closeDrawer",this.clearEditActive)},clearEditActive:function(){var e=i.channel("actions").request("get:collection");_.each(e.models,function(e){e.set("editActive",!1)})}});return e}),n("controllers/actions/addActionTypes",["models/actions/actionCollection","models/actions/actionModel"],function(e,t){var n=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("actions"),"click:addAction",this.addAction),i.channel("actions").reply("add:actionType",this.addAction,this)},addAction:function(e){var t={id:i.channel("actions").request("get:tmpID"),type:e.get("id"),label:e.get("settingDefaults").label||e.get("nicename")},n=i.channel("actions").request("add",t),r={object:"Action",label:n.get("label"),change:"Added",dashicon:"plus-alt"},t={collection:i.channel("actions").request("get:collection")};i.channel("changes").request("register:change","addObject",n,null,r,t),i.channel("app").trigger("click:edit",{},n)}});return n}),n("controllers/actions/typeDrag",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addAction"),"startDrag:type",this.startDrag),this.listenTo(i.channel("drawer-addAction"),"stopDrag:type",this.stopDrag),i.channel("drawer-addAction").reply("get:typeHelperClone",this.getCurrentDraggableHelperClone,this)},startDrag:function(e,t){this.drawerEl=i.channel("app").request("get:drawerEl"),this.mainEl=i.channel("app").request("get:mainEl"),jQuery(this.drawerEl)[0].style.setProperty("overflow","visible","important"),this.draggableHelperClone=jQuery(t.helper).clone()},stopDrag:function(e,t){jQuery(this.drawerEl)[0].style.setProperty("overflow","hidden","important")},getCurrentDraggableHelperClone:function(){return this.draggableHelperClone}});return e}),n("controllers/actions/droppable",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("app").reply("drop:actionType",this.dropActionType,this)},dropActionType:function(e,t){var n=jQuery(t.helper).data("type"),r=i.channel("actions").request("get:type",n);i.channel("actions").request("add:actionType",r)}});return e}),n("models/actions/typeModel",[],function(){var e=Backbone.Model.extend({});return e}),n("models/actions/typeCollection",["models/actions/typeModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("controllers/actions/filterTypes",["models/actions/typeCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addAction"),"change:filter",this.filterActionTypes)},filterActionTypes:function(t,n){if(""!=jQuery.trim(t)){var r=[],a=i.channel("actions").request("get:installedActions");_.each(this.filterCollection(t,a),function(e){r.push(e)});var l=[],s=i.channel("actions").request("get:availableActions");_.each(this.filterCollection(t,s),function(e){l.push(e)});var o=new e(r);o.slug="installed",o.nicename="Installed";var c=new e(l);c.slug="available",c.nicename="Available",i.channel("drawer").trigger("filter:actionTypes",o,c),n.addObject&&0<o.length&&(i.channel("actions").request("add:actionType",o.models[0]),i.channel("drawer").request("clear:filter"))}else i.channel("drawer").trigger("clear:filter")},filterCollection:function(e,t){e=e.toLowerCase();var n=t.filter(function(t){var n=!1;return t.get("id").toLowerCase().indexOf(e)!=-1?n=!0:t.get("nicename").toLowerCase().indexOf(e)!=-1&&(n=!0),t.get("tags")&&0==e.indexOf("#")&&_.each(t.get("tags"),function(t){e.replace("#","").length>1&&t.toLowerCase().indexOf(e.replace("#",""))!=-1&&(n=!0)}),t.get("alias")&&_.each(t.get("alias"),function(t){t.toLowerCase().indexOf(e)!=-1&&(n=!0)}),n});return n}});return t}),n("controllers/actions/newsletterList",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("setting-newsletter_list"),"show:setting",this.defaultFields),this.listenTo(i.channel("setting-type-newsletter_list"),"click:extra",this.clickListUpdate),this.listenTo(i.channel("actionSetting-newsletter_list"),"update:setting",this.maybeRenderFields),this.listenTo(i.channel("actionSetting-newsletter_list"),"update:setting",this.maybeRenderGroups),this.listenTo(i.channel("setting-name-newsletter_list_fields"),"init:settingModel",this.registerFieldsListener),this.listenTo(i.channel("setting-name-newsletter_list_groups"),"init:settingModel",this.registerGroupsListener)},defaultFields:function(e,t){this.maybeRenderFields(t,e),this.maybeRenderGroups(t,e)},registerFieldsListener:function(e){e.listenTo(i.channel("newsletter_list_fields"),"update:fieldMapping",this.updateFieldMapping,e)},registerGroupsListener:function(e){e.listenTo(i.channel("newsletter_list_groups"),"update:interestGroups",this.updateInterestGroups,e)},clickListUpdate:function(e,t,n,i){var r={action:"nf_"+n.attributes.type+"_get_lists",security:nfAdmin.ajaxNonce},a=this;jQuery(e.srcElement).addClass("spin"),jQuery.post(ajaxurl,r,function(e){var e=JSON.parse(e);a.updateLists(t,e.lists,i,n),n.set("newsletter_list",e.lists[0].value,{settingModel:t})}).always(function(){jQuery(e.srcElement).removeClass("spin")})},updateLists:function(e,t,n,i){e.set("options",t),n.render()},maybeRenderFields:function(e,t){if("undefined"!=typeof t){var n=e.get("newsletter_list"),r=t.get("options");_.each(r,function(e){n==e.value&&i.channel("newsletter_list_fields").trigger("update:fieldMapping",e.fields)}),e.set("newsletter_list_fields",0)}},maybeRenderGroups:function(e,t){if("undefined"!=typeof t){var n=e.get("newsletter_list"),r=t.get("options");_.each(r,function(e){n==e.value&&i.channel("newsletter_list_groups").trigger("update:interestGroups",e.groups)}),e.set("newsletter_list_fields",0)}},updateFieldMapping:function(e){var t=this.get("settings");t.reset(),_.each(e,function(e){t.add({name:e.value,type:"textbox",label:e.label,width:"full",use_merge_tags:{exclude:["user","post","system","querystrings"]}})}),this.set("settings",t)},updateInterestGroups:function(e){var t=this.get("settings");t.reset(),_.each(e,function(e){t.add({name:e.value,type:"toggle",label:e.label,width:"full"})}),this.set("settings",t)}});return e}),n("controllers/advanced/types",["models/app/typeCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e(formSettingTypeData),i.channel("settings").reply("get:type",this.getType,this),i.channel("settings").reply("get:typeCollection",this.getCollection,this)},getType:function(e){return this.collection.get(e)},getCollection:function(){return this.collection}});return t}),n("models/advanced/settingsModel",[],function(){var e=Backbone.Model.extend({defaults:{objectType:"Form Setting",editActive:!1},initialize:function(){this.bind("change",this.changeSetting,this);var e=i.channel("settings").request("get:collection");_.each(e.models,function(e){"undefined"==typeof this.get(e.get("name"))&&this.set(e.get("name"),e.get("value"),{silent:!0}),i.channel(e.get("type")).trigger("init:dataModel",this,e)},this),this.listenTo(i.channel("app"),"fire:updateFieldKey",this.updateFieldKey)},changeSetting:function(e,t){i.channel("app").trigger("update:setting",this,t.settingModel)},updateFieldKey:function(e,t){i.channel("app").trigger("replace:fieldKey",this,e,t)}});return e}),n("controllers/advanced/data",["models/advanced/settingsModel"],function(e){var t=Marionette.Object.extend({initialize:function(){this.model=new e(preloadedFormData.settings),i.channel("settings").reply("get:settings",this.getSettings,this),i.channel("settings").reply("get:setting",this.getSetting,this),i.channel("settings").reply("update:setting",this.updateSetting,this)},getSettings:function(){return this.model},updateSetting:function(e,t,n){n=n||!1,this.model.set(e,t,{silent:n})},getSetting:function(e){return this.model.get(e)}});return t}),n("controllers/advanced/formSettings",["models/app/settingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e(formSettings,{objectType:"settings"}),i.channel("settings").reply("get:settingModel",this.getSettingModel,this),i.channel("settings").reply("get:collection",this.getSettingCollection,this)},getSettingModel:function(e){return this.collection.findWhere({name:e})},getSettingCollection:function(){return this.collection}});return t}),n("controllers/advanced/editActive",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("settings").reply("clear:editActive",this.clearEditActive,this),this.listenTo(i.channel("drawer-editSettings"),"before:closeDrawer",this.clearEditActive)},clearEditActive:function(){var e=i.channel("settings").request("get:typeCollection");_.each(e.models,function(e){e.set("editActive",!1)})}});return e}),n("controllers/advanced/clickEdit",["models/advanced/settingsModel"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("settings"),"click:edit",this.clickEdit)},clickEdit:function(e,t){var n=i.channel("settings").request("get:settings");i.channel("app").request("open:drawer","editSettings",{model:n,groupCollection:t.get("settingGroups"),typeModel:t});var r=i.channel("drawer").request("get:preventClose");r||t.set("editActive",!0)}});return t}),n("controllers/advanced/calculations",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("option-repeater-calculations"),"keyup:option",this.keyUp),this.listenTo(i.channel("option-repeater-calculations"),"update:option",this.updateCalc),this.listenTo(i.channel("option-repeater-calculations"),"sort:option",this.sortCalc);
},keyUp:function(e,t){var n=jQuery(e.target).val();"name"==jQuery(e.target).data("id")?(this.checkName(n,t),this.checkEQ(t.get("eq"),t)):this.checkEQ(n,t)},updateCalc:function(e){this.checkName(e.get("name"),e,!1),this.checkEQ(e.get("eq"),e)},sortCalc:function(e,t){this.checkAllCalcs(t.collection)},checkName:function(e,t,n){n=n||!0;var i=t.get("errors"),r=t.collection.where({name:jQuery.trim(e)});e==t.get("name")&&(r=[]),0!=r.length?i.nameExists="Calculation names must be unique. Please enter another name.":(t.set("name",e,{silent:n}),delete i.nameExists),t.set("errors",i),t.trigger("change:errors",t)},checkEQ:function(e,t){var n=t.get("errors"),i=!1,r=!1,a=e.match(new RegExp(/{calc:(.*?)}/g));if(a){var l=t.collection;a=a.map(function(e){var a=e.replace("}","").replace("{calc:",""),s=l.findWhere({name:a});a==t.get("name")?(n.selfRef="A calculation can't reference itself!",i=!0):s&&s.get("order")>t.get("order")&&(r=!0,n.futureCalc="Can't reference a future calculation!")})}i||delete n.selfRef,r||delete n.futureCalc,t.set("errors",n),t.trigger("change:errors",t)},checkAllCalcs:function(e){var t=this;e.models.map(function(e){t.checkName(e.get("name"),e),t.checkEQ(e.get("eq"),e)})}});return e}),n("controllers/loadControllers",["controllers/app/remote","controllers/app/drawer","controllers/app/drawerConfig","controllers/app/domainConfig","controllers/app/data","controllers/app/drawerToggleSettingGroup","controllers/app/updateDB","controllers/app/formData","controllers/app/previewLink","controllers/app/menuButtons","controllers/app/trackChanges","controllers/app/undoChanges","controllers/app/publishResponse","controllers/app/changeDomain","controllers/app/pushstate","controllers/app/hotkeys","controllers/app/cleanState","controllers/app/coreUndo","controllers/app/cloneModelDeep","controllers/app/getSettingChildView","controllers/app/changeSettingDefault","controllers/app/fieldset","controllers/app/toggleSetting","controllers/app/itemControls","controllers/app/mergeTags","controllers/app/itemSettingFill","controllers/app/confirmPublish","controllers/app/rte","controllers/app/settingFieldSelect","controllers/app/settingFieldList","controllers/app/settingHTML","controllers/app/settingColor","controllers/app/changeMenu","controllers/app/mobile","controllers/app/notices","controllers/app/unloadCheck","controllers/app/formContentFilters","controllers/app/formContentGutterFilters","controllers/app/cloneCollectionDeep","controllers/app/trackKeyDown","controllers/app/perfectScroll","controllers/app/getNewSettingGroupCollection","controllers/fields/types","controllers/fields/fieldTypeDrag","controllers/fields/stagingDrag","controllers/fields/staging","controllers/fields/stagingSortable","controllers/fields/filterTypes","controllers/fields/sortable","controllers/fields/data","controllers/app/optionRepeater","controllers/fields/editActive","controllers/fields/fieldSettings","controllers/fields/fieldCreditCard","controllers/fields/fieldList","controllers/fields/fieldPassword","controllers/fields/fieldQuantity","controllers/fields/fieldShipping","controllers/fields/key","controllers/fields/notices","controllers/fields/mobile","controllers/fields/savedFields","controllers/fields/fieldDatepicker","controllers/fields/fieldDisplayCalc","controllers/actions/types","controllers/actions/data","controllers/actions/actionSettings","controllers/actions/editActive","controllers/actions/addActionTypes","controllers/actions/typeDrag","controllers/actions/droppable","controllers/actions/filterTypes","controllers/actions/newsletterList","controllers/advanced/types","controllers/advanced/data","controllers/advanced/formSettings","controllers/advanced/editActive","controllers/advanced/clickEdit","controllers/advanced/calculations"],function(e,t,n,i,r,a,l,s,o,c,d,h,u,p,g,f,m,v,y,w,b,C,j,M,S,k,F,T,q,D,x,Q,_,O,A,E,V,z,R,N,B,I,L,P,H,G,$,K,W,U,J,X,Y,Z,ee,te,ne,ie,re,ae,le,se,oe,ce,de,he,ue,pe,ge,fe,me,ve,ye,we,be,Ce,je,Me,Se){var ke=Marionette.Object.extend({initialize:function(){new V,new z,new f,new e,new t,new n,new i,new a,new o,new c,new d,new h,new u,new p,new m,new v,new y,new M,new F,new T,new q,new D,new x,new Q,new _,new O,new A,new E,new l,new R,new N,new B,new I,new C,new J,new L,new P,new H,new G,new $,new K,new W,new b,new j,new w,new X,new Y,new Z,new ee,new te,new ne,new ie,new re,new ae,new le,new se,new oe,new ce,new ye,new de,new he,new ue,new pe,new ge,new fe,new me,new ve,new we,new Ce,new Se,new be,new je,new Me,new r,new U,new s,new S,new k}});return ke}),n("views/fields/fieldItem",["views/app/itemControls"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#tmpl-nf-main-content-field",doingShortcut:!1,regions:{itemControls:".nf-item-controls"},initialize:function(){this.model.on("change:editActive",this.render,this),this.model.on("change:label",this.render,this),this.model.on("change:required",this.render,this),this.model.on("change:id",this.render,this)},onBeforeDestroy:function(){this.model.off("change:editActive",this.render),this.model.off("change:label",this.render),this.model.off("change:required",this.render),this.model.off("change:id",this.render)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),this.itemControls.show(new e({model:this.model})),jQuery(this.el).disableSelection(),i.channel("app").request("is:mobile")&&jQuery(this.el).on("taphold",function(e,t){jQuery(e.target).hasClass("nf-edit-settings")||(jQuery(this).addClass("ui-sortable-helper drag-selected"),jQuery(this).ClassyWiggle("start",{degrees:[".65","1",".65","0","-.65","-1","-.65","0"],delay:50}))})},templateHelpers:function(){return{renderClasses:function(){var e="nf-field-wrap";return this.editActive&&(e+=" active"),e},renderRequired:function(){return 1==this.required?'<span class="required">*</span>':""},getFieldID:function(){return jQuery.isNumeric(this.id)?"field-"+this.id:this.id},renderIcon:function(){var e=i.channel("fields").request("get:type",this.type);return'<span class="fa fa-'+e.get("icon")+'"></span>'}}},events:{"mouseover .nf-item-control":"mouseoverItemControl",mousedown:"maybeShortcut",click:"maybeClickEdit",singletap:"maybeTapEdit",swipeleft:"swipeLeft",swiperight:"swipeRight",tapend:"tapend"},maybeClickEdit:function(e){return this.doingShortcut?(this.doingShortcut=!1,!1):void((jQuery(e.target).parent().hasClass("nf-fields-sortable")||jQuery(e.target).parent().hasClass("nf-field-wrap")||jQuery(e.target).hasClass("nf-field-wrap"))&&!i.channel("app").request("is:mobile")&&(jQuery(":focus").blur(),i.channel("app").trigger("click:edit",e,this.model)))},maybeShortcut:function(e){var t=i.channel("app").request("get:keydown");return-1==t.indexOf(16)||(-1!=t.indexOf(68)?(i.channel("app").trigger("click:delete",e,this.model),this.doingShortcut=!0,!1):-1!=t.indexOf(67)?(this.doingShortcut=!0,i.channel("app").trigger("click:duplicate",e,this.model),!1):void 0)},maybeTapEdit:function(e){jQuery(e.target).parent().hasClass("nf-fields-sortable")&&i.channel("app").trigger("click:edit",e,this.model)},swipeLeft:function(e,t){jQuery(t.startEvnt.target).closest("div").find(".nf-item-duplicate").show(),jQuery(t.startEvnt.target).closest("div").find(".nf-item-delete").show()},swipeRight:function(e,t){jQuery(t.startEvnt.target).closest("div").find(".nf-item-duplicate").hide(),jQuery(t.startEvnt.target).closest("div").find(".nf-item-delete").hide()},tapend:function(e,t){jQuery(this.el).ClassyWiggle("stop"),jQuery(this.el).removeClass("ui-sortable-helper drag-selected")},remove:function(){i.channel("fields").request("get:removing")?this.$el.hide("clip",function(){jQuery(this).remove()}):this.$el.remove(),i.channel("fields").request("set:removing",!1)},mouseoverItemControl:function(e){jQuery(this.el).find(".nf-item-control").css("display","")}});return t}),n("views/fields/mainContentEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-main-content-fields-empty",onBeforeDestroy:function(){jQuery(this.el).parent().removeClass("nf-fields-empty-droppable").droppable("destroy")},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},onShow:function(){jQuery(this.el).parent().hasClass("ui-sortable")&&jQuery(this.el).parent().sortable("destroy"),jQuery(this.el).parent().addClass("nf-fields-empty-droppable"),jQuery(this.el).parent().droppable({accept:function(e){if(jQuery(e).hasClass("nf-stage")||jQuery(e).hasClass("nf-field-type-button"))return!0},activeClass:"nf-droppable-active",hoverClass:"nf-droppable-hover",tolerance:"pointer",over:function(e,t){t.item=t.draggable,i.channel("app").request("over:fieldsSortable",t)},out:function(e,t){t.item=t.draggable,i.channel("app").request("out:fieldsSortable",t)},drop:function(e,t){t.item=t.draggable,i.channel("app").request("receive:fieldsSortable",t);var n=i.channel("fields").request("get:collection");n.trigger("reset",n)}})}});return e}),n("views/app/formTitle",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#tmpl-nf-header-form-title",initialize:function(){this.model.on("change:title",this.render,this)},templateHelpers:function(){return{renderTitle:function(){var e=i.channel("app").request("get:formModel");return e.get("settings").get("title")}}}});return e}),n("views/loadViews",["views/fields/fieldItem","views/fields/mainContentEmpty","views/app/formTitle"],function(e,t,n){var r=Marionette.Object.extend({initialize:function(){i.channel("views").reply("get:fieldItem",this.getFieldItem),i.channel("views").reply("get:mainContentEmpty",this.getMainContentEmpty),i.channel("views").reply("get:formTitle",this.getFormTitle)},getFieldItem:function(t){return e},getMainContentEmpty:function(){return t},getFormTitle:function(){return n}});return r});var i=Backbone.Radio;jQuery(document).ready(function(e){t(["views/app/builder","controllers/loadControllers","views/loadViews"],function(t,n,r){var a=Marionette.Application.extend({initialize:function(e){var t=this;Marionette.Renderer.render=function(e,n){var e=t.template(e);return e(n)},i.channel("app").trigger("before:loadControllers",this);new n;i.channel("app").trigger("after:loadControllers",this),i.channel("app").trigger("before:loadViews",this);new r;i.channel("app").trigger("after:loadViews",this),i.channel("app").reply("get:template",this.template)},onStart:function(){new t;i.channel("app").trigger("after:appStart",this)},template:function(t){return _.template(e(t).html(),{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"})}}),l=new a;l.start()})}),n("main",function(){})}();
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=builder.js.map
